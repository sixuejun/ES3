<head><script src="https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js"></script><script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script><script type="module">import{Matrix as e,ObservablePoint as t,Point as i,Texture as s,Transform as o,utils as r}from'https://testingcf.jsdelivr.net/npm/@pixi/core/+esm';import{Container as a}from'https://testingcf.jsdelivr.net/npm/@pixi/display/+esm';var n={61(e){e.exports=Vue},131(n,l,c){c.d(l,{live2dModelManager:()=>Bi});var d=Object.defineProperty,u=Math.pow,h=(e,t,i)=>(((e,t,i)=>{t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,'symbol'!=typeof t?t+'':t,i),i),m=(e,t,i)=>new Promise((s,o)=>{var r=e=>{try{n(i.next(e))}catch(e){o(e)}},a=e=>{try{n(i.throw(e))}catch(e){o(e)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,a);n((i=i.apply(e,t)).next())});var p,g;(g=p||(p={})).supportMoreMaskDivisions=!0,g.setOpacityFromMotion=!1;const v=0,f=1,x=2,y=1,C=!0,b=!0,w=500,M=2e3,k=500,S=!0,P={log(e,...t){y<=v&&console.log(`[${e}]`,...t)},warn(e,...t){y<=f&&console.warn(`[${e}]`,...t)},error(e,...t){y<=x&&console.error(`[${e}]`,...t)}};function E(e,t,i){return e<t?t:e>i?i:e}function I(e,t,i,s,o){const r=t[s];null!==r&&typeof r===e&&(i[o]=r)}function T(e,t,i,s,o){const r=t[s];Array.isArray(r)&&(i[o]=r.filter(t=>null!==t&&typeof t===e))}class B extends r.EventEmitter{constructor(e,t){super(),h(this,'tag'),h(this,'settings'),h(this,'expressions',[]),h(this,'defaultExpression'),h(this,'currentExpression'),h(this,'reserveExpressionIndex',-1),h(this,'destroyed',!1),this.settings=e,this.tag=`ExpressionManager(${e.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(e){return m(this,null,function*(){if(!this.definitions[e])return void P.warn(this.tag,`Undefined expression at [${e}]`);if(null===this.expressions[e])return void P.warn(this.tag,`Cannot set expression at [${e}] because it's already failed in loading.`);if(this.expressions[e])return this.expressions[e];const t=yield this._loadExpression(e);return this.expressions[e]=t,t})}_loadExpression(e){throw new Error('Not implemented.')}setRandomExpression(){return m(this,null,function*(){if(this.definitions.length){const e=[];for(let t=0;t<this.definitions.length;t++)null!==this.expressions[t]&&this.expressions[t]!==this.currentExpression&&t!==this.reserveExpressionIndex&&e.push(t);if(e.length){const t=Math.floor(Math.random()*e.length);return this.setExpression(t)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(e){return m(this,null,function*(){if('number'!=typeof e&&(e=this.getExpressionIndex(e)),!(e>-1&&e<this.definitions.length))return!1;if(e===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=e;const t=yield this.loadExpression(e);return!(!t||this.reserveExpressionIndex!==e)&&(this.reserveExpressionIndex=-1,this.currentExpression=t,this._setExpression(t),!0)})}update(e,t){return!this.isFinished()&&this.updateParameters(e,t)}destroy(){this.destroyed=!0,this.emit('destroy');this.definitions=void 0,this.expressions=void 0}}const L=40/7.5,V=1/150;class N{constructor(){h(this,'targetX',0),h(this,'targetY',0),h(this,'x',0),h(this,'y',0),h(this,'vx',0),h(this,'vy',0)}focus(e,t,i=!1){this.targetX=E(e,-1,1),this.targetY=E(t,-1,1),i&&(this.x=this.targetX,this.y=this.targetY)}update(e){const t=this.targetX-this.x,i=this.targetY-this.y;if(Math.abs(t)<.01&&Math.abs(i)<.01)return;const s=Math.sqrt(u(t,2)+u(i,2)),o=L/(1e3/e);let r=o*(t/s)-this.vx,a=o*(i/s)-this.vy;const n=Math.sqrt(u(r,2)+u(a,2)),l=o*V*e;n>l&&(r*=l/n,a*=l/n),this.vx+=r,this.vy+=a;const c=Math.sqrt(u(this.vx,2)+u(this.vy,2)),d=.5*(Math.sqrt(u(l,2)+8*l*s)-l);c>d&&(this.vx*=d/c,this.vy*=d/c),this.x+=this.vx,this.y+=this.vy}}class D{constructor(e){h(this,'json'),h(this,'name'),h(this,'url'),h(this,'pose'),h(this,'physics'),this.json=e;const t=e.url;if('string'!=typeof t)throw new TypeError('The `url` field in settings JSON must be defined as a string.');this.url=t,this.name=function(e){let t=e.lastIndexOf('/');return-1!=t&&(e=e.slice(0,t)),t=e.lastIndexOf('/'),-1!==t&&(e=e.slice(t+1)),e}(this.url)}resolveURL(e){return r.url.resolve(this.url,e)}replaceFiles(e){this.moc=e(this.moc,'moc'),void 0!==this.pose&&(this.pose=e(this.pose,'pose')),void 0!==this.physics&&(this.physics=e(this.physics,'physics'));for(let t=0;t<this.textures.length;t++)this.textures[t]=e(this.textures[t],`textures[${t}]`)}getDefinedFiles(){const e=[];return this.replaceFiles(t=>(e.push(t),t)),e}validateFiles(e){const t=(t,i)=>{const s=this.resolveURL(t);if(!e.includes(s)){if(i)throw new Error(`File "${t}" is defined in settings, but doesn't exist in given files`);return!1}return!0};[this.moc,...this.textures].forEach(e=>t(e,!0));return this.getDefinedFiles().filter(e=>t(e,!1))}}var F=(e=>(e[e.NONE=0]='NONE',e[e.IDLE=1]='IDLE',e[e.NORMAL=2]='NORMAL',e[e.FORCE=3]='FORCE',e))(F||{});class R{constructor(){h(this,'tag'),h(this,'debug',!1),h(this,'currentPriority',0),h(this,'reservePriority',0),h(this,'currentGroup'),h(this,'currentIndex'),h(this,'reservedGroup'),h(this,'reservedIndex'),h(this,'reservedIdleGroup'),h(this,'reservedIdleIndex')}reserve(e,t,i){if(i<=0)return P.log(this.tag,'Cannot start a motion with MotionPriority.NONE.'),!1;if(e===this.currentGroup&&t===this.currentIndex)return P.log(this.tag,'Motion is already playing.',this.dump(e,t)),!1;if(e===this.reservedGroup&&t===this.reservedIndex||e===this.reservedIdleGroup&&t===this.reservedIdleIndex)return P.log(this.tag,'Motion is already reserved.',this.dump(e,t)),!1;if(1===i){if(0!==this.currentPriority)return P.log(this.tag,'Cannot start idle motion because another motion is playing.',this.dump(e,t)),!1;if(void 0!==this.reservedIdleGroup)return P.log(this.tag,'Cannot start idle motion because another idle motion has reserved.',this.dump(e,t)),!1;this.setReservedIdle(e,t)}else{if(i<3){if(i<=this.currentPriority)return P.log(this.tag,'Cannot start motion because another motion is playing as an equivalent or higher priority.',this.dump(e,t)),!1;if(i<=this.reservePriority)return P.log(this.tag,'Cannot start motion because another motion has reserved as an equivalent or higher priority.',this.dump(e,t)),!1}this.setReserved(e,t,i)}return!0}start(e,t,i,s){if(1===s){if(this.setReservedIdle(void 0,void 0),0!==this.currentPriority)return P.log(this.tag,'Cannot start idle motion because another motion is playing.',this.dump(t,i)),!1}else{if(t!==this.reservedGroup||i!==this.reservedIndex)return P.log(this.tag,'Cannot start motion because another motion has taken the place.',this.dump(t,i)),!1;this.setReserved(void 0,void 0,0)}return!!e&&(this.setCurrent(t,i,s),!0)}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(e,t,i){this.currentPriority=i,this.currentGroup=e,this.currentIndex=t}setReserved(e,t,i){this.reservePriority=i,this.reservedGroup=e,this.reservedIndex=t}setReservedIdle(e,t){this.reservedIdleGroup=e,this.reservedIdleIndex=t}isActive(e,t){return e===this.currentGroup&&t===this.currentIndex||e===this.reservedGroup&&t===this.reservedIndex||e===this.reservedIdleGroup&&t===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return void 0===this.currentGroup&&void 0===this.reservedIdleGroup}shouldOverrideExpression(){return!S&&this.currentPriority>1}dump(e,t){if(this.debug){return`\n<Requested> group = "${e}", index = ${t}\n`+['currentPriority','reservePriority','currentGroup','currentIndex','reservedGroup','reservedIndex','reservedIdleGroup','reservedIdleIndex'].map(e=>'['+e+'] '+this[e]).join('\n')}return''}}class A{static get volume(){return this._volume}static set volume(e){this._volume=(e>1?1:e<0?0:e)||0,this.audios.forEach(e=>e.volume=this._volume)}static add(e,t,i){const s=new Audio(e);return s.volume=this._volume,s.preload='auto',s.addEventListener('ended',()=>{this.dispose(s),null==t||t()}),s.addEventListener('error',t=>{this.dispose(s),P.warn('SoundManager',`Error occurred on "${e}"`,t.error),null==i||i(t.error)}),this.audios.push(s),s}static play(e){return new Promise((t,i)=>{var s;null==(s=e.play())||s.catch(t=>{e.dispatchEvent(new ErrorEvent('error',{error:t})),i(t)}),e.readyState===e.HAVE_ENOUGH_DATA?t():e.addEventListener('canplaythrough',t)})}static dispose(e){e.pause(),e.removeAttribute('src'),function(e,t){const i=e.indexOf(t);-1!==i&&e.splice(i,1)}(this.audios,e)}static destroy(){for(let e=this.audios.length-1;e>=0;e--)this.dispose(this.audios[e])}}h(A,'audios',[]),h(A,'_volume',.5);class O extends r.EventEmitter{constructor(e,t){super(),h(this,'tag'),h(this,'settings'),h(this,'motionGroups',{}),h(this,'state',new R),h(this,'currentAudio'),h(this,'playing',!1),h(this,'destroyed',!1),this.settings=e,this.tag=`MotionManager(${e.name})`,this.state.tag=this.tag}init(e){(null==e?void 0:e.idleMotionGroup)&&(this.groups.idle=e.idleMotionGroup),this.setupMotions(e),this.stopAllMotions()}setupMotions(e){for(const e of Object.keys(this.definitions))this.motionGroups[e]=[];let t;switch(null==e?void 0:e.motionPreload){case'NONE':return;case'ALL':t=Object.keys(this.definitions);break;default:t=[this.groups.idle]}for(const e of t)if(this.definitions[e])for(let t=0;t<this.definitions[e].length;t++)this.loadMotion(e,t).then()}loadMotion(e,t){return m(this,null,function*(){var i;if(!(null==(i=this.definitions[e])?void 0:i[t]))return void P.warn(this.tag,`Undefined motion at "${e}"[${t}]`);if(null===this.motionGroups[e][t])return void P.warn(this.tag,`Cannot start motion at "${e}"[${t}] because it's already failed in loading.`);if(this.motionGroups[e][t])return this.motionGroups[e][t];const s=yield this._loadMotion(e,t);return this.destroyed?void 0:(this.motionGroups[e][t]=null!=s?s:null,s)})}_loadMotion(e,t){throw new Error('Not implemented.')}startMotion(e,t){return m(this,arguments,function*(e,t,i=F.NORMAL){var s;if(!this.state.reserve(e,t,i))return!1;const o=null==(s=this.definitions[e])?void 0:s[t];if(!o)return!1;let r;if(this.currentAudio&&A.dispose(this.currentAudio),C){const e=this.getSoundFile(o);if(e)try{r=A.add(this.settings.resolveURL(e),()=>this.currentAudio=void 0,()=>this.currentAudio=void 0),this.currentAudio=r}catch(t){P.warn(this.tag,'Failed to create audio',e,t)}}const a=yield this.loadMotion(e,t);if(r){const e=A.play(r).catch(e=>P.warn(this.tag,'Failed to play audio',r.src,e));b&&(yield e)}return this.state.start(a,e,t,i)?(P.log(this.tag,'Start motion:',this.getMotionName(o)),this.emit('motionStart',e,t,r),this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),this.playing=!0,this._startMotion(a),!0):(r&&(A.dispose(r),this.currentAudio=void 0),!1)})}startRandomMotion(e,t){return m(this,null,function*(){const i=this.definitions[e];if(null==i?void 0:i.length){const s=[];for(let t=0;t<i.length;t++)null===this.motionGroups[e][t]||this.state.isActive(e,t)||s.push(t);if(s.length){const i=Math.floor(Math.random()*s.length);return this.startMotion(e,s[i],t)}}return!1})}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.currentAudio&&(A.dispose(this.currentAudio),this.currentAudio=void 0)}update(e,t){var i;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit('motionFinish')),this.state.shouldOverrideExpression()&&(null==(i=this.expressionManager)||i.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,F.IDLE)),this.updateParameters(e,t)}destroy(){var e;this.destroyed=!0,this.emit('destroy'),this.stopAllMotions(),null==(e=this.expressionManager)||e.destroy();this.definitions=void 0,this.motionGroups=void 0}}const U={x:0,y:0,width:0,height:0};class j extends r.EventEmitter{constructor(){super(...arguments),h(this,'focusController',new N),h(this,'pose'),h(this,'physics'),h(this,'originalWidth',0),h(this,'originalHeight',0),h(this,'width',0),h(this,'height',0),h(this,'localTransform',new e),h(this,'drawingMatrix',new e),h(this,'hitAreas',{}),h(this,'textureFlipY',!1),h(this,'viewport',[0,0,0,0]),h(this,'destroyed',!1)}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const e=this,t=this.getSize();e.originalWidth=t[0],e.originalHeight=t[1];const i=Object.assign({width:2,height:2},this.getLayout());this.localTransform.scale(i.width/2,i.height/2),e.width=this.originalWidth*this.localTransform.a,e.height=this.originalHeight*this.localTransform.d;const s=void 0!==i.x&&i.x-i.width/2||void 0!==i.centerX&&i.centerX||void 0!==i.left&&i.left-i.width/2||void 0!==i.right&&i.right+i.width/2||0,o=void 0!==i.y&&i.y-i.height/2||void 0!==i.centerY&&i.centerY||void 0!==i.top&&i.top-i.height/2||void 0!==i.bottom&&i.bottom+i.height/2||0;this.localTransform.translate(this.width*s,-this.height*o)}setupHitAreas(){const e=this.getHitAreaDefs().filter(e=>e.index>=0);for(const t of e)this.hitAreas[t.name]=t}hitTest(e,t){return Object.keys(this.hitAreas).filter(i=>this.isHit(i,e,t))}isHit(e,t,i){if(!this.hitAreas[e])return!1;const s=this.hitAreas[e].index,o=this.getDrawableBounds(s,U);return o.x<=t&&t<=o.x+o.width&&o.y<=i&&i<=o.y+o.height}getDrawableBounds(e,t){const i=this.getDrawableVertices(e);let s=i[0],o=i[0],r=i[1],a=i[1];for(let e=0;e<i.length;e+=2){const t=i[e],n=i[e+1];s=Math.min(t,s),o=Math.max(t,o),r=Math.min(n,r),a=Math.max(n,a)}return null!=t||(t={}),t.x=s,t.y=r,t.width=o-s,t.height=a-r,t}updateTransform(e){this.drawingMatrix.copyFrom(e).append(this.localTransform)}update(e,t){this.focusController.update(e)}destroy(){this.destroyed=!0,this.emit('destroy'),this.motionManager.destroy(),this.motionManager=void 0}}class G extends Error{constructor(e,t,i,s=!1){super(e),this.url=t,this.status=i,this.aborted=s}}const W=class e{static createXHR(t,i,s,o,r){const a=new XMLHttpRequest;if(e.allXhrSet.add(a),t){let i=e.xhrMap.get(t);i?i.add(a):(i=new Set([a]),e.xhrMap.set(t,i)),t.listeners('destroy').includes(e.cancelXHRs)||t.once('destroy',e.cancelXHRs)}return a.open('GET',i),a.responseType=s,a.onload=()=>{200!==a.status&&0!==a.status||!a.response?a.onerror():o(a.response)},a.onerror=()=>{P.warn('XHRLoader',`Failed to load resource as ${a.responseType} (Status ${a.status}): ${i}`),r(new G('Network error.',i,a.status))},a.onabort=()=>r(new G('Aborted.',i,a.status,!0)),a.onloadend=()=>{var i;e.allXhrSet.delete(a),t&&(null==(i=e.xhrMap.get(t))||i.delete(a))},a}static cancelXHRs(){var t;null==(t=e.xhrMap.get(this))||t.forEach(t=>{t.abort(),e.allXhrSet.delete(t)}),e.xhrMap.delete(this)}static release(){e.allXhrSet.forEach(e=>e.abort()),e.allXhrSet.clear(),e.xhrMap=new WeakMap}};h(W,'xhrMap',new WeakMap),h(W,'allXhrSet',new Set),h(W,'loader',(e,t)=>new Promise((t,i)=>{W.createXHR(e.target,e.settings?e.settings.resolveURL(e.url):e.url,e.type,i=>{e.result=i,t()},i).send()}));let H=W;function X(e,t){let i=-1;return function s(o,r){if(r)return Promise.reject(r);if(o<=i)return Promise.reject(new Error('next() called multiple times'));i=o;const a=e[o];if(!a)return Promise.resolve();try{return Promise.resolve(a(t,s.bind(null,o+1)))}catch(e){return Promise.reject(e)}}(0)}class Y{static load(e){return X(this.middlewares,e).then(()=>e.result)}}function q(){}h(Y,'middlewares',[H.loader]);const J='Live2DFactory',Z=(e,t)=>m(void 0,null,function*(){if('string'==typeof e.source){const t=yield Y.load({url:e.source,type:'json',target:e.live2dModel});t.url=e.source,e.source=t,e.live2dModel.emit('settingsJSONLoaded',t)}return t()}),K=(e,t)=>m(void 0,null,function*(){if(e.source instanceof D)return e.settings=e.source,t();if('object'==typeof e.source){const i=le.findRuntime(e.source);if(i){const s=i.createModelSettings(e.source);return e.settings=s,e.live2dModel.emit('settingsLoaded',s),t()}}throw new TypeError('Unknown settings format.')}),Q=(e,t)=>{if(e.settings){const i=le.findRuntime(e.settings);if(i)return i.ready().then(t)}return t()},ee=(e,t)=>m(void 0,null,function*(){yield t();const i=e.internalModel;if(i){const t=e.settings,s=le.findRuntime(t);if(s){const o=[];t.pose&&o.push(Y.load({settings:t,url:t.pose,type:'json',target:i}).then(t=>{i.pose=s.createPose(i.coreModel,t),e.live2dModel.emit('poseLoaded',i.pose)}).catch(t=>{e.live2dModel.emit('poseLoadError',t),P.warn(J,'Failed to load pose.',t)})),t.physics&&o.push(Y.load({settings:t,url:t.physics,type:'json',target:i}).then(t=>{i.physics=s.createPhysics(i.coreModel,t),e.live2dModel.emit('physicsLoaded',i.physics)}).catch(t=>{e.live2dModel.emit('physicsLoadError',t),P.warn(J,'Failed to load physics.',t)})),o.length&&(yield Promise.all(o))}}}),te=(e,t)=>m(void 0,null,function*(){if(!e.settings)throw new TypeError('Missing settings.');{const i=e.live2dModel,o=Promise.all(e.settings.textures.map(t=>function(e,t={}){const i={resourceOptions:{crossorigin:t.crossOrigin}};if(s.fromURL)return s.fromURL(e,i).catch(e=>{if(e instanceof Error)throw e;const t=new Error('Texture loading error');throw t.event=e,t});i.resourceOptions.autoLoad=!1;const o=s.from(e,i);if(o.baseTexture.valid)return Promise.resolve(o);const r=o.baseTexture.resource;return null!=r._live2d_load||(r._live2d_load=new Promise((e,t)=>{const i=e=>{r.source.removeEventListener('error',i);const s=new Error('Texture loading error');s.event=e,t(s)};r.source.addEventListener('error',i),r.load().then(()=>e(o)).catch(i)})),r._live2d_load}(e.settings.resolveURL(t),{crossOrigin:e.options.crossOrigin})));if(o.catch(q),yield t(),!e.internalModel)throw new TypeError('Missing internal model.');i.internalModel=e.internalModel,i.emit('modelLoaded',e.internalModel),i.textures=yield o,i.emit('textureLoaded',i.textures)}}),ie=(e,t)=>m(void 0,null,function*(){const i=e.settings;if(i instanceof D){const s=le.findRuntime(i);if(!s)throw new TypeError('Unknown model settings.');const o=yield Y.load({settings:i,url:i.moc,type:'arraybuffer',target:e.live2dModel});if(!s.isValidMoc(o))throw new Error('Invalid moc data');const r=s.createCoreModel(o);return e.internalModel=s.createInternalModel(r,i,e.options),t()}throw new TypeError('Missing settings.')}),se=class e{static unzip(t,i){return m(this,null,function*(){const s=yield e.getFilePaths(t),o=[];for(const e of i.getDefinedFiles()){const t=decodeURI(r.url.resolve(i.url,e));s.includes(t)&&o.push(t)}const a=yield e.getFiles(t,o);for(let e=0;e<a.length;e++){const t=o[e],i=a[e];Object.defineProperty(i,'webkitRelativePath',{value:t})}return a})}static createSettings(t){return m(this,null,function*(){const i=(yield e.getFilePaths(t)).find(e=>e.endsWith('model.json')||e.endsWith('model3.json'));if(!i)throw new Error('Settings file not found');const s=yield e.readText(t,i);if(!s)throw new Error('Empty settings file: '+i);const o=JSON.parse(s);o.url=i;const r=e.live2dFactory.findRuntime(o);if(!r)throw new Error('Unknown settings JSON');return r.createModelSettings(o)})}static zipReader(e,t){return m(this,null,function*(){throw new Error('Not implemented')})}static getFilePaths(e){return m(this,null,function*(){throw new Error('Not implemented')})}static getFiles(e,t){return m(this,null,function*(){throw new Error('Not implemented')})}static readText(e,t){return m(this,null,function*(){throw new Error('Not implemented')})}static releaseReader(e){}};h(se,'live2dFactory'),h(se,'ZIP_PROTOCOL','zip://'),h(se,'uid',0),h(se,'factory',(e,t)=>m(se,null,function*(){const i=e.source;let s,o,r;if('string'==typeof i&&(i.endsWith('.zip')||i.startsWith(se.ZIP_PROTOCOL))?(s=i.startsWith(se.ZIP_PROTOCOL)?i.slice(se.ZIP_PROTOCOL.length):i,o=yield Y.load({url:s,type:'blob',target:e.live2dModel})):Array.isArray(i)&&1===i.length&&i[0]instanceof File&&i[0].name.endsWith('.zip')&&(o=i[0],s=URL.createObjectURL(o),r=i.settings),o){if(!o.size)throw new Error('Empty zip file');const t=yield se.zipReader(o,s);r||(r=yield se.createSettings(t)),r._objectURL=se.ZIP_PROTOCOL+se.uid+'/'+r.url;const i=yield se.unzip(t,r);i.settings=r,e.source=i,s.startsWith('blob:')&&e.live2dModel.once('modelLoaded',e=>{e.once('destroy',function(){URL.revokeObjectURL(s)})}),se.releaseReader(t)}return t()}));let oe=se;const re=class e{static resolveURL(t,i){var s;const o=null==(s=e.filesMap[t])?void 0:s[i];if(void 0===o)throw new Error('Cannot find this file from uploaded files: '+i);return o}static upload(t,i){return m(this,null,function*(){const s={};for(const e of i.getDefinedFiles()){const o=decodeURI(r.url.resolve(i.url,e)),a=t.find(e=>e.webkitRelativePath===o);a&&(s[e]=URL.createObjectURL(a))}e.filesMap[i._objectURL]=s})}static createSettings(t){return m(this,null,function*(){const i=t.find(e=>e.name.endsWith('model.json')||e.name.endsWith('model3.json'));if(!i)throw new TypeError('Settings file not found');const s=yield e.readText(i),o=JSON.parse(s);o.url=i.webkitRelativePath;const r=le.findRuntime(o);if(!r)throw new Error('Unknown settings JSON');const a=r.createModelSettings(o);return a._objectURL=URL.createObjectURL(i),a})}static readText(e){return m(this,null,function*(){return new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i,s.readAsText(e,'utf8')})})}};h(re,'live2dFactory'),h(re,'filesMap',{}),h(re,'factory',(e,t)=>m(re,null,function*(){if(Array.isArray(e.source)&&e.source[0]instanceof File){const t=e.source;let i=t.settings;if(i){if(!i._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings')}else i=yield re.createSettings(t);i.validateFiles(t.map(e=>encodeURI(e.webkitRelativePath))),yield re.upload(t,i),i.resolveURL=function(e){return re.resolveURL(this._objectURL,e)},e.source=i,e.live2dModel.once('modelLoaded',e=>{e.once('destroy',function(){const e=this.settings._objectURL;if(URL.revokeObjectURL(e),re.filesMap[e])for(const t of Object.values(re.filesMap[e]))URL.revokeObjectURL(t);delete re.filesMap[e]})})}return t()}));let ae=re;const ne=class e{static registerRuntime(t){e.runtimes.push(t),e.runtimes.sort((e,t)=>t.version-e.version)}static findRuntime(t){for(const i of e.runtimes)if(i.test(t))return i}static setupLive2DModel(t,i,s){return m(this,null,function*(){const o=new Promise(e=>t.once('textureLoaded',e)),r=new Promise(e=>t.once('modelLoaded',e)),a=Promise.all([o,r]).then(()=>t.emit('ready'));yield X(e.live2DModelMiddlewares,{live2dModel:t,source:i,options:s||{}}),yield a,t.emit('load')})}static loadMotion(t,i,s){var o;const r=e=>t.emit('motionLoadError',i,s,e);try{const a=null==(o=t.definitions[i])?void 0:o[s];if(!a)return Promise.resolve(void 0);t.listeners('destroy').includes(e.releaseTasks)||t.once('destroy',e.releaseTasks);let n=e.motionTasksMap.get(t);n||(n={},e.motionTasksMap.set(t,n));let l=n[i];l||(l=[],n[i]=l);const c=t.getMotionFile(a);return null!=l[s]||(l[s]=Y.load({url:c,settings:t.settings,type:t.motionDataType,target:t}).then(o=>{var r;const n=null==(r=e.motionTasksMap.get(t))?void 0:r[i];n&&delete n[s];const l=t.createMotion(o,i,a);return t.emit('motionLoaded',i,s,l),l}).catch(e=>{P.warn(t.tag,`Failed to load motion: ${c}\n`,e),r(e)})),l[s]}catch(e){P.warn(t.tag,`Failed to load motion at "${i}"[${s}]\n`,e),r(e)}return Promise.resolve(void 0)}static loadExpression(t,i){const s=e=>t.emit('expressionLoadError',i,e);try{const o=t.definitions[i];if(!o)return Promise.resolve(void 0);t.listeners('destroy').includes(e.releaseTasks)||t.once('destroy',e.releaseTasks);let r=e.expressionTasksMap.get(t);r||(r=[],e.expressionTasksMap.set(t,r));const a=t.getExpressionFile(o);return null!=r[i]||(r[i]=Y.load({url:a,settings:t.settings,type:'json',target:t}).then(s=>{const r=e.expressionTasksMap.get(t);r&&delete r[i];const a=t.createExpression(s,o);return t.emit('expressionLoaded',i,a),a}).catch(e=>{P.warn(t.tag,`Failed to load expression: ${a}\n`,e),s(e)})),r[i]}catch(e){P.warn(t.tag,`Failed to load expression at [${i}]\n`,e),s(e)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof O?e.motionTasksMap.delete(this):e.expressionTasksMap.delete(this)}};h(ne,'runtimes',[]),h(ne,'urlToJSON',Z),h(ne,'jsonToSettings',K),h(ne,'waitUntilReady',Q),h(ne,'setupOptionals',ee),h(ne,'setupEssentials',te),h(ne,'createInternalModel',ie),h(ne,'live2DModelMiddlewares',[oe.factory,ae.factory,Z,K,Q,ee,te,ie]),h(ne,'motionTasksMap',new WeakMap),h(ne,'expressionTasksMap',new WeakMap);let le=ne;O.prototype._loadMotion=function(e,t){return le.loadMotion(this,e,t)},B.prototype._loadExpression=function(e){return le.loadExpression(this,e)},ae.live2dFactory=le,oe.live2dFactory=le;const ce=class e{constructor(t,{autoUpdate:i=!0,autoHitTest:s=!0,autoFocus:o=!0,autoInteract:r,ticker:a}={}){h(this,'model'),h(this,'destroyed',!1),h(this,'_ticker'),h(this,'_autoUpdate',!1),h(this,'_autoHitTest',!1),h(this,'_autoFocus',!1),a||(e.defaultTicker?a=e.defaultTicker:'undefined'!=typeof PIXI&&(a=PIXI.Ticker.shared)),void 0!==r&&(s=r,o=r,P.warn(t.tag,'options.autoInteract is deprecated since v0.5.0, use autoHitTest and autoFocus instead.')),this.model=t,this.ticker=a,this.autoUpdate=i,this.autoHitTest=s,this.autoFocus=o,(s||o)&&(this.model.eventMode='static')}get ticker(){return this._ticker}set ticker(e){var t;this._ticker&&this._ticker.remove(ue,this),this._ticker=e,this._autoUpdate&&(null==(t=this._ticker)||t.add(ue,this))}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){var t;this.destroyed||(e?this._ticker?(this._ticker.add(ue,this),this._autoUpdate=!0):P.warn(this.model.tag,'No Ticker to be used for automatic updates. Either set option.ticker when creating Live2DModel, or expose PIXI to global scope (window.PIXI = PIXI).'):(null==(t=this._ticker)||t.remove(ue,this),this._autoUpdate=!1))}get autoHitTest(){return this._autoHitTest}set autoHitTest(e){e!==this.autoHitTest&&(e?this.model.on('pointertap',he,this):this.model.off('pointertap',he,this),this._autoHitTest=e)}get autoFocus(){return this._autoFocus}set autoFocus(e){e!==this.autoFocus&&(e?this.model.on('globalpointermove',me,this):this.model.off('globalpointermove',me,this),this._autoFocus=e)}get autoInteract(){return this._autoHitTest&&this._autoFocus}set autoInteract(e){this.autoHitTest=e,this.autoFocus=e}onTickerUpdate(){const e=this.ticker.deltaMS;this.model.update(e)}onTap(e){this.model.tap(e.global.x,e.global.y)}onPointerMove(e){this.model.focus(e.global.x,e.global.y)}destroy(){this.autoFocus=!1,this.autoHitTest=!1,this.autoUpdate=!1,this.ticker=void 0,this.destroyed=!0}};h(ce,'defaultTicker');let de=ce;function ue(){this.onTickerUpdate()}function he(e){this.onTap(e)}function me(e){this.onPointerMove(e)}class pe extends o{}const ge=new i,ve=new e;class fe extends a{constructor(e){super(),h(this,'tag','Live2DModel(uninitialized)'),h(this,'internalModel'),h(this,'textures',[]),h(this,'transform',new pe),h(this,'anchor',new t(this.onAnchorChange,this,0,0)),h(this,'glContextID',-1),h(this,'elapsedTime',0),h(this,'deltaTime',0),h(this,'automator'),this.automator=new de(this,e),this.once('modelLoaded',()=>this.init(e))}static from(e,t){const i=new this(t);return le.setupLive2DModel(i,e,t).then(()=>i)}static fromSync(e,t){const i=new this(t);return le.setupLive2DModel(i,e,t).then(null==t?void 0:t.onLoad).catch(null==t?void 0:t.onError),i}static registerTicker(e){de.defaultTicker=e.shared}init(e){this.tag=`Live2DModel(${this.internalModel.settings.name})`}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(e,t,i){return void 0===t?this.internalModel.motionManager.startRandomMotion(e,i):this.internalModel.motionManager.startMotion(e,t,i)}expression(e){return this.internalModel.motionManager.expressionManager?void 0===e?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(e):Promise.resolve(!1)}focus(e,t,i=!1){ge.x=e,ge.y=t,this.toModelPosition(ge,ge,!0);const s=ge.x/this.internalModel.originalWidth*2-1,o=ge.y/this.internalModel.originalHeight*2-1,r=Math.atan2(o,s);this.internalModel.focusController.focus(Math.cos(r),-Math.sin(r),i)}tap(e,t){const i=this.hitTest(e,t);i.length&&(P.log(this.tag,'Hit',i),this.emit('hit',i))}hitTest(e,t){return ge.x=e,ge.y=t,this.toModelPosition(ge,ge),this.internalModel.hitTest(ge.x,ge.y)}toModelPosition(e,t=e.clone(),i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(e,t),this.internalModel.localTransform.applyInverse(t,t),t}containsPoint(e){return this.getBounds(!0).contains(e.x,e.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}update(e){this.deltaTime+=e,this.elapsedTime+=e}_render(e){e.batch.reset(),e.geometry.reset(),e.shader.reset(),e.state.reset();let t=!1;this.glContextID!==e.CONTEXT_UID&&(this.glContextID=e.CONTEXT_UID,this.internalModel.updateWebGLContext(e.gl,this.glContextID),t=!0);for(let i=0;i<this.textures.length;i++){const s=this.textures[i];s.valid&&(!t&&s.baseTexture._glTextures[this.glContextID]||(e.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),e.texture.bind(s.baseTexture,0)),this.internalModel.bindTexture(i,s.baseTexture._glTextures[this.glContextID].texture),s.baseTexture.touched=e.textureGC.count)}const i=e.framebuffer.viewport;this.internalModel.viewport=[i.x,i.y,i.width,i.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const s=ve.copyFrom(e.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(s),this.internalModel.draw(e.gl),e.state.reset(),e.texture.reset()}destroy(e){this.emit('destroy'),(null==e?void 0:e.texture)&&this.textures.forEach(t=>t.destroy(e.baseTexture)),this.automator.destroy(),this.internalModel.destroy(),super.destroy(e)}}if(!window.Live2D)throw new Error('Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.');const xe=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(e,t){xe.call(this,e,t),t.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class ye extends AMotion{constructor(e){super(),h(this,'params',[]),this.setFadeIn(e.fade_in>0?e.fade_in:k),this.setFadeOut(e.fade_out>0?e.fade_out:k),Array.isArray(e.params)&&e.params.forEach(e=>{const t=e.calc||'add';if('add'===t){const t=e.def||0;e.val-=t}else if('mult'===t){const t=e.def||1;e.val/=t}this.params.push({calc:t,val:e.val,id:e.id})})}updateParamExe(e,t,i,s){this.params.forEach(t=>{e.setParamFloat(t.id,t.val*i)})}}class _e extends B{constructor(e,t){var i;super(e,t),h(this,'queueManager',new MotionQueueManager),h(this,'definitions'),this.definitions=null!=(i=this.settings.expressions)?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(e){return this.definitions.findIndex(t=>t.name===e)}getExpressionFile(e){return e.file}createExpression(e,t){return new ye(e)}_setExpression(e){return this.queueManager.startMotion(e)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.updateParam(e)}}class Ce extends O{constructor(e,t){super(e,t),h(this,'definitions'),h(this,'groups',{idle:'idle'}),h(this,'motionDataType','arraybuffer'),h(this,'queueManager',new MotionQueueManager),h(this,'expressionManager'),this.definitions=this.settings.motions,this.init(t)}init(e){super.init(e),this.settings.expressions&&(this.expressionManager=new _e(this.settings,e))}isFinished(){return this.queueManager.isFinished()}createMotion(e,t,i){const s=Live2DMotion.loadMotion(e),o=t===this.groups.idle?M:w;return s.setFadeIn(i.fade_in>0?i.fade_in:o),s.setFadeOut(i.fade_out>0?i.fade_out:o),s}getMotionFile(e){return e.file}getMotionName(e){return e.file}getSoundFile(e){return e.sound}_startMotion(e,t){return e.onFinishHandler=t,this.queueManager.stopAllMotions(),this.queueManager.startMotion(e)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.updateParam(e)}destroy(){super.destroy(),this.queueManager=void 0}}class be{constructor(e){h(this,'leftParam'),h(this,'rightParam'),h(this,'blinkInterval',4e3),h(this,'closingDuration',100),h(this,'closedDuration',50),h(this,'openingDuration',150),h(this,'eyeState',0),h(this,'eyeParamValue',1),h(this,'closedTimer',0),h(this,'nextBlinkTimeLeft',this.blinkInterval),this.coreModel=e,this.leftParam=e.getParamIndex('PARAM_EYE_L_OPEN'),this.rightParam=e.getParamIndex('PARAM_EYE_R_OPEN')}setEyeParams(e){this.eyeParamValue=E(e,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(e){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=e,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+(t=0,i=2e3,Math.random()*(i-t)+t));break;case 1:this.setEyeParams(this.eyeParamValue+e/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=e,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+e/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}var t,i}}const we=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Me extends j{constructor(e,t,i){super(),h(this,'settings'),h(this,'coreModel'),h(this,'motionManager'),h(this,'eyeBlink'),h(this,'eyeballXParamIndex'),h(this,'eyeballYParamIndex'),h(this,'angleXParamIndex'),h(this,'angleYParamIndex'),h(this,'angleZParamIndex'),h(this,'bodyAngleXParamIndex'),h(this,'breathParamIndex'),h(this,'textureFlipY',!0),h(this,'drawDataCount',0),h(this,'disableCulling',!1),h(this,'hasDrawn',!1),this.coreModel=e,this.settings=t,this.motionManager=new Ce(t,i),this.eyeBlink=new be(e),this.eyeballXParamIndex=e.getParamIndex('PARAM_EYE_BALL_X'),this.eyeballYParamIndex=e.getParamIndex('PARAM_EYE_BALL_Y'),this.angleXParamIndex=e.getParamIndex('PARAM_ANGLE_X'),this.angleYParamIndex=e.getParamIndex('PARAM_ANGLE_Y'),this.angleZParamIndex=e.getParamIndex('PARAM_ANGLE_Z'),this.bodyAngleXParamIndex=e.getParamIndex('PARAM_BODY_ANGLE_X'),this.breathParamIndex=e.getParamIndex('PARAM_BREATH'),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach(({id:e,value:t})=>this.coreModel.setParamFloat(e,t)),this.settings.initOpacities&&this.settings.initOpacities.forEach(({id:e,value:t})=>this.coreModel.setPartsOpacity(e,t)),this.coreModel.saveParam();const e=this.coreModel.getModelContext()._$aS;(null==e?void 0:e.length)&&(this.drawDataCount=e.length);let t=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,'culling',{set:e=>t=e,get:()=>!this.disableCulling&&t});const i=this.coreModel.getModelContext().clipManager,s=i.setupClip;i.setupClip=(e,t)=>{s.call(i,e,t),t.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const e={};if(this.settings.layout)for(const[t,i]of Object.entries(this.settings.layout)){let s=t;'center_x'===t?s='centerX':'center_y'===t&&(s='centerY'),e[s]=i}return e}updateWebGLContext(e,t){const i=this.coreModel.drawParamWebGL;i.firstDraw=!0,i.setGL(e),i.glno=t;for(const[e,t]of Object.entries(i))t instanceof WebGLBuffer&&(i[e]=null);const s=this.coreModel.getModelContext().clipManager;s.curFrameNo=t;const o=e.getParameter(e.FRAMEBUFFER_BINDING);s.getMaskRenderTexture(),e.bindFramebuffer(e.FRAMEBUFFER,o)}bindTexture(e,t){this.coreModel.setTexture(e,t)}getHitAreaDefs(){var e;return(null==(e=this.settings.hitAreas)?void 0:e.map(e=>({id:e.id,name:e.name,index:this.coreModel.getDrawDataIndex(e.id)})))||[]}getDrawableIDs(){const e=this.coreModel.getModelContext(),t=[];for(let i=0;i<this.drawDataCount;i++){const s=e.getDrawData(i);s&&t.push(s.getDrawDataID().id)}return t}getDrawableIndex(e){return this.coreModel.getDrawDataIndex(e)}getDrawableVertices(e){if('string'==typeof e&&-1===(e=this.coreModel.getDrawDataIndex(e)))throw new TypeError('Unable to find drawable ID: '+e);return this.coreModel.getTransformedPoints(e).slice()}hitTest(e,t){return this.hasDrawn||P.warn('Trying to hit-test a Cubism 2 model that has not been rendered yet. The result will always be empty since the draw data is not ready.'),super.hitTest(e,t)}update(e,t){var i,s,o,r;super.update(e,t);const a=this.coreModel;this.emit('beforeMotionUpdate');const n=this.motionManager.update(this.coreModel,t);this.emit('afterMotionUpdate'),a.saveParam(),null==(i=this.motionManager.expressionManager)||i.update(a,t),n||null==(s=this.eyeBlink)||s.update(e),this.updateFocus(),this.updateNaturalMovements(e,t),null==(o=this.physics)||o.update(t),null==(r=this.pose)||r.update(e),this.emit('beforeModelUpdate'),a.update(),a.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,30*this.focusController.x),this.coreModel.addToParamFloat(this.angleYParamIndex,30*this.focusController.y),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,10*this.focusController.x)}updateNaturalMovements(e,t){const i=t/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(i/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(i/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(i/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(i/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(i/3.2345))}draw(e){const t=this.disableCulling;e.getParameter(e.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const i=this.drawingMatrix;we[0]=i.a,we[1]=i.b,we[4]=i.c,we[5]=i.d,we[12]=i.tx,we[13]=i.ty,this.coreModel.setMatrix(we),this.coreModel.draw(),this.hasDrawn=!0,this.disableCulling=t}destroy(){super.destroy(),this.coreModel=void 0}}class ke extends D{constructor(e){if(super(e),h(this,'moc'),h(this,'textures'),h(this,'layout'),h(this,'hitAreas'),h(this,'initParams'),h(this,'initOpacities'),h(this,'expressions'),h(this,'motions',{}),!ke.isValidJSON(e))throw new TypeError('Invalid JSON.');this.moc=e.model,T('string',e,this,'textures','textures'),this.copy(e)}static isValidJSON(e){var t;return!!e&&'string'==typeof e.model&&(null==(t=e.textures)?void 0:t.length)>0&&e.textures.every(e=>'string'==typeof e)}copy(e){I('string',e,this,'name','name'),I('string',e,this,'pose','pose'),I('string',e,this,'physics','physics'),I('object',e,this,'layout','layout'),I('object',e,this,'motions','motions'),T('object',e,this,'hit_areas','hitAreas'),T('object',e,this,'expressions','expressions'),T('object',e,this,'init_params','initParams'),T('object',e,this,'init_opacities','initOpacities')}replaceFiles(e){super.replaceFiles(e);for(const[t,i]of Object.entries(this.motions))for(let s=0;s<i.length;s++)i[s].file=e(i[s].file,`motions.${t}[${s}].file`),void 0!==i[s].sound&&(i[s].sound=e(i[s].sound,`motions.${t}[${s}].sound`));if(this.expressions)for(let t=0;t<this.expressions.length;t++)this.expressions[t].file=e(this.expressions[t].file,`expressions[${t}].file`)}}const Se={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},Pe={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class Ee{constructor(e,t){h(this,'physicsHairs',[]),this.coreModel=e,t.physics_hair&&(this.physicsHairs=t.physics_hair.map(e=>{const t=new PhysicsHair;return t.setup(e.setup.length,e.setup.regist,e.setup.mass),e.src.forEach(({id:e,ptype:i,scale:s,weight:o})=>{const r=Se[i];r&&t.addSrcParam(r,e,s,o)}),e.targets.forEach(({id:e,ptype:i,scale:s,weight:o})=>{const r=Pe[i];r&&t.addTargetParam(r,e,s,o)}),t}))}update(e){this.physicsHairs.forEach(t=>t.update(this.coreModel,e))}}class Ie{constructor(e){h(this,'paramIndex',-1),h(this,'partsIndex',-1),h(this,'link',[]),this.id=e}initIndex(e){this.paramIndex=e.getParamIndex('VISIBLE:'+this.id),this.partsIndex=e.getPartsDataIndex(PartsDataID.getID(this.id)),e.setParamFloat(this.paramIndex,1)}}class Te{constructor(e,t){h(this,'opacityAnimDuration',500),h(this,'partsGroups',[]),this.coreModel=e,t.parts_visible&&(this.partsGroups=t.parts_visible.map(({group:e})=>e.map(({id:e,link:t})=>{const i=new Ie(e);return t&&(i.link=t.map(e=>new Ie(e))),i})),this.init())}init(){this.partsGroups.forEach(e=>{e.forEach(e=>{if(e.initIndex(this.coreModel),e.paramIndex>=0){const t=0!==this.coreModel.getParamFloat(e.paramIndex);this.coreModel.setPartsOpacity(e.partsIndex,t?1:0),this.coreModel.setParamFloat(e.paramIndex,t?1:0),e.link.length>0&&e.link.forEach(e=>e.initIndex(this.coreModel))}})})}normalizePartsOpacityGroup(e,t){const i=this.coreModel,s=.5;let o=1,r=e.findIndex(({paramIndex:e,partsIndex:t})=>t>=0&&0!==i.getParamFloat(e));if(r>=0){const s=i.getPartsOpacity(e[r].partsIndex);o=E(s+t/this.opacityAnimDuration,0,1)}else r=0,o=1;e.forEach(({partsIndex:e},t)=>{if(e>=0)if(r==t)i.setPartsOpacity(e,o);else{let t,r=i.getPartsOpacity(e);t=o<s?-.5*o/s+1:(1-o)*s/.5;(1-t)*(1-o)>.15&&(t=1-.15/(1-o)),r>t&&(r=t),i.setPartsOpacity(e,r)}})}copyOpacity(e){const t=this.coreModel;e.forEach(({partsIndex:e,link:i})=>{if(e>=0&&i){const s=t.getPartsOpacity(e);i.forEach(({partsIndex:e})=>{e>=0&&t.setPartsOpacity(e,s)})}})}update(e){this.partsGroups.forEach(t=>{this.normalizePartsOpacityGroup(t,e),this.copyOpacity(t)})}}if(le.registerRuntime({version:2,test:e=>e instanceof ke||ke.isValidJSON(e),ready:()=>Promise.resolve(),isValidMoc(e){if(e.byteLength<3)return!1;const t=new Int8Array(e,0,3);return'moc'===String.fromCharCode(...t)},createModelSettings:e=>new ke(e),createCoreModel(e){const t=Live2DModelWebGL.loadModel(e),i=Live2D.getError();if(i)throw i;return t},createInternalModel:(e,t,i)=>new Me(e,t,i),createPose:(e,t)=>new Te(e,t),createPhysics:(e,t)=>new Ee(e,t)}),!window.Live2DCubismCore)throw new Error('Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.');class Be{constructor(e,t){this.x=e||0,this.y=t||0}add(e){const t=new Be(0,0);return t.x=this.x+e.x,t.y=this.y+e.y,t}substract(e){const t=new Be(0,0);return t.x=this.x-e.x,t.y=this.y-e.y,t}multiply(e){const t=new Be(0,0);return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByScaler(e){return this.multiply(new Be(e,e))}division(e){const t=new Be(0,0);return t.x=this.x/e.x,t.y=this.y/e.y,t}divisionByScalar(e){return this.division(new Be(e,e))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}dot(e){return this.x*e.x+this.y*e.y}normalize(){const e=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/e,this.y=this.y/e}isEqual(e){return this.x==e.x&&this.y==e.y}isNotEqual(e){return!this.isEqual(e)}}const Le=class e{static range(e,t,i){return e<t?e=t:e>i&&(e=i),e}static sin(e){return Math.sin(e)}static cos(e){return Math.cos(e)}static abs(e){return Math.abs(e)}static sqrt(e){return Math.sqrt(e)}static cbrt(e){if(0===e)return e;let t=e;const i=t<0;let s;return i&&(t=-t),t===1/0?s=1/0:(s=Math.exp(Math.log(t)/3),s=(t/(s*s)+2*s)/3),i?-s:s}static getEasingSine(e){return e<0?0:e>1?1:.5-.5*this.cos(e*Math.PI)}static max(e,t){return e>t?e:t}static min(e,t){return e>t?t:e}static degreesToRadian(e){return e/180*Math.PI}static radianToDegrees(e){return 180*e/Math.PI}static directionToRadian(e,t){let i=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}static directionToDegrees(e,t){const i=this.directionToRadian(e,t);let s=this.radianToDegrees(i);return t.x-e.x>0&&(s=-s),s}static radianToDirection(e){const t=new Be;return t.x=this.sin(e),t.y=this.cos(e),t}static quadraticEquation(t,i,s){return this.abs(t)<e.Epsilon?this.abs(i)<e.Epsilon?-s:-s/i:-(i+this.sqrt(i*i-4*t*s))/(2*t)}static cardanoAlgorithmForBezier(t,i,s,o){if(this.sqrt(t)<e.Epsilon)return this.range(this.quadraticEquation(i,s,o),0,1);const r=i/t,a=s/t,n=(3*a-r*r)/3,l=n/3,c=(2*r*r*r-9*r*a+27*(o/t))/27,d=c/2,u=d*d+l*l*l,h=.5,m=.51;if(u<0){const e=-n/3,t=e*e*e,i=this.sqrt(t),s=-c/(2*i),o=this.range(s,-1,1),a=Math.acos(o),l=2*this.cbrt(i),d=l*this.cos(a/3)-r/3;if(this.abs(d-h)<m)return this.range(d,0,1);const u=l*this.cos((a+2*Math.PI)/3)-r/3;if(this.abs(u-h)<m)return this.range(u,0,1);const p=l*this.cos((a+4*Math.PI)/3)-r/3;return this.range(p,0,1)}if(0==u){let e;e=d<0?this.cbrt(-d):-this.cbrt(d);const t=2*e-r/3;if(this.abs(t-h)<m)return this.range(t,0,1);const i=-e-r/3;return this.range(i,0,1)}const p=this.sqrt(u),g=this.cbrt(p-d)-this.cbrt(p+d)-r/3;return this.range(g,0,1)}constructor(){}};Le.Epsilon=1e-5;let Ve=Le;class Ne{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(e,t,i){const s=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let i=0;i<4;++i)for(let o=0;o<4;++o)for(let r=0;r<4;++r)s[o+4*i]+=e[r+4*i]*t[o+4*r];for(let e=0;e<16;++e)i[e]=s[e]}loadIdentity(){const e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(e)}setMatrix(e){for(let t=0;t<16;++t)this._tr[t]=e[t]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(e){return this._tr[0]*e+this._tr[12]}transformY(e){return this._tr[5]*e+this._tr[13]}invertTransformX(e){return(e-this._tr[12])/this._tr[0]}invertTransformY(e){return(e-this._tr[13])/this._tr[5]}translateRelative(e,t){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);Ne.multiply(i,this._tr,this._tr)}translate(e,t){this._tr[12]=e,this._tr[13]=t}translateX(e){this._tr[12]=e}translateY(e){this._tr[13]=e}scaleRelative(e,t){const i=new Float32Array([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);Ne.multiply(i,this._tr,this._tr)}scale(e,t){this._tr[0]=e,this._tr[5]=t}multiplyByMatrix(e){Ne.multiply(e.getArray(),this._tr,this._tr)}clone(){const e=new Ne;for(let t=0;t<this._tr.length;t++)e._tr[t]=this._tr[t];return e}}class De{initialize(e){this._model=e}drawModel(){null!=this.getModel()&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(e){this._mvpMatrix4x4.setMatrix(e.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(e,t,i,s){e<0?e=0:e>1&&(e=1),t<0?t=0:t>1&&(t=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),this._modelColor.R=e,this._modelColor.G=t,this._modelColor.B=i,this._modelColor.A=s}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(e){this._isPremultipliedAlpha=e}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(e){this._isCulling=e}isCulling(){return this._isCulling}setAnisotropy(e){this._anisotropy=e}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(e){this._useHighPrecisionMask=e}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._modelColor=new Re,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new Ne,this._mvpMatrix4x4.loadIdentity()}}var Fe=(e=>(e[e.CubismBlendMode_Normal=0]='CubismBlendMode_Normal',e[e.CubismBlendMode_Additive=1]='CubismBlendMode_Additive',e[e.CubismBlendMode_Multiplicative=2]='CubismBlendMode_Multiplicative',e))(Fe||{});class Re{constructor(e=1,t=1,i=1,s=1){this.R=e,this.G=t,this.B=i,this.A=s}}let Ae,Oe=!1,Ue=!1;const ze=0,$e=2;class je{static startUp(e){if(Oe)return Xe('CubismFramework.startUp() is already done.'),Oe;if(Live2DCubismCore._isStarted)return Oe=!0,!0;if(Live2DCubismCore._isStarted=!0,Ae=e,Ae&&Live2DCubismCore.Logging.csmSetLogFunction(Ae.logFunction),Oe=!0,Oe){const e=Live2DCubismCore.Version.csmGetVersion(),t=(16711680&e)>>16,i=65535&e,s=e;Xe('Live2D Cubism Core version: {0}.{1}.{2} ({3})',('00'+((4278190080&e)>>24)).slice(-2),('00'+t).slice(-2),('0000'+i).slice(-4),s)}return Xe('CubismFramework.startUp() is complete.'),Oe}static cleanUp(){Oe=!1,Ue=!1,Ae=void 0}static initialize(e=0){Oe?Ue?Ye('CubismFramework.initialize() skipped, already initialized.'):(Live2DCubismCore.Memory.initializeAmountOfMemory(e),Ue=!0,Xe('CubismFramework.initialize() is complete.')):Ye('CubismFramework is not started.')}static dispose(){Oe?Ue?(De.staticRelease(),Ue=!1,Xe('CubismFramework.dispose() is complete.')):Ye('CubismFramework.dispose() skipped, not initialized.'):Ye('CubismFramework is not started.')}static isStarted(){return Oe}static isInitialized(){return Ue}static coreLogFunction(e){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(e)}static getLoggingLevel(){return null!=Ae?Ae.loggingLevel:5}constructor(){}}var Ge=(e=>(e[e.LogLevel_Verbose=0]='LogLevel_Verbose',e[e.LogLevel_Debug=1]='LogLevel_Debug',e[e.LogLevel_Info=2]='LogLevel_Info',e[e.LogLevel_Warning=3]='LogLevel_Warning',e[e.LogLevel_Error=4]='LogLevel_Error',e[e.LogLevel_Off=5]='LogLevel_Off',e))(Ge||{});const We=()=>{};function He(e,...t){Je.print(Ge.LogLevel_Debug,'[CSM][D]'+e+'\n',t)}function Xe(e,...t){Je.print(Ge.LogLevel_Info,'[CSM][I]'+e+'\n',t)}function Ye(e,...t){Je.print(Ge.LogLevel_Warning,'[CSM][W]'+e+'\n',t)}function qe(e,...t){Je.print(Ge.LogLevel_Error,'[CSM][E]'+e+'\n',t)}class Je{static print(e,t,i){if(e<je.getLoggingLevel())return;const s=je.coreLogFunction;if(!s)return;s(t.replace(/{(\d+)}/g,(e,t)=>i[t]))}static dumpBytes(e,t,i){for(let s=0;s<i;s++)s%16==0&&s>0?this.print(e,'\n'):s%8==0&&s>0&&this.print(e,'  '),this.print(e,'{0} ',[255&t[s]]);this.print(e,'\n')}constructor(){}}class Ze{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(e,t,i){if(!t.isAvailable()||t.isFinished())return;if(!t.isStarted()){t.setIsStarted(!0),t.setStartTime(i-this._offsetSeconds),t.setFadeInStartTime(i);const e=this.getDuration();t.getEndTime()<0&&t.setEndTime(e<=0?-1:t.getStartTime()+e)}let s=this._weight;s=s*(0==this._fadeInSeconds?1:Ve.getEasingSine((i-t.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||t.getEndTime()<0?1:Ve.getEasingSine((t.getEndTime()-i)/this._fadeOutSeconds)),t.setState(i,s),We(0<=s&&s<=1),this.doUpdateParameters(e,i,s,t),t.getEndTime()>0&&t.getEndTime()<i&&t.setIsFinished(!0)}setFadeInTime(e){this._fadeInSeconds=e}setFadeOutTime(e){this._fadeOutSeconds=e}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(e){this._weight=e}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(e){this._offsetSeconds=e}getFiredEvent(e,t){return this._firedEventValues}setFinishedMotionHandler(e){this._onFinishedMotion=e}getFinishedMotionHandler(){return this._onFinishedMotion}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(e){}getModelOpacityValue(){return 1}}class Ke extends Ze{constructor(){super(),this._parameters=[]}static create(e){const t=new Ke;return t.parse(e),t}doUpdateParameters(e,t,i,s){for(let t=0;t<this._parameters.length;++t){const s=this._parameters[t];switch(s.blendType){case 0:e.addParameterValueById(s.parameterId,s.value,i);break;case 1:e.multiplyParameterValueById(s.parameterId,s.value,i);break;case 2:e.setParameterValueById(s.parameterId,s.value,i)}}}parse(e){this.setFadeInTime(null!=e.FadeInTime?e.FadeInTime:1),this.setFadeOutTime(null!=e.FadeOutTime?e.FadeOutTime:1);const t=(e.Parameters||[]).length;for(let i=0;i<t;++i){const t=e.Parameters[i],s=t.Id,o=t.Value;let r;r=t.Blend&&'Add'!==t.Blend?'Multiply'===t.Blend?1:'Overwrite'===t.Blend?2:0:0;const a={parameterId:s,blendType:r,value:o};this._parameters.push(a)}}}class Qe{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(e){this._fadeOutSeconds=e,this._isTriggeredFadeOut=!0}startFadeOut(e,t){const i=t+e;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(e){this._startTimeSeconds=e}setFadeInStartTime(e){this._fadeInStartTimeSeconds=e}setEndTime(e){this._endTimeSeconds=e}setIsFinished(e){this._finished=e}setIsStarted(e){this._started=e}isAvailable(){return this._available}setIsAvailable(e){this._available=e}setState(e,t){this._stateTimeSeconds=e,this._stateWeight=t}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(e){this._lastEventCheckSeconds=e}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class et{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let e=0;e<this._motions.length;++e)this._motions[e]&&this._motions[e].release();this._motions=void 0}startMotion(e,t,i){if(null==e)return tt;let s;for(let e=0;e<this._motions.length;++e)s=this._motions[e],null!=s&&s.setFadeOut(s._motion.getFadeOutTime());return s=new Qe,s._autoDelete=t,s._motion=e,this._motions.push(s),s._motionQueueEntryHandle}isFinished(){let e=0;for(;e<this._motions.length;){const t=this._motions[e];if(null==t){this._motions.splice(e,1);continue}if(null!=t._motion){if(!t.isFinished())return!1;e++}else t.release(),this._motions.splice(e,1)}return!0}isFinishedByHandle(e){for(let t=0;t<this._motions.length;t++){const i=this._motions[t];if(null!=i&&(i._motionQueueEntryHandle==e&&!i.isFinished()))return!1}return!0}stopAllMotions(){for(let e=0;e<this._motions.length;e++){const t=this._motions[e];null!=t&&t.release()}this._motions=[]}getCubismMotionQueueEntry(e){return this._motions.find(t=>null!=t&&t._motionQueueEntryHandle==e)}setEventCallback(e,t=null){this._eventCallBack=e,this._eventCustomData=t}doUpdateMotion(e,t){let i=!1,s=0;for(;s<this._motions.length;){const o=this._motions[s];if(null==o){this._motions.splice(s,1);continue}const r=o._motion;if(null==r){o.release(),this._motions.splice(s,1);continue}r.updateParameters(e,o,t),i=!0;const a=r.getFiredEvent(o.getLastCheckEventSeconds()-o.getStartTime(),t-o.getStartTime());for(let e=0;e<a.length;++e)this._eventCallBack(this,a[e],this._eventCustomData);o.setLastCheckEventSeconds(t),o.isFinished()?(o.release(),this._motions.splice(s,1)):(o.isTriggeredFadeOut()&&o.startFadeOut(o.getFadeOutSeconds(),t),s++)}return i}}const tt=-1;class it extends B{constructor(e,t){var i;super(e,t),h(this,'queueManager',new et),h(this,'definitions'),this.definitions=null!=(i=e.expressions)?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(e){return this.definitions.findIndex(t=>t.Name===e)}getExpressionFile(e){return e.File}createExpression(e,t){return Ke.create(e)}_setExpression(e){return this.queueManager.startMotion(e,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.doUpdateMotion(e,t)}}var st=(e=>(e[e.CubismMotionCurveTarget_Model=0]='CubismMotionCurveTarget_Model',e[e.CubismMotionCurveTarget_Parameter=1]='CubismMotionCurveTarget_Parameter',e[e.CubismMotionCurveTarget_PartOpacity=2]='CubismMotionCurveTarget_PartOpacity',e))(st||{}),ot=(e=>(e[e.CubismMotionSegmentType_Linear=0]='CubismMotionSegmentType_Linear',e[e.CubismMotionSegmentType_Bezier=1]='CubismMotionSegmentType_Bezier',e[e.CubismMotionSegmentType_Stepped=2]='CubismMotionSegmentType_Stepped',e[e.CubismMotionSegmentType_InverseStepped=3]='CubismMotionSegmentType_InverseStepped',e))(ot||{});class rt{constructor(e=0,t=0){this.time=e,this.value=t}}class at{constructor(){this.basePointIndex=0,this.segmentType=0}}class nt{constructor(){this.id='',this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class lt{constructor(){this.fireTime=0,this.value=''}}class ct{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class dt{constructor(e){this._json=e}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(e){return 0==e&&!!this._json.Meta.AreBeziersRestricted}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(e){return this._json.Curves[e].Target}getMotionCurveId(e){return this._json.Curves[e].Id}getMotionCurveFadeInTime(e){return this._json.Curves[e].FadeInTime}getMotionCurveFadeOutTime(e){return this._json.Curves[e].FadeOutTime}getMotionCurveSegmentCount(e){return this._json.Curves[e].Segments.length}getMotionCurveSegment(e,t){return this._json.Curves[e].Segments[t]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(e){return this._json.UserData[e].Time}getEventValue(e){return this._json.UserData[e].Value}}var ut=(e=>(e[e.EvaluationOptionFlag_AreBeziersRistricted=0]='EvaluationOptionFlag_AreBeziersRistricted',e))(ut||{});const ht='Opacity';function mt(e,t,i){const s=new rt;return s.time=e.time+(t.time-e.time)*i,s.value=e.value+(t.value-e.value)*i,s}function pt(e,t){let i=(t-e[0].time)/(e[1].time-e[0].time);return i<0&&(i=0),e[0].value+(e[1].value-e[0].value)*i}function gt(e,t){let i=(t-e[0].time)/(e[3].time-e[0].time);i<0&&(i=0);const s=mt(e[0],e[1],i),o=mt(e[1],e[2],i),r=mt(e[2],e[3],i),a=mt(s,o,i),n=mt(o,r,i);return mt(a,n,i).value}function vt(e,t){const i=t,s=e[0].time,o=e[3].time,r=e[1].time,a=e[2].time,n=o-3*a+3*r-s,l=3*a-6*r+3*s,c=3*r-3*s,d=s-i,u=Ve.cardanoAlgorithmForBezier(n,l,c,d),h=mt(e[0],e[1],u),m=mt(e[1],e[2],u),p=mt(e[2],e[3],u),g=mt(h,m,u),v=mt(m,p,u);return mt(g,v,u).value}function ft(e,t){return e[0].value}function xt(e,t){return e[1].value}function yt(e,t,i){const s=e.curves[t];let o=-1;const r=s.baseSegmentIndex+s.segmentCount;let a=0;for(let t=s.baseSegmentIndex;t<r;++t)if(a=e.segments[t].basePointIndex+(e.segments[t].segmentType==ot.CubismMotionSegmentType_Bezier?3:1),e.points[a].time>i){o=t;break}if(-1==o)return e.points[a].value;const n=e.segments[o];return n.evaluate(e.points.slice(n.basePointIndex),i)}class _t extends Ze{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._modelOpacity=1}static create(e,t){const i=new _t;return i.parse(e),i._sourceFrameRate=i._motionData.fps,i._loopDurationSeconds=i._motionData.duration,i._onFinishedMotion=t,i}doUpdateParameters(e,t,i,s){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink='EyeBlink'),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync='LipSync'),null==this._modelCurveIdOpacity&&(this._modelCurveIdOpacity=ht);let o=t-s.getStartTime();o<0&&(o=0);let r=Number.MAX_VALUE,a=Number.MAX_VALUE;const n=64;let l=0,c=0;this._eyeBlinkParameterIds.length>n&&He('too many eye blink targets : {0}',this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>n&&He('too many lip sync targets : {0}',this._lipSyncParameterIds.length);const d=this._fadeInSeconds<=0?1:Ve.getEasingSine((t-s.getFadeInStartTime())/this._fadeInSeconds),u=this._fadeOutSeconds<=0||s.getEndTime()<0?1:Ve.getEasingSine((s.getEndTime()-t)/this._fadeOutSeconds);let h,m,g,v=o;if(this._isLoop)for(;v>this._motionData.duration;)v-=this._motionData.duration;const f=this._motionData.curves;for(m=0;m<this._motionData.curveCount&&f[m].type==st.CubismMotionCurveTarget_Model;++m)h=yt(this._motionData,m,v),f[m].id==this._modelCurveIdEyeBlink?a=h:f[m].id==this._modelCurveIdLipSync?r=h:f[m].id==this._modelCurveIdOpacity&&(this._modelOpacity=h,e.setModelOapcity(this.getModelOpacityValue()));for(;m<this._motionData.curveCount&&f[m].type==st.CubismMotionCurveTarget_Parameter;++m){if(g=e.getParameterIndex(f[m].id),-1==g)continue;const o=e.getParameterValueByIndex(g);if(h=yt(this._motionData,m,v),a!=Number.MAX_VALUE)for(let e=0;e<this._eyeBlinkParameterIds.length&&e<n;++e)if(this._eyeBlinkParameterIds[e]==f[m].id){h*=a,c|=1<<e;break}if(r!=Number.MAX_VALUE)for(let e=0;e<this._lipSyncParameterIds.length&&e<n;++e)if(this._lipSyncParameterIds[e]==f[m].id){h+=r,l|=1<<e;break}let p;if(f[m].fadeInTime<0&&f[m].fadeOutTime<0)p=o+(h-o)*i;else{let e,i;e=f[m].fadeInTime<0?d:0==f[m].fadeInTime?1:Ve.getEasingSine((t-s.getFadeInStartTime())/f[m].fadeInTime),i=f[m].fadeOutTime<0?u:0==f[m].fadeOutTime||s.getEndTime()<0?1:Ve.getEasingSine((s.getEndTime()-t)/f[m].fadeOutTime);p=o+(h-o)*(this._weight*e*i)}e.setParameterValueByIndex(g,p,1)}if(a!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.length&&t<n;++t){const s=e.getParameterValueById(this._eyeBlinkParameterIds[t]);if(c>>t&1)continue;const o=s+(a-s)*i;e.setParameterValueById(this._eyeBlinkParameterIds[t],o)}if(r!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.length&&t<n;++t){const s=e.getParameterValueById(this._lipSyncParameterIds[t]);if(l>>t&1)continue;const o=s+(r-s)*i;e.setParameterValueById(this._lipSyncParameterIds[t],o)}for(;m<this._motionData.curveCount&&f[m].type==st.CubismMotionCurveTarget_PartOpacity;++m)if(h=yt(this._motionData,m,v),p.setOpacityFromMotion)e.setPartOpacityById(f[m].id,h);else{if(g=e.getParameterIndex(f[m].id),-1==g)continue;e.setParameterValueByIndex(g,h)}o>=this._motionData.duration&&(this._isLoop?(s.setStartTime(t),this._isLoopFadeIn&&s.setFadeInStartTime(t)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(e){this._isLoop=e}isLoop(){return this._isLoop}setIsLoopFadeIn(e){this._isLoopFadeIn=e}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(e,t){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(e==i[s].id)return void(i[s].fadeInTime=t)}setParameterFadeOutTime(e,t){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(e==i[s].id)return void(i[s].fadeOutTime=t)}getParameterFadeInTime(e){const t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t[i].id)return t[i].fadeInTime;return-1}getParameterFadeOutTime(e){const t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t[i].id)return t[i].fadeOutTime;return-1}setEffectIds(e,t){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=t}release(){this._motionData=void 0}parse(e){this._motionData=new ct;const t=new dt(e);this._motionData.duration=t.getMotionDuration(),this._motionData.loop=t.isMotionLoop(),this._motionData.curveCount=t.getMotionCurveCount(),this._motionData.fps=t.getMotionFps(),this._motionData.eventCount=t.getEventCount();const i=t.getEvaluationOptionFlag(ut.EvaluationOptionFlag_AreBeziersRistricted),s=t.getMotionFadeInTime(),o=t.getMotionFadeOutTime();this._fadeInSeconds=void 0!==s?s<0?1:s:1,this._fadeOutSeconds=void 0!==o?o<0?1:o:1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new nt),this._motionData.segments=Array.from({length:t.getMotionTotalSegmentCount()}).map(()=>new at),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new lt),this._motionData.points=[];let r=0,a=0;for(let e=0;e<this._motionData.curveCount;++e){const s=this._motionData.curves[e];switch(t.getMotionCurveTarget(e)){case'Model':s.type=st.CubismMotionCurveTarget_Model;break;case'Parameter':s.type=st.CubismMotionCurveTarget_Parameter;break;case'PartOpacity':s.type=st.CubismMotionCurveTarget_PartOpacity;break;default:Ye('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}s.id=t.getMotionCurveId(e),s.baseSegmentIndex=a;const o=t.getMotionCurveFadeInTime(e),n=t.getMotionCurveFadeOutTime(e);s.fadeInTime=void 0!==o?o:-1,s.fadeOutTime=void 0!==n?n:-1;for(let o=0;o<t.getMotionCurveSegmentCount(e);){0==o?(this._motionData.segments[a].basePointIndex=r,this._motionData.points[r]=new rt(t.getMotionCurveSegment(e,o),t.getMotionCurveSegment(e,o+1)),r+=1,o+=2):this._motionData.segments[a].basePointIndex=r-1;switch(t.getMotionCurveSegment(e,o)){case ot.CubismMotionSegmentType_Linear:this._motionData.segments[a].segmentType=ot.CubismMotionSegmentType_Linear,this._motionData.segments[a].evaluate=pt,this._motionData.points[r]=new rt(t.getMotionCurveSegment(e,o+1),t.getMotionCurveSegment(e,o+2)),r+=1,o+=3;break;case ot.CubismMotionSegmentType_Bezier:this._motionData.segments[a].segmentType=ot.CubismMotionSegmentType_Bezier,this._motionData.segments[a].evaluate=i?gt:vt,this._motionData.points[r]=new rt(t.getMotionCurveSegment(e,o+1),t.getMotionCurveSegment(e,o+2)),this._motionData.points[r+1]=new rt(t.getMotionCurveSegment(e,o+3),t.getMotionCurveSegment(e,o+4)),this._motionData.points[r+2]=new rt(t.getMotionCurveSegment(e,o+5),t.getMotionCurveSegment(e,o+6)),r+=3,o+=7;break;case ot.CubismMotionSegmentType_Stepped:this._motionData.segments[a].segmentType=ot.CubismMotionSegmentType_Stepped,this._motionData.segments[a].evaluate=ft,this._motionData.points[r]=new rt(t.getMotionCurveSegment(e,o+1),t.getMotionCurveSegment(e,o+2)),r+=1,o+=3;break;case ot.CubismMotionSegmentType_InverseStepped:this._motionData.segments[a].segmentType=ot.CubismMotionSegmentType_InverseStepped,this._motionData.segments[a].evaluate=xt,this._motionData.points[r]=new rt(t.getMotionCurveSegment(e,o+1),t.getMotionCurveSegment(e,o+2)),r+=1,o+=3;break;default:We(0)}++s.segmentCount,++a}this._motionData.curves.push(s)}for(let e=0;e<t.getEventCount();++e)this._motionData.events[e].fireTime=t.getEventTime(e),this._motionData.events[e].value=t.getEventValue(e);t.release()}getFiredEvent(e,t){this._firedEventValues.length=0;for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events[i].fireTime>e&&this._motionData.events[i].fireTime<=t&&this._firedEventValues.push(this._motionData.events[i].value);return this._firedEventValues}isExistModelOpacity(){for(let e=0;e<this._motionData.curveCount;e++){const t=this._motionData.curves[e];if(t.type==st.CubismMotionCurveTarget_Model&&t.id===ht)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let e=0;e<this._motionData.curveCount;e++){const t=this._motionData.curves[e];if(t.type==st.CubismMotionCurveTarget_Model&&t.id===ht)return e}return-1}getModelOpacityId(e){if(-1!=e){const t=this._motionData.curves[e];if(t.type==st.CubismMotionCurveTarget_Model&&t.id===ht)return t.id}}getModelOpacityValue(){return this._modelOpacity}}class Ct extends O{constructor(e,t){var i;super(e,t),h(this,'definitions'),h(this,'groups',{idle:'Idle'}),h(this,'motionDataType','json'),h(this,'queueManager',new et),h(this,'expressionManager'),h(this,'eyeBlinkIds'),h(this,'lipSyncIds'),this.definitions=null!=(i=e.motions)?i:{},this.eyeBlinkIds=e.getEyeBlinkParameters()||[],this.lipSyncIds=e.getLipSyncParameters()||[],this.init(t)}init(e){super.init(e),this.settings.expressions&&(this.expressionManager=new it(this.settings,e)),this.queueManager.setEventCallback((e,t,i)=>{this.emit('motion:'+t)})}isFinished(){return this.queueManager.isFinished()}_startMotion(e,t){return e.setFinishedMotionHandler(t),this.queueManager.stopAllMotions(),this.queueManager.startMotion(e,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(e,t,i){const s=_t.create(e),o=new dt(e),r=(t===this.groups.idle?M:w)/1e3;return void 0===o.getMotionFadeInTime()&&s.setFadeInTime(i.FadeInTime>0?i.FadeInTime:r),void 0===o.getMotionFadeOutTime()&&s.setFadeOutTime(i.FadeOutTime>0?i.FadeOutTime:r),s.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),s}getMotionFile(e){return e.File}getMotionName(e){return e.File}getSoundFile(e){return e.Sound}updateParameters(e,t){return this.queueManager.doUpdateMotion(e,t)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}class bt{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new bt}setParameters(e){this._breathParameters=e}getParameters(){return this._breathParameters}updateParameters(e,t){this._currentTime+=t;const i=2*this._currentTime*3.14159;for(let t=0;t<this._breathParameters.length;++t){const s=this._breathParameters[t];e.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(i/s.cycle),s.weight)}}}class wt{constructor(e,t,i,s,o){this.parameterId=null==e?void 0:e,this.offset=null==t?0:t,this.peak=null==i?0:i,this.cycle=null==s?0:s,this.weight=null==o?0:o}}const Mt=class e{static create(t){return new e(t)}setBlinkingInterval(e){this._blinkingIntervalSeconds=e}setBlinkingSetting(e,t,i){this._closingSeconds=e,this._closedSeconds=t,this._openingSeconds=i}setParameterIds(e){this._parameterIds=e}getParameterIds(){return this._parameterIds}updateParameters(t,i){let s;this._userTimeSeconds+=i;let o=0;switch(this._blinkingState){case 2:o=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,o>=1&&(o=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),s=1-o;break;case 3:o=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,o>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),s=0;break;case 4:o=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,o>=1&&(o=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),s=o;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),s=1;break;default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),s=1}e.CloseIfZero||(s=-s);for(let e=0;e<this._parameterIds.length;++e)t.setParameterValueById(this._parameterIds[e],s)}constructor(e){var t,i;this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],null!=e&&(this._parameterIds=null!=(i=null==(t=e.getEyeBlinkParameters())?void 0:t.slice())?i:this._parameterIds)}determinNextBlinkingTiming(){const e=Math.random();return this._userTimeSeconds+e*(2*this._blinkingIntervalSeconds-1)}};Mt.CloseIfZero=!0;let kt=Mt;class St{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}expand(e,t){this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t}}let Pt,Et,It;class Tt{getChannelFlagAsColor(e){return this._channelColors[e]}getMaskRenderTexture(){if(this._maskTexture&&null!=this._maskTexture.textures)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures=[],this._maskColorBuffers=[];const e=this._clippingMaskBufferSize;for(let t=0;t<this._renderTextureCount;t++)this._maskColorBuffers.push(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers[t]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.push(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures[t]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers[t],0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,It),this._maskTexture=new Bt(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(e){this.gl=e}calcClippedDrawTotalBounds(e,t){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,o=Number.MIN_VALUE,r=Number.MIN_VALUE;const a=t._clippedDrawableIndexList.length;for(let n=0;n<a;n++){const a=t._clippedDrawableIndexList[n],l=e.getDrawableVertexCount(a),c=e.getDrawableVertices(a);let d=Number.MAX_VALUE,u=Number.MAX_VALUE,h=-Number.MAX_VALUE,m=-Number.MAX_VALUE;const p=l*$e;for(let e=ze;e<p;e+=$e){const t=c[e],i=c[e+1];t<d&&(d=t),t>h&&(h=t),i<u&&(u=i),i>m&&(m=i)}if(d!=Number.MAX_VALUE)if(d<i&&(i=d),u<s&&(s=u),h>o&&(o=h),m>r&&(r=m),i==Number.MAX_VALUE)t._allClippedDrawRect.x=0,t._allClippedDrawRect.y=0,t._allClippedDrawRect.width=0,t._allClippedDrawRect.height=0,t._isUsing=!1;else{t._isUsing=!0;const e=o-i,a=r-s;t._allClippedDrawRect.x=i,t._allClippedDrawRect.y=s,t._allClippedDrawRect.width=e,t._allClippedDrawRect.height=a}}}constructor(){this._currentMaskRenderTexture=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new St,this._tmpMatrix=new Ne,this._tmpMatrixForMask=new Ne,this._tmpMatrixForDraw=new Ne;let e=new Re;e.R=1,e.G=0,e.B=0,e.A=0,this._channelColors.push(e),e=new Re,e.R=0,e.G=1,e.B=0,e.A=0,this._channelColors.push(e),e=new Re,e.R=0,e.G=0,e.B=1,e.A=0,this._channelColors.push(e),e=new Re,e.R=0,e.G=0,e.B=0,e.A=1,this._channelColors.push(e)}release(){var e;const t=this;for(let t=0;t<this._clippingContextListForMask.length;t++)this._clippingContextListForMask[t]&&(null==(e=this._clippingContextListForMask[t])||e.release());if(t._clippingContextListForMask=void 0,t._clippingContextListForDraw=void 0,this._maskTexture){for(let e=0;e<this._maskTexture.textures.length;e++)this.gl.deleteFramebuffer(this._maskTexture.textures[e]);this._maskTexture=void 0}if(t._channelColors=void 0,this._maskColorBuffers)for(let e=0;e<this._maskColorBuffers.length;e++)this.gl.deleteTexture(this._maskColorBuffers[e]);this._maskColorBuffers=void 0,this._maskRenderTextures=void 0,this._clearedFrameBufferflags=void 0}initialize(e,t,i,s,o){o%1!=0&&(Ye('The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer.'),o=~~o),o<1&&Ye('The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1.'),this._renderTextureCount=o<1?1:o,this._clearedFrameBufferflags=[];for(let e=0;e<t;e++){if(s[e]<=0){this._clippingContextListForDraw.push(null);continue}let t=this.findSameClip(i[e],s[e]);null==t&&(t=new Lt(this,i[e],s[e]),this._clippingContextListForMask.push(t)),t.addClippedDrawable(e),this._clippingContextListForDraw.push(t)}}setupClippingContext(e,t){this._currentFrameNo++;let i=0;for(let t=0;t<this._clippingContextListForMask.length;t++){const s=this._clippingContextListForMask[t];this.calcClippedDrawTotalBounds(e,s),s._isUsing&&i++}if(i>0){this.setupLayoutBounds(t.isUsingHighPrecisionMask()?0:i),t.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture()[0],t.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags||(this._clearedFrameBufferflags=[]);for(let e=0;e<this._renderTextureCount;e++)this._clearedFrameBufferflags[e]=!1;for(let i=0;i<this._clippingContextListForMask.length;i++){const s=this._clippingContextListForMask[i],o=s._allClippedDrawRect,r=s._layoutBounds,a=.05;let n=0,l=0;const c=this.getMaskRenderTexture()[s._bufferIndex];if(this._currentMaskRenderTexture==c||t.isUsingHighPrecisionMask()||(this._currentMaskRenderTexture=c,t.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),t.isUsingHighPrecisionMask()){const t=e.getPixelsPerUnit(),i=s.getClippingManager()._clippingMaskBufferSize,c=r.width*i,d=r.height*i;this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.width*t>c?(this._tmpBoundsOnModel.expand(o.width*a,0),n=r.width/this._tmpBoundsOnModel.width):n=t/c,this._tmpBoundsOnModel.height*t>d?(this._tmpBoundsOnModel.expand(0,o.height*a),l=r.height/this._tmpBoundsOnModel.height):l=t/d}else this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.expand(o.width*a,o.height*a),n=r.width/this._tmpBoundsOnModel.width,l=r.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(r.x,r.y),this._tmpMatrix.scaleRelative(n,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(r.x,r.y),this._tmpMatrix.scaleRelative(n,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!t.isUsingHighPrecisionMask()){const i=s._clippingIdCount;for(let o=0;o<i;o++){const i=s._clippingIdList[o];e.getDrawableDynamicFlagVertexPositionsDidChange(i)&&(t.setIsCulling(0!=e.getDrawableCulling(i)),this._clearedFrameBufferflags[s._bufferIndex]||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags[s._bufferIndex]=!0),t.setClippingContextBufferForMask(s),t.drawMesh(e.getDrawableTextureIndex(i),e.getDrawableVertexIndexCount(i),e.getDrawableVertexCount(i),e.getDrawableVertexIndices(i),e.getDrawableVertices(i),e.getDrawableVertexUvs(i),e.getMultiplyColor(i),e.getScreenColor(i),e.getDrawableOpacity(i),Fe.CubismBlendMode_Normal,!1))}}}t.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,It),t.setClippingContextBufferForMask(null),this.gl.viewport(Et[0],Et[1],Et[2],Et[3]))}}findSameClip(e,t){for(let i=0;i<this._clippingContextListForMask.length;i++){const s=this._clippingContextListForMask[i],o=s._clippingIdCount;if(o!=t)continue;let r=0;for(let t=0;t<o;t++){const i=s._clippingIdList[t];for(let t=0;t<o;t++)if(e[t]==i){r++;break}}if(r==o)return s}return null}setupLayoutBounds(e){const t=this._renderTextureCount<=1?36:32*this._renderTextureCount;if(e<=0||e>t){e>t&&qe('not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}',e-t,this._renderTextureCount,e);for(let e=0;e<this._clippingContextListForMask.length;e++){const t=this._clippingContextListForMask[e];t._layoutChannelNo=0,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1,t._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let s=e/this._renderTextureCount,o=e%this._renderTextureCount;s=~~s,o=~~o;let r=s/4,a=s%4;r=~~r,a=~~a;let n=0;for(let s=0;s<this._renderTextureCount;s++)for(let l=0;l<4;l++){let c=r+(l<a?1:0);if(c<i&&l==(a+1>=4?0:a+1)&&(c+=s<o?1:0),0==c);else if(1==c){const e=this._clippingContextListForMask[n++];e._layoutChannelNo=l,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=s}else if(2==c)for(let e=0;e<c;e++){let t=e%2;t=~~t;const i=this._clippingContextListForMask[n++];i._layoutChannelNo=l,i._layoutBounds.x=.5*t,i._layoutBounds.y=0,i._layoutBounds.width=.5,i._layoutBounds.height=1,i._bufferIndex=s}else if(c<=4)for(let e=0;e<c;e++){let t=e%2,i=e/2;t=~~t,i=~~i;const o=this._clippingContextListForMask[n++];o._layoutChannelNo=l,o._layoutBounds.x=.5*t,o._layoutBounds.y=.5*i,o._layoutBounds.width=.5,o._layoutBounds.height=.5,o._bufferIndex=s}else if(c<=i)for(let e=0;e<c;e++){let t=e%3,i=e/3;t=~~t,i=~~i;const o=this._clippingContextListForMask[n++];o._layoutChannelNo=l,o._layoutBounds.x=t/3,o._layoutBounds.y=i/3,o._layoutBounds.width=1/3,o._layoutBounds.height=1/3,o._bufferIndex=s}else if(p.supportMoreMaskDivisions&&c<=16)for(let e=0;e<c;e++){let t=e%4,i=e/4;t=~~t,i=~~i;const o=this._clippingContextListForMask[n++];o._layoutChannelNo=l,o._layoutBounds.x=t/4,o._layoutBounds.y=i/4,o._layoutBounds.width=1/4,o._layoutBounds.height=1/4,o._bufferIndex=s}else{qe('not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}',e-t,this._renderTextureCount,e);for(let e=0;e<c;e++){const e=this._clippingContextListForMask[n++];e._layoutChannelNo=0,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.length}setClippingMaskBufferSize(e){this._clippingMaskBufferSize=e}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class Bt{constructor(e,t){this.frameNo=e,this.textures=t}}class Lt{constructor(e,t,i){this._isUsing=!1,this._owner=e,this._clippingIdList=t,this._clippingIdCount=i,this._allClippedDrawRect=new St,this._layoutBounds=new St,this._clippedDrawableIndexList=[],this._matrixForMask=new Ne,this._matrixForDraw=new Ne,this._bufferIndex=0}release(){const e=this;e._layoutBounds=void 0,e._allClippedDrawRect=void 0,e._clippedDrawableIndexList=void 0}addClippedDrawable(e){this._clippedDrawableIndexList.push(e)}getClippingManager(){return this._owner}setGl(e){this._owner.setGL(e)}}class Vt{setGlEnable(e,t){t?this.gl.enable(e):this.gl.disable(e)}setGlEnableVertexAttribArray(e,t){t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)}save(){null!=this.gl?(this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)):qe('\'gl\' is null. WebGLRenderingContext is required.\nPlease call \'CubimRenderer_WebGL.startUp\' function.')}restore(){null!=this.gl?(this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])):qe('\'gl\' is null. WebGLRenderingContext is required.\nPlease call \'CubimRenderer_WebGL.startUp\' function.')}setGl(e){this.gl=e}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class Nt{static getInstance(){return null==Pt?(Pt=new Nt,Pt):Pt}static deleteInstance(){Pt&&(Pt.release(),Pt=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(e,t,i,s,o,r,a,n,l,c,d,u,h,m,p){let g,v,f,x;h||qe('NoPremultipliedAlpha is not allowed'),0==this._shaderSets.length&&this.generateShaders();const y=e.getClippingContextBufferForMask();if(null!=y){const e=this._shaderSets[0];this.gl.useProgram(e.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(e.samplerTexture0Location,0),null==a.vertex&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(e.attributePositionLocation),this.gl.vertexAttribPointer(e.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==a.uv&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(e.attributeTexCoordLocation),this.gl.vertexAttribPointer(e.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const i=y._layoutChannelNo,o=y.getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(e.uniformChannelFlagLocation,o.R,o.G,o.B,o.A),this.gl.uniformMatrix4fv(e.uniformClipMatrixLocation,!1,y._matrixForMask.getArray());const n=y._layoutBounds;this.gl.uniform4f(e.uniformBaseColorLocation,2*n.x-1,2*n.y-1,2*n.getRight()-1,2*n.getBottom()-1),this.gl.uniform4f(e.uniformMultiplyColorLocation,d.R,d.G,d.B,d.A),this.gl.uniform4f(e.uniformScreenColorLocation,u.R,u.G,u.B,u.A),g=this.gl.ZERO,v=this.gl.ONE_MINUS_SRC_COLOR,f=this.gl.ZERO,x=this.gl.ONE_MINUS_SRC_ALPHA}else{const i=e.getClippingContextBufferForDraw(),o=null!=i?p?2:1:0;let n;switch(l){case Fe.CubismBlendMode_Normal:default:n=this._shaderSets[1+o],g=this.gl.ONE,v=this.gl.ONE_MINUS_SRC_ALPHA,f=this.gl.ONE,x=this.gl.ONE_MINUS_SRC_ALPHA;break;case Fe.CubismBlendMode_Additive:n=this._shaderSets[4+o],g=this.gl.ONE,v=this.gl.ONE,f=this.gl.ZERO,x=this.gl.ONE;break;case Fe.CubismBlendMode_Multiplicative:n=this._shaderSets[7+o],g=this.gl.DST_COLOR,v=this.gl.ONE_MINUS_SRC_ALPHA,f=this.gl.ZERO,x=this.gl.ONE}if(this.gl.useProgram(n.shaderProgram),null==a.vertex&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(n.attributePositionLocation),this.gl.vertexAttribPointer(n.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==a.uv&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(n.attributeTexCoordLocation),this.gl.vertexAttribPointer(n.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),null!=i){this.gl.activeTexture(this.gl.TEXTURE1);const t=i.getClippingManager().getColorBuffer()[e.getClippingContextBufferForDraw()._bufferIndex];this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(n.samplerTexture1Location,1),this.gl.uniformMatrix4fv(n.uniformClipMatrixLocation,!1,i._matrixForDraw.getArray());const s=i._layoutChannelNo,o=i.getClippingManager().getChannelFlagAsColor(s);this.gl.uniform4f(n.uniformChannelFlagLocation,o.R,o.G,o.B,o.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(n.samplerTexture0Location,0),this.gl.uniformMatrix4fv(n.uniformMatrixLocation,!1,m.getArray()),this.gl.uniform4f(n.uniformBaseColorLocation,c.R,c.G,c.B,c.A),this.gl.uniform4f(n.uniformMultiplyColorLocation,d.R,d.G,d.B,d.A),this.gl.uniform4f(n.uniformScreenColorLocation,u.R,u.G,u.B,u.A)}null==a.index&&(a.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(g,v,f,x)}releaseShaderProgram(){for(let e=0;e<this._shaderSets.length;e++)this.gl.deleteProgram(this._shaderSets[e].shaderProgram),this._shaderSets[e].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let e=0;e<10;e++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(Dt,Ft),this._shaderSets[1].shaderProgram=this.loadShaderProgram(Rt,Ot),this._shaderSets[2].shaderProgram=this.loadShaderProgram(At,Ut),this._shaderSets[3].shaderProgram=this.loadShaderProgram(At,zt),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,'a_position'),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,'a_texCoord'),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'s_texture0'),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_clipMatrix'),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_channelFlag'),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_baseColor'),this._shaderSets[0].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_multiplyColor'),this._shaderSets[0].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_screenColor'),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,'a_position'),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,'a_texCoord'),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'s_texture0'),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_matrix'),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_baseColor'),this._shaderSets[1].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_multiplyColor'),this._shaderSets[1].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_screenColor'),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,'a_position'),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,'a_texCoord'),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'s_texture0'),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'s_texture1'),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_matrix'),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_clipMatrix'),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_channelFlag'),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_baseColor'),this._shaderSets[2].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_multiplyColor'),this._shaderSets[2].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_screenColor'),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,'a_position'),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,'a_texCoord'),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'s_texture0'),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'s_texture1'),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_matrix'),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_clipMatrix'),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_channelFlag'),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_baseColor'),this._shaderSets[3].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_multiplyColor'),this._shaderSets[3].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_screenColor'),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,'a_position'),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,'a_texCoord'),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'s_texture0'),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_matrix'),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_baseColor'),this._shaderSets[4].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_multiplyColor'),this._shaderSets[4].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_screenColor'),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,'a_position'),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,'a_texCoord'),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'s_texture0'),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'s_texture1'),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_matrix'),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_clipMatrix'),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_channelFlag'),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_baseColor'),this._shaderSets[5].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_multiplyColor'),this._shaderSets[5].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_screenColor'),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,'a_position'),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,'a_texCoord'),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'s_texture0'),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'s_texture1'),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_matrix'),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_clipMatrix'),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_channelFlag'),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_baseColor'),this._shaderSets[6].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_multiplyColor'),this._shaderSets[6].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_screenColor'),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,'a_position'),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,'a_texCoord'),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'s_texture0'),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_matrix'),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_baseColor'),this._shaderSets[7].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_multiplyColor'),this._shaderSets[7].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_screenColor'),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,'a_position'),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,'a_texCoord'),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'s_texture0'),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'s_texture1'),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_matrix'),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_clipMatrix'),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_channelFlag'),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_baseColor'),this._shaderSets[8].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_multiplyColor'),this._shaderSets[8].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_screenColor'),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,'a_position'),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,'a_texCoord'),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'s_texture0'),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'s_texture1'),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_matrix'),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_clipMatrix'),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_channelFlag'),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_baseColor'),this._shaderSets[9].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_multiplyColor'),this._shaderSets[9].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_screenColor')}loadShaderProgram(e,t){const i=this.gl.createProgram(),s=this.compileShaderSource(this.gl.VERTEX_SHADER,e);if(!s)return qe('Vertex shader compile error!'),0;const o=this.compileShaderSource(this.gl.FRAGMENT_SHADER,t);if(!o)return qe('Vertex shader compile error!'),0;this.gl.attachShader(i,s),this.gl.attachShader(i,o),this.gl.linkProgram(i);return this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(s),this.gl.deleteShader(o),i):(qe('Failed to link program: {0}',i),this.gl.deleteShader(s),this.gl.deleteShader(o),i&&this.gl.deleteProgram(i),0)}compileShaderSource(e,t){const i=t,s=this.gl.createShader(e);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!s){qe('Shader compile log: {0} ',this.gl.getShaderInfoLog(s))}return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.deleteShader(s),null)}setGl(e){this.gl=e}}const Dt='attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}',Ft='precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}',Rt='attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}',At='attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}',Ot='precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}',Ut='precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}',zt='precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}';class $t extends De{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new Vt,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}initialize(e,t=1){e.isUsingMasking()&&(this._clippingManager=new Tt,this._clippingManager.initialize(e,e.getDrawableCount(),e.getDrawableMasks(),e.getDrawableMaskCounts(),t));for(let t=e.getDrawableCount()-1;t>=0;t--)this._sortedDrawableIndexList[t]=0;super.initialize(e)}bindTexture(e,t){this._textures[e]=t}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){if(!this._model.isUsingMasking())return;const t=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=new Tt,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),t)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}release(){var e,t,i;const s=this;this._clippingManager.release(),s._clippingManager=void 0,null==(e=this.gl)||e.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,null==(t=this.gl)||t.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,null==(i=this.gl)||i.deleteBuffer(this._bufferData.index),this._bufferData.index=null,s._bufferData=void 0,s._textures=void 0}doDrawModel(){if(null==this.gl)return void qe('\'gl\' is null. WebGLRenderingContext is required.\nPlease call \'CubimRenderer_WebGL.startUp\' function.');null!=this._clippingManager&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const e=this.getModel().getDrawableCount(),t=this.getModel().getDrawableRenderOrders();for(let i=0;i<e;++i){const e=t[i];this._sortedDrawableIndexList[e]=i}for(let t=0;t<e;++t){const e=this._sortedDrawableIndexList[t];if(!this.getModel().getDrawableDynamicFlagIsVisible(e))continue;const i=null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw()[e]:null;if(null!=i&&this.isUsingHighPrecisionMask()){i._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i.getClippingManager().getMaskRenderTexture()[i._bufferIndex]),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const e=i._clippingIdCount;for(let t=0;t<e;t++){const e=i._clippingIdList[t];this._model.getDrawableDynamicFlagVertexPositionsDidChange(e)&&(this.setIsCulling(0!=this._model.getDrawableCulling(e)),this.setClippingContextBufferForMask(i),this.drawMesh(this.getModel().getDrawableTextureIndex(e),this.getModel().getDrawableVertexIndexCount(e),this.getModel().getDrawableVertexCount(e),this.getModel().getDrawableVertexIndices(e),this.getModel().getDrawableVertices(e),this.getModel().getDrawableVertexUvs(e),this.getModel().getMultiplyColor(e),this.getModel().getScreenColor(e),this.getModel().getDrawableOpacity(e),Fe.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,It),this.setClippingContextBufferForMask(null),this.gl.viewport(Et[0],Et[1],Et[2],Et[3]),this.preDraw()}this.setClippingContextBufferForDraw(i),this.setIsCulling(this.getModel().getDrawableCulling(e)),this.drawMesh(this.getModel().getDrawableTextureIndex(e),this.getModel().getDrawableVertexIndexCount(e),this.getModel().getDrawableVertexCount(e),this.getModel().getDrawableVertexIndices(e),this.getModel().getDrawableVertices(e),this.getModel().getDrawableVertexUvs(e),this.getModel().getMultiplyColor(e),this.getModel().getScreenColor(e),this.getModel().getDrawableOpacity(e),this.getModel().getDrawableBlendMode(e),this.getModel().getDrawableInvertedMaskBit(e))}}drawMesh(e,t,i,s,o,r,a,n,l,c,d){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const u=this.getModelColor();null==this.getClippingContextBufferForMask()&&(u.A*=l,this.isPremultipliedAlpha()&&(u.R*=u.A,u.G*=u.A,u.B*=u.A));let h=null;null!=this._textures[e]&&(h=this._textures[e]),Nt.getInstance().setupShaderProgram(this,h,i,o,s,r,this._bufferData,l,c,u,a,n,this.isPremultipliedAlpha(),this.getMvpMatrix(),d),this.gl.drawElements(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){Nt.deleteInstance()}setRenderState(e,t){It=e,Et=t}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(const e of Object.entries(this._textures))this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(e){this.gl=e,this._clippingManager&&this._clippingManager.setGL(e),Nt.getInstance().setGl(e),this._rendererProfile.setGl(e),this._extension=this.gl.getExtension('EXT_texture_filter_anisotropic')||this.gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic')||this.gl.getExtension('MOZ_EXT_texture_filter_anisotropic')}}De.staticRelease=()=>{$t.doStaticRelease()};const jt=new Ne;class Gt extends j{constructor(t,i,s){super(),h(this,'settings'),h(this,'coreModel'),h(this,'motionManager'),h(this,'lipSync',!0),h(this,'breath',bt.create()),h(this,'eyeBlink'),h(this,'userData'),h(this,'renderer',new $t),h(this,'idParamAngleX','ParamAngleX'),h(this,'idParamAngleY','ParamAngleY'),h(this,'idParamAngleZ','ParamAngleZ'),h(this,'idParamEyeBallX','ParamEyeBallX'),h(this,'idParamEyeBallY','ParamEyeBallY'),h(this,'idParamBodyAngleX','ParamBodyAngleX'),h(this,'idParamBreath','ParamBreath'),h(this,'pixelsPerUnit',1),h(this,'centeringTransform',new e),this.coreModel=t,this.settings=i,this.motionManager=new Ct(i,s),this.init()}init(){var e;super.init(),(null==(e=this.settings.getEyeBlinkParameters())?void 0:e.length)&&(this.eyeBlink=kt.create(this.settings)),this.breath.setParameters([new wt(this.idParamAngleX,0,15,6.5345,.5),new wt(this.idParamAngleY,0,8,3.5345,.5),new wt(this.idParamAngleZ,0,10,5.5345,.5),new wt(this.idParamBodyAngleX,0,4,15.5345,.5),new wt(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const e={};if(this.settings.layout)for(const[t,i]of Object.entries(this.settings.layout)){e[t.charAt(0).toLowerCase()+t.slice(1)]=i}return e}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(e,t){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(e),this.renderer._clippingManager._currentFrameNo=t,this.renderer._clippingManager._maskTexture=void 0,Nt.getInstance()._shaderSets=[]}bindTexture(e,t){this.renderer.bindTexture(e,t)}getHitAreaDefs(){var e,t;return null!=(t=null==(e=this.settings.hitAreas)?void 0:e.map(e=>({id:e.Id,name:e.Name,index:this.coreModel.getDrawableIndex(e.Id)})))?t:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(e){return this.coreModel.getDrawableIndex(e)}getDrawableVertices(e){if('string'==typeof e&&-1===(e=this.coreModel.getDrawableIndex(e)))throw new TypeError('Unable to find drawable ID: '+e);const t=this.coreModel.getDrawableVertices(e).slice();for(let e=0;e<t.length;e+=2)t[e]=t[e]*this.pixelsPerUnit+this.originalWidth/2,t[e+1]=-t[e+1]*this.pixelsPerUnit+this.originalHeight/2;return t}updateTransform(e){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(e)}update(e,t){var i,s,o,r;super.update(e,t),e/=1e3,t/=1e3;const a=this.coreModel;this.emit('beforeMotionUpdate');const n=this.motionManager.update(this.coreModel,t);this.emit('afterMotionUpdate'),a.saveParameters(),null==(i=this.motionManager.expressionManager)||i.update(a,t),n||null==(s=this.eyeBlink)||s.updateParameters(a,e),this.updateFocus(),this.updateNaturalMovements(1e3*e,1e3*t),null==(o=this.physics)||o.evaluate(a,e),null==(r=this.pose)||r.updateParameters(a,e),this.emit('beforeModelUpdate'),a.update(),a.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,30*this.focusController.x),this.coreModel.addParameterValueById(this.idParamAngleY,30*this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,10*this.focusController.x)}updateNaturalMovements(e,t){var i;null==(i=this.breath)||i.updateParameters(this.coreModel,e/1e3)}draw(e){const t=this.drawingMatrix,i=jt.getArray();i[0]=t.a,i[1]=t.b,i[4]=-t.c,i[5]=-t.d,i[12]=t.tx,i[13]=t.ty,this.renderer.setMvpMatrix(jt),this.renderer.setRenderState(e.getParameter(e.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}class Wt{constructor(e){this.groups=e.Groups,this.hitAreas=e.HitAreas,this.layout=e.Layout,this.moc=e.FileReferences.Moc,this.expressions=e.FileReferences.Expressions,this.motions=e.FileReferences.Motions,this.textures=e.FileReferences.Textures,this.physics=e.FileReferences.Physics,this.pose=e.FileReferences.Pose}getEyeBlinkParameters(){var e,t;return null==(t=null==(e=this.groups)?void 0:e.find(e=>'EyeBlink'===e.Name))?void 0:t.Ids}getLipSyncParameters(){var e,t;return null==(t=null==(e=this.groups)?void 0:e.find(e=>'LipSync'===e.Name))?void 0:t.Ids}}class Ht extends D{constructor(e){if(super(e),h(this,'moc'),h(this,'textures'),!Ht.isValidJSON(e))throw new TypeError('Invalid JSON.');Object.assign(this,new Wt(e))}static isValidJSON(e){var t;return!!(null==e?void 0:e.FileReferences)&&'string'==typeof e.FileReferences.Moc&&(null==(t=e.FileReferences.Textures)?void 0:t.length)>0&&e.FileReferences.Textures.every(e=>'string'==typeof e)}replaceFiles(e){if(super.replaceFiles(e),this.motions)for(const[t,i]of Object.entries(this.motions))for(let s=0;s<i.length;s++)i[s].File=e(i[s].File,`motions.${t}[${s}].File`),void 0!==i[s].Sound&&(i[s].Sound=e(i[s].Sound,`motions.${t}[${s}].Sound`));if(this.expressions)for(let t=0;t<this.expressions.length;t++)this.expressions[t].File=e(this.expressions[t].File,`expressions[${t}].File`)}}var Xt;let Yt;Xt=Ht,[Wt].forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(t=>{'constructor'!==t&&Object.defineProperty(Xt.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t))})});let qt=20;class Jt{static create(e){const t=new Jt;'number'==typeof e.FadeInTime&&(t._fadeTimeSeconds=e.FadeInTime,t._fadeTimeSeconds<=0&&(t._fadeTimeSeconds=.5));const i=e.Groups,s=i.length;for(let e=0;e<s;++e){const s=i[e],o=s.length;let r=0;for(let e=0;e<o;++e){const i=s[e],o=new Zt;o.partId=i.Id;const a=i.Link;if(a){const e=a.length;for(let t=0;t<e;++t){const e=new Zt;e.partId=a[t],o.link.push(e)}}t._partGroups.push(o),++r}t._partGroupCounts.push(r)}return t}updateParameters(e,t){e!=this._lastModel&&this.reset(e),this._lastModel=e,t<0&&(t=0);let i=0;for(let s=0;s<this._partGroupCounts.length;s++){const o=this._partGroupCounts[s];this.doFade(e,t,i,o),i+=o}this.copyPartOpacities(e)}reset(e){let t=0;for(let i=0;i<this._partGroupCounts.length;++i){const s=this._partGroupCounts[i];for(let i=t;i<t+s;++i){this._partGroups[i].initialize(e);const s=this._partGroups[i].partIndex,o=this._partGroups[i].parameterIndex;if(!(s<0)){e.setPartOpacityByIndex(s,i==t?1:0),e.setParameterValueByIndex(o,i==t?1:0);for(let t=0;t<this._partGroups[i].link.length;++t)this._partGroups[i].link[t].initialize(e)}}t+=s}}copyPartOpacities(e){for(let t=0;t<this._partGroups.length;++t){const i=this._partGroups[t];if(0==i.link.length)continue;const s=this._partGroups[t].partIndex,o=e.getPartOpacityByIndex(s);for(let t=0;t<i.link.length;++t){const s=i.link[t].partIndex;s<0||e.setPartOpacityByIndex(s,o)}}}doFade(e,t,i,s){let o=-1,r=1;const a=.5;for(let a=i;a<i+s;++a){const i=this._partGroups[a].partIndex,s=this._partGroups[a].parameterIndex;if(e.getParameterValueByIndex(s)>.001){if(o>=0)break;o=a,r=e.getPartOpacityByIndex(i),r+=t/this._fadeTimeSeconds,r>1&&(r=1)}}o<0&&(o=0,r=1);for(let t=i;t<i+s;++t){const i=this._partGroups[t].partIndex;if(o==t)e.setPartOpacityByIndex(i,r);else{let t,s=e.getPartOpacityByIndex(i);t=r<a?-.5*r/a+1:(1-r)*a/.5;(1-t)*(1-r)>.15&&(t=1-.15/(1-r)),s>t&&(s=t),e.setPartOpacityByIndex(i,s)}}}constructor(){this._fadeTimeSeconds=.5,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class Zt{constructor(e){this.parameterIndex=0,this.partIndex=0,this.partId='',this.link=[],null!=e&&this.assignment(e)}assignment(e){return this.partId=e.partId,this.link=e.link.map(e=>e.clone()),this}initialize(e){this.parameterIndex=e.getParameterIndex(this.partId),this.partIndex=e.getPartIndex(this.partId),e.setParameterValueByIndex(this.parameterIndex,1)}clone(){const e=new Zt;return e.partId=this.partId,e.parameterIndex=this.parameterIndex,e.partIndex=this.partIndex,e.link=this.link.map(e=>e.clone()),e}}class Kt{constructor(e=!1,t=new Re){this.isOverwritten=e,this.Color=t}}class Qt{constructor(e=!1,t=new Re){this.isOverwritten=e,this.Color=t}}class ei{constructor(e=!1,t=!1){this.isOverwritten=e,this.isCulling=t}}class ti{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return null==this._model?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const e=this._model.parameters.count,t=this._savedParameters.length;for(let i=0;i<e;++i)i<t?this._savedParameters[i]=this._parameterValues[i]:this._savedParameters.push(this._parameterValues[i])}getMultiplyColor(e){if(this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(e))return this._userMultiplyColors[e].Color;return this.getDrawableMultiplyColor(e)}getScreenColor(e){if(this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(e))return this._userScreenColors[e].Color;return this.getDrawableScreenColor(e)}setMultiplyColorByTextureColor(e,t){this.setMultiplyColorByRGBA(e,t.R,t.G,t.B,t.A)}setMultiplyColorByRGBA(e,t,i,s,o=1){this._userMultiplyColors[e].Color.R=t,this._userMultiplyColors[e].Color.G=i,this._userMultiplyColors[e].Color.B=s,this._userMultiplyColors[e].Color.A=o}setScreenColorByTextureColor(e,t){this.setScreenColorByRGBA(e,t.R,t.G,t.B,t.A)}setScreenColorByRGBA(e,t,i,s,o=1){this._userScreenColors[e].Color.R=t,this._userScreenColors[e].Color.G=i,this._userScreenColors[e].Color.B=s,this._userScreenColors[e].Color.A=o}getPartMultiplyColor(e){return this._userPartMultiplyColors[e].Color}getPartScreenColor(e){return this._userPartScreenColors[e].Color}setPartColor(e,t,i,s,o,r,a){if(r[e].Color.R=t,r[e].Color.G=i,r[e].Color.B=s,r[e].Color.A=o,r[e].isOverwritten)for(let r=0;r<this._partChildDrawables[e].length;++r){const n=this._partChildDrawables[e][r];a[n].Color.R=t,a[n].Color.G=i,a[n].Color.B=s,a[n].Color.A=o}}setPartMultiplyColorByTextureColor(e,t){this.setPartMultiplyColorByRGBA(e,t.R,t.G,t.B,t.A)}setPartMultiplyColorByRGBA(e,t,i,s,o){this.setPartColor(e,t,i,s,o,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(e,t){this.setPartScreenColorByRGBA(e,t.R,t.G,t.B,t.A)}setPartScreenColorByRGBA(e,t,i,s,o){this.setPartColor(e,t,i,s,o,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(e){this._isOverwrittenModelMultiplyColors=e}setOverwriteFlagForModelScreenColors(e){this._isOverwrittenModelScreenColors=e}getOverwriteFlagForDrawableMultiplyColors(e){return this._userMultiplyColors[e].isOverwritten}getOverwriteFlagForDrawableScreenColors(e){return this._userScreenColors[e].isOverwritten}setOverwriteFlagForDrawableMultiplyColors(e,t){this._userMultiplyColors[e].isOverwritten=t}setOverwriteFlagForDrawableScreenColors(e,t){this._userScreenColors[e].isOverwritten=t}getOverwriteColorForPartMultiplyColors(e){return this._userPartMultiplyColors[e].isOverwritten}getOverwriteColorForPartScreenColors(e){return this._userPartScreenColors[e].isOverwritten}setOverwriteColorForPartColors(e,t,i,s){i[e].isOverwritten=t;for(let o=0;o<this._partChildDrawables[e].length;++o){const r=this._partChildDrawables[e][o];s[r].isOverwritten=t,t&&(s[r].Color.R=i[e].Color.R,s[r].Color.G=i[e].Color.G,s[r].Color.B=i[e].Color.B,s[r].Color.A=i[e].Color.A)}}setOverwriteColorForPartMultiplyColors(e,t){this._userPartMultiplyColors[e].isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(e,t){this._userPartScreenColors[e].isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(e){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(e))return this._userCullings[e].isCulling;const t=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(t[e])}setDrawableCulling(e,t){this._userCullings[e].isCulling=t}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(e){this._isOverwrittenCullings=e}getOverwriteFlagForDrawableCullings(e){return this._userCullings[e].isOverwritten}setOverwriteFlagForDrawableCullings(e,t){this._userCullings[e].isOverwritten=t}getModelOapcity(){return this._modelOpacity}setModelOapcity(e){this._modelOpacity=e}getModel(){return this._model}getPartIndex(e){let t;const i=this._model.parts.count;for(t=0;t<i;++t)if(e==this._partIds[t])return t;return e in this._notExistPartId?this._notExistPartId[e]:(t=i+this._notExistPartId.length,this._notExistPartId[e]=t,this._notExistPartOpacities[t]=0,t)}getPartId(e){return this._model.parts.ids[e]}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(e,t){e in this._notExistPartOpacities?this._notExistPartOpacities[e]=t:(We(0<=e&&e<this.getPartCount()),this._partOpacities[e]=t)}setPartOpacityById(e,t){const i=this.getPartIndex(e);i<0||this.setPartOpacityByIndex(i,t)}getPartOpacityByIndex(e){return e in this._notExistPartOpacities?this._notExistPartOpacities[e]:(We(0<=e&&e<this.getPartCount()),this._partOpacities[e])}getPartOpacityById(e){const t=this.getPartIndex(e);return t<0?0:this.getPartOpacityByIndex(t)}getParameterIndex(e){let t;const i=this._model.parameters.count;for(t=0;t<i;++t)if(e==this._parameterIds[t])return t;return e in this._notExistParameterId?this._notExistParameterId[e]:(t=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[e]=t,this._notExistParameterValues[t]=0,t)}getParameterCount(){return this._model.parameters.count}getParameterType(e){return this._model.parameters.types[e]}getParameterMaximumValue(e){return this._model.parameters.maximumValues[e]}getParameterMinimumValue(e){return this._model.parameters.minimumValues[e]}getParameterDefaultValue(e){return this._model.parameters.defaultValues[e]}getParameterValueByIndex(e){return e in this._notExistParameterValues?this._notExistParameterValues[e]:(We(0<=e&&e<this.getParameterCount()),this._parameterValues[e])}getParameterValueById(e){const t=this.getParameterIndex(e);return this.getParameterValueByIndex(t)}setParameterValueByIndex(e,t,i=1){e in this._notExistParameterValues?this._notExistParameterValues[e]=1==i?t:this._notExistParameterValues[e]*(1-i)+t*i:(We(0<=e&&e<this.getParameterCount()),this._model.parameters.maximumValues[e]<t&&(t=this._model.parameters.maximumValues[e]),this._model.parameters.minimumValues[e]>t&&(t=this._model.parameters.minimumValues[e]),this._parameterValues[e]=1==i?t:this._parameterValues[e]=this._parameterValues[e]*(1-i)+t*i)}setParameterValueById(e,t,i=1){const s=this.getParameterIndex(e);this.setParameterValueByIndex(s,t,i)}addParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)+t*i)}addParameterValueById(e,t,i=1){const s=this.getParameterIndex(e);this.addParameterValueByIndex(s,t,i)}multiplyParameterValueById(e,t,i=1){const s=this.getParameterIndex(e);this.multiplyParameterValueByIndex(s,t,i)}multiplyParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)*(1+(t-1)*i))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(e){const t=this._model.drawables.count;for(let i=0;i<t;++i)if(this._drawableIds[i]==e)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(e){return this._model.drawables.ids[e]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(e){return this.getDrawableTextureIndex(e)}getDrawableTextureIndex(e){return this._model.drawables.textureIndices[e]}getDrawableDynamicFlagVertexPositionsDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(t[e])}getDrawableVertexIndexCount(e){return this._model.drawables.indexCounts[e]}getDrawableVertexCount(e){return this._model.drawables.vertexCounts[e]}getDrawableVertices(e){return this.getDrawableVertexPositions(e)}getDrawableVertexIndices(e){return this._model.drawables.indices[e]}getDrawableVertexPositions(e){return this._model.drawables.vertexPositions[e]}getDrawableVertexUvs(e){return this._model.drawables.vertexUvs[e]}getDrawableOpacity(e){return this._model.drawables.opacities[e]}getDrawableMultiplyColor(e){const t=this._model.drawables.multiplyColors,i=4*e,s=new Re;return s.R=t[i],s.G=t[i+1],s.B=t[i+2],s.A=t[i+3],s}getDrawableScreenColor(e){const t=this._model.drawables.screenColors,i=4*e,s=new Re;return s.R=t[i],s.G=t[i+1],s.B=t[i+2],s.A=t[i+3],s}getDrawableParentPartIndex(e){return this._model.drawables.parentPartIndices[e]}getDrawableBlendMode(e){const t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(t[e])?Fe.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(t[e])?Fe.CubismBlendMode_Multiplicative:Fe.CubismBlendMode_Normal}getDrawableInvertedMaskBit(e){const t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(t[e])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let e=0;e<this._model.drawables.count;++e)if(!(this._model.drawables.maskCounts[e]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(t[e])}getDrawableDynamicFlagVisibilityDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(t[e])}getDrawableDynamicFlagOpacityDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(t[e])}getDrawableDynamicFlagRenderOrderDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(t[e])}getDrawableDynamicFlagBlendColorDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(t[e])}loadParameters(){let e=this._model.parameters.count;const t=this._savedParameters.length;e>t&&(e=t);for(let t=0;t<e;++t)this._parameterValues[t]=this._savedParameters[t]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,t=this._model.parameters.count;for(let i=0;i<t;++i)this._parameterIds.push(e[i])}const e=this._model.parts.count;{const t=this._model.parts.ids;for(let i=0;i<e;++i)this._partIds.push(t[i])}{const t=this._model.drawables.ids,i=this._model.drawables.count,s=new ei(!1,!1);for(let t=0;t<e;++t){const e=new Re(1,1,1,1),t=new Re(0,0,0,1),i=new Qt(!1,e),s=new Qt(!1,t);this._userPartMultiplyColors.push(i),this._userPartScreenColors.push(s),this._partChildDrawables.push([])}for(let e=0;e<i;++e){const i=new Re(1,1,1,1),o=new Re(0,0,0,1),r=new Kt(!1,i),a=new Kt(!1,o);this._drawableIds.push(t[e]),this._userMultiplyColors.push(r),this._userScreenColors.push(a),this._userCullings.push(s);const n=this.getDrawableParentPartIndex(e);n>=0&&this._partChildDrawables[n].push(e)}}}constructor(e){this._model=e,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=[],this._userScreenColors=[],this._userCullings=[],this._userPartMultiplyColors=[],this._userPartScreenColors=[],this._partChildDrawables=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class ii{static create(e,t){if(t){if(!this.hasMocConsistency(e))throw new Error('Inconsistent MOC3.')}const i=Live2DCubismCore.Moc.fromArrayBuffer(e);if(i){const t=new ii(i);return t._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(i,e),t}throw new Error('Failed to CubismMoc.create().')}createModel(){let e;const t=Live2DCubismCore.Model.fromMoc(this._moc);if(t)return e=new ti(t),++this._modelCount,e;throw new Error('Unknown error')}deleteModel(e){null!=e&&--this._modelCount}constructor(e){this._moc=e,this._modelCount=0,this._mocVersion=0}release(){this._moc._release(),this._moc=void 0}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(e){return 1===Live2DCubismCore.Moc.prototype.hasMocConsistency(e)}}var si=(e=>(e[e.CubismPhysicsTargetType_Parameter=0]='CubismPhysicsTargetType_Parameter',e))(si||{}),oi=(e=>(e[e.CubismPhysicsSource_X=0]='CubismPhysicsSource_X',e[e.CubismPhysicsSource_Y=1]='CubismPhysicsSource_Y',e[e.CubismPhysicsSource_Angle=2]='CubismPhysicsSource_Angle',e))(oi||{});class ri{constructor(){this.initialPosition=new Be(0,0),this.position=new Be(0,0),this.lastPosition=new Be(0,0),this.lastGravity=new Be(0,0),this.force=new Be(0,0),this.velocity=new Be(0,0)}}class ai{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class ni{constructor(){this.source={}}}class li{constructor(){this.destination={},this.translationScale=new Be(0,0)}}class ci{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new Be(0,0),this.wind=new Be(0,0),this.fps=0}}class di{constructor(e){this._json=e}release(){this._json=void 0}getGravity(){const e=new Be(0,0);return e.x=this._json.Meta.EffectiveForces.Gravity.X,e.y=this._json.Meta.EffectiveForces.Gravity.Y,e}getWind(){const e=new Be(0,0);return e.x=this._json.Meta.EffectiveForces.Wind.X,e.y=this._json.Meta.EffectiveForces.Wind.Y,e}getFps(){return this._json.Meta.Fps||0}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Default}getNormalizationAngleMinimumValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Default}getInputCount(e){return this._json.PhysicsSettings[e].Input.length}getInputWeight(e,t){return this._json.PhysicsSettings[e].Input[t].Weight}getInputReflect(e,t){return this._json.PhysicsSettings[e].Input[t].Reflect}getInputType(e,t){return this._json.PhysicsSettings[e].Input[t].Type}getInputSourceId(e,t){return this._json.PhysicsSettings[e].Input[t].Source.Id}getOutputCount(e){return this._json.PhysicsSettings[e].Output.length}getOutputVertexIndex(e,t){return this._json.PhysicsSettings[e].Output[t].VertexIndex}getOutputAngleScale(e,t){return this._json.PhysicsSettings[e].Output[t].Scale}getOutputWeight(e,t){return this._json.PhysicsSettings[e].Output[t].Weight}getOutputDestinationId(e,t){return this._json.PhysicsSettings[e].Output[t].Destination.Id}getOutputType(e,t){return this._json.PhysicsSettings[e].Output[t].Type}getOutputReflect(e,t){return this._json.PhysicsSettings[e].Output[t].Reflect}getParticleCount(e){return this._json.PhysicsSettings[e].Vertices.length}getParticleMobility(e,t){return this._json.PhysicsSettings[e].Vertices[t].Mobility}getParticleDelay(e,t){return this._json.PhysicsSettings[e].Vertices[t].Delay}getParticleAcceleration(e,t){return this._json.PhysicsSettings[e].Vertices[t].Acceleration}getParticleRadius(e,t){return this._json.PhysicsSettings[e].Vertices[t].Radius}getParticlePosition(e,t){const i=new Be(0,0);return i.x=this._json.PhysicsSettings[e].Vertices[t].Position.X,i.y=this._json.PhysicsSettings[e].Vertices[t].Position.Y,i}}const ui='Angle';class hi{static create(e){const t=new hi;return t.parse(e),t._physicsRig.gravity.y=0,t}static delete(e){null!=e&&e.release()}parse(e){this._physicsRig=new ci;const t=new di(e);this._physicsRig.gravity=t.getGravity(),this._physicsRig.wind=t.getWind(),this._physicsRig.subRigCount=t.getSubRigCount(),this._physicsRig.fps=t.getFps(),this._currentRigOutputs=[],this._previousRigOutputs=[];let i=0,s=0,o=0;for(let e=0;e<this._physicsRig.subRigCount;++e){const r=new ai;r.normalizationPosition.minimum=t.getNormalizationPositionMinimumValue(e),r.normalizationPosition.maximum=t.getNormalizationPositionMaximumValue(e),r.normalizationPosition.defalut=t.getNormalizationPositionDefaultValue(e),r.normalizationAngle.minimum=t.getNormalizationAngleMinimumValue(e),r.normalizationAngle.maximum=t.getNormalizationAngleMaximumValue(e),r.normalizationAngle.defalut=t.getNormalizationAngleDefaultValue(e),r.inputCount=t.getInputCount(e),r.baseInputIndex=i,i+=r.inputCount;for(let i=0;i<r.inputCount;++i){const s=new ni;switch(s.sourceParameterIndex=-1,s.weight=t.getInputWeight(e,i),s.reflect=t.getInputReflect(e,i),t.getInputType(e,i)){case'X':s.type=oi.CubismPhysicsSource_X,s.getNormalizedParameterValue=gi;break;case'Y':s.type=oi.CubismPhysicsSource_Y,s.getNormalizedParameterValue=vi;break;case ui:s.type=oi.CubismPhysicsSource_Angle,s.getNormalizedParameterValue=fi}s.source.targetType=si.CubismPhysicsTargetType_Parameter,s.source.id=t.getInputSourceId(e,i),this._physicsRig.inputs.push(s)}r.outputCount=t.getOutputCount(e),r.baseOutputIndex=s;const a=new pi,n=new pi;for(let i=0;i<r.outputCount;++i){a.outputs[i]=0,n.outputs[i]=0;let o=this._physicsRig.outputs[s+i];switch(o||(o=new li,this._physicsRig.outputs[s+i]=o),o.destinationParameterIndex=-1,o.vertexIndex=t.getOutputVertexIndex(e,i),o.angleScale=t.getOutputAngleScale(e,i),o.weight=t.getOutputWeight(e,i),o.destination.targetType=si.CubismPhysicsTargetType_Parameter,o.destination.id=t.getOutputDestinationId(e,i),t.getOutputType(e,i)){case'X':o.type=oi.CubismPhysicsSource_X,o.getValue=xi,o.getScale=bi;break;case'Y':o.type=oi.CubismPhysicsSource_Y,o.getValue=yi,o.getScale=wi;break;case ui:o.type=oi.CubismPhysicsSource_Angle,o.getValue=_i,o.getScale=Mi}o.reflect=t.getOutputReflect(e,i)}this._currentRigOutputs.push(a),this._previousRigOutputs.push(n),s+=r.outputCount,r.particleCount=t.getParticleCount(e),r.baseParticleIndex=o,o+=r.particleCount;for(let i=0;i<r.particleCount;++i){const s=new ri;s.mobility=t.getParticleMobility(e,i),s.delay=t.getParticleDelay(e,i),s.acceleration=t.getParticleAcceleration(e,i),s.radius=t.getParticleRadius(e,i),s.position=t.getParticlePosition(e,i),this._physicsRig.particles.push(s)}this._physicsRig.settings.push(r)}this.initialize(),t.release()}stabilization(e){var t,i,s,o;let r,a,n,l;const c=new Be;let d,u,h,m,p,g,v,f;p=e.getModel().parameters.values,g=e.getModel().parameters.maximumValues,v=e.getModel().parameters.minimumValues,f=e.getModel().parameters.defaultValues,(null!=(i=null==(t=this._parameterCaches)?void 0:t.length)?i:0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(null!=(o=null==(s=this._parameterInputCaches)?void 0:s.length)?o:0)<e.getParameterCount()&&(this._parameterInputCaches=new Float32Array(e.getParameterCount()));for(let t=0;t<e.getParameterCount();++t)this._parameterCaches[t]=p[t],this._parameterInputCaches[t]=p[t];for(let t=0;t<this._physicsRig.subRigCount;++t){r={angle:0},c.x=0,c.y=0,d=this._physicsRig.settings[t],u=this._physicsRig.inputs.slice(d.baseInputIndex),h=this._physicsRig.outputs.slice(d.baseOutputIndex),m=this._physicsRig.particles.slice(d.baseParticleIndex);for(let t=0;t<d.inputCount;++t)a=u[t].weight/100,-1==u[t].sourceParameterIndex&&(u[t].sourceParameterIndex=e.getParameterIndex(u[t].source.id)),u[t].getNormalizedParameterValue(c,r,p[u[t].sourceParameterIndex],v[u[t].sourceParameterIndex],g[u[t].sourceParameterIndex],f[u[t].sourceParameterIndex],d.normalizationPosition,d.normalizationAngle,u[t].reflect,a),this._parameterCaches[u[t].sourceParameterIndex]=p[u[t].sourceParameterIndex];n=Ve.degreesToRadian(-r.angle),c.x=c.x*Ve.cos(n)-c.y*Ve.sin(n),c.y=c.x*Ve.sin(n)+c.y*Ve.cos(n),Si(m,d.particleCount,c,r.angle,this._options.wind,.001*d.normalizationPosition.maximum);for(let i=0;i<d.outputCount;++i){const s=h[i].vertexIndex;if(-1==h[i].destinationParameterIndex&&(h[i].destinationParameterIndex=e.getParameterIndex(h[i].destination.id)),s<1||s>=d.particleCount)continue;let o=new Be;o=m[s].position.substract(m[s-1].position),l=h[i].getValue(o,m,s,h[i].reflect,this._options.gravity),this._currentRigOutputs[t].outputs[i]=l,this._previousRigOutputs[t].outputs[i]=l;const r=h[i].destinationParameterIndex,a=!Float32Array.prototype.slice&&'subarray'in Float32Array.prototype?JSON.parse(JSON.stringify(p.subarray(r))):p.slice(r);Pi(a,v[r],g[r],l,h[i]);for(let e=r,t=0;e<this._parameterCaches.length;e++,t++)p[e]=this._parameterCaches[e]=a[t]}}}evaluate(e,t){var i,s,o,r;let a,n,l,c;const d=new Be;let u,h,m,p,g,v,f,x,y;if(0>=t)return;if(this._currentRemainTime+=t,this._currentRemainTime>5&&(this._currentRemainTime=0),g=e.getModel().parameters.values,v=e.getModel().parameters.maximumValues,f=e.getModel().parameters.minimumValues,x=e.getModel().parameters.defaultValues,(null!=(s=null==(i=this._parameterCaches)?void 0:i.length)?s:0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(null!=(r=null==(o=this._parameterInputCaches)?void 0:o.length)?r:0)<e.getParameterCount()){this._parameterInputCaches=new Float32Array(e.getParameterCount());for(let t=0;t<e.getParameterCount();++t)this._parameterInputCaches[t]=g[t]}for(y=this._physicsRig.fps>0?1/this._physicsRig.fps:t;this._currentRemainTime>=y;){for(let e=0;e<this._physicsRig.subRigCount;++e){u=this._physicsRig.settings[e],m=this._physicsRig.outputs.slice(u.baseOutputIndex);for(let t=0;t<u.outputCount;++t)this._previousRigOutputs[e].outputs[t]=this._currentRigOutputs[e].outputs[t]}const t=y/this._currentRemainTime;for(let i=0;i<e.getParameterCount();++i)this._parameterCaches[i]=this._parameterInputCaches[i]*(1-t)+g[i]*t,this._parameterInputCaches[i]=this._parameterCaches[i];for(let t=0;t<this._physicsRig.subRigCount;++t){a={angle:0},d.x=0,d.y=0,u=this._physicsRig.settings[t],h=this._physicsRig.inputs.slice(u.baseInputIndex),m=this._physicsRig.outputs.slice(u.baseOutputIndex),p=this._physicsRig.particles.slice(u.baseParticleIndex);for(let t=0;t<u.inputCount;++t)n=h[t].weight/100,-1==h[t].sourceParameterIndex&&(h[t].sourceParameterIndex=e.getParameterIndex(h[t].source.id)),h[t].getNormalizedParameterValue(d,a,this._parameterCaches[h[t].sourceParameterIndex],f[h[t].sourceParameterIndex],v[h[t].sourceParameterIndex],x[h[t].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,h[t].reflect,n);l=Ve.degreesToRadian(-a.angle),d.x=d.x*Ve.cos(l)-d.y*Ve.sin(l),d.y=d.x*Ve.sin(l)+d.y*Ve.cos(l),ki(p,u.particleCount,d,a.angle,this._options.wind,.001*u.normalizationPosition.maximum,y,5);for(let i=0;i<u.outputCount;++i){const s=m[i].vertexIndex;if(-1==m[i].destinationParameterIndex&&(m[i].destinationParameterIndex=e.getParameterIndex(m[i].destination.id)),s<1||s>=u.particleCount)continue;const o=new Be;o.x=p[s].position.x-p[s-1].position.x,o.y=p[s].position.y-p[s-1].position.y,c=m[i].getValue(o,p,s,m[i].reflect,this._options.gravity),this._currentRigOutputs[t].outputs[i]=c;const r=m[i].destinationParameterIndex,a=!Float32Array.prototype.slice&&'subarray'in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(r))):this._parameterCaches.slice(r);Pi(a,f[r],v[r],c,m[i]);for(let e=r,t=0;e<this._parameterCaches.length;e++,t++)this._parameterCaches[e]=a[t]}}this._currentRemainTime-=y}const C=this._currentRemainTime/y;this.interpolate(e,C)}interpolate(e,t){let i,s,o,r,a;o=e.getModel().parameters.values,r=e.getModel().parameters.maximumValues,a=e.getModel().parameters.minimumValues;for(let e=0;e<this._physicsRig.subRigCount;++e){s=this._physicsRig.settings[e],i=this._physicsRig.outputs.slice(s.baseOutputIndex);for(let n=0;n<s.outputCount;++n){if(-1==i[n].destinationParameterIndex)continue;const s=i[n].destinationParameterIndex,l=!Float32Array.prototype.slice&&'subarray'in Float32Array.prototype?JSON.parse(JSON.stringify(o.subarray(s))):o.slice(s);Pi(l,a[s],r[s],this._previousRigOutputs[e].outputs[n]*(1-t)+this._currentRigOutputs[e].outputs[n]*t,i[n]);for(let e=s,t=0;e<o.length;e++,t++)o[e]=l[t]}}}setOptions(e){this._options=e}getOption(){return this._options}constructor(){this._options=new mi,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=[],this._previousRigOutputs=[],this._currentRemainTime=0}release(){this._physicsRig=void 0}initialize(){let e,t,i;for(let s=0;s<this._physicsRig.subRigCount;++s){t=this._physicsRig.settings[s],e=this._physicsRig.particles.slice(t.baseParticleIndex),e[0].initialPosition=new Be(0,0),e[0].lastPosition=new Be(e[0].initialPosition.x,e[0].initialPosition.y),e[0].lastGravity=new Be(0,-1),e[0].lastGravity.y*=-1,e[0].velocity=new Be(0,0),e[0].force=new Be(0,0);for(let s=1;s<t.particleCount;++s)i=new Be(0,0),i.y=e[s].radius,e[s].initialPosition=new Be(e[s-1].initialPosition.x+i.x,e[s-1].initialPosition.y+i.y),e[s].position=new Be(e[s].initialPosition.x,e[s].initialPosition.y),e[s].lastPosition=new Be(e[s].initialPosition.x,e[s].initialPosition.y),e[s].lastGravity=new Be(0,-1),e[s].lastGravity.y*=-1,e[s].velocity=new Be(0,0),e[s].force=new Be(0,0)}}}class mi{constructor(){this.gravity=new Be(0,0),this.wind=new Be(0,0)}}class pi{constructor(){this.outputs=[]}}function gi(e,t,i,s,o,r,a,n,l,c){e.x+=Ei(i,s,o,r,a.minimum,a.maximum,a.defalut,l)*c}function vi(e,t,i,s,o,r,a,n,l,c){e.y+=Ei(i,s,o,r,a.minimum,a.maximum,a.defalut,l)*c}function fi(e,t,i,s,o,r,a,n,l,c){t.angle+=Ei(i,s,o,r,n.minimum,n.maximum,n.defalut,l)*c}function xi(e,t,i,s,o){let r=e.x;return s&&(r*=-1),r}function yi(e,t,i,s,o){let r=e.y;return s&&(r*=-1),r}function _i(e,t,i,s,o){let r;return o=i>=2?t[i-1].position.substract(t[i-2].position):o.multiplyByScaler(-1),r=Ve.directionToRadian(o,e),s&&(r*=-1),r}function Ci(e,t){return Math.min(e,t)+function(e,t){return Math.abs(Math.max(e,t)-Math.min(e,t))}(e,t)/2}function bi(e,t){return e.x}function wi(e,t){return e.y}function Mi(e,t){return t}function ki(e,t,i,s,o,r,a,n){let l,c,d,u,h=new Be(0,0),m=new Be(0,0),p=new Be(0,0),g=new Be(0,0);e[0].position=new Be(i.x,i.y),l=Ve.degreesToRadian(s),u=Ve.radianToDirection(l),u.normalize();for(let i=1;i<t;++i)e[i].force=u.multiplyByScaler(e[i].acceleration).add(o),e[i].lastPosition=new Be(e[i].position.x,e[i].position.y),c=e[i].delay*a*30,h=e[i].position.substract(e[i-1].position),d=Ve.directionToRadian(e[i].lastGravity,u)/n,h.x=Ve.cos(d)*h.x-h.y*Ve.sin(d),h.y=Ve.sin(d)*h.x+h.y*Ve.cos(d),e[i].position=e[i-1].position.add(h),m=e[i].velocity.multiplyByScaler(c),p=e[i].force.multiplyByScaler(c).multiplyByScaler(c),e[i].position=e[i].position.add(m).add(p),g=e[i].position.substract(e[i-1].position),g.normalize(),e[i].position=e[i-1].position.add(g.multiplyByScaler(e[i].radius)),Ve.abs(e[i].position.x)<r&&(e[i].position.x=0),0!=c&&(e[i].velocity=e[i].position.substract(e[i].lastPosition),e[i].velocity=e[i].velocity.divisionByScalar(c),e[i].velocity=e[i].velocity.multiplyByScaler(e[i].mobility)),e[i].force=new Be(0,0),e[i].lastGravity=new Be(u.x,u.y)}function Si(e,t,i,s,o,r){let a,n,l=new Be(0,0);e[0].position=new Be(i.x,i.y),a=Ve.degreesToRadian(s),n=Ve.radianToDirection(a),n.normalize();for(let i=1;i<t;++i)e[i].force=n.multiplyByScaler(e[i].acceleration).add(o),e[i].lastPosition=new Be(e[i].position.x,e[i].position.y),e[i].velocity=new Be(0,0),l=e[i].force,l.normalize(),l=l.multiplyByScaler(e[i].radius),e[i].position=e[i-1].position.add(l),Ve.abs(e[i].position.x)<r&&(e[i].position.x=0),e[i].force=new Be(0,0),e[i].lastGravity=new Be(n.x,n.y)}function Pi(e,t,i,s,o){let r,a,n;r=o.getScale(o.translationScale,o.angleScale),a=s*r,a<t?(a<o.valueBelowMinimum&&(o.valueBelowMinimum=a),a=t):a>i&&(a>o.valueExceededMaximum&&(o.valueExceededMaximum=a),a=i),n=o.weight/100,n>=1||(a=e[0]*(1-n)+a*n),e[0]=a}function Ei(e,t,i,s,o,r,a,n){let l=0;const c=Ve.max(i,t);c<e&&(e=c);const d=Ve.min(i,t);d>e&&(e=d);const u=Ve.min(o,r),h=Ve.max(o,r),m=a,p=Ci(d,c),g=e-p;switch(Math.sign(g)){case 1:{const e=c-p;0!=e&&(l=g*((h-m)/e),l+=m);break}case-1:{const e=d-p;0!=e&&(l=g*((u-m)/e),l+=m);break}case 0:l=m}return n?l:-1*l}function Ii(){var e;null==(e=this.__moc)||e.release()}le.registerRuntime({version:4,ready:function(){return je.isStarted()?Promise.resolve():(null!=Yt||(Yt=new Promise((e,t)=>{!function i(){try{s=Object.assign({logFunction:console.log,loggingLevel:Ge.LogLevel_Verbose},s),je.startUp(s),je.initialize(),e()}catch(e){if(qt--,qt<0){const i=new Error('Failed to start up Cubism 4 framework.');return i.cause=e,void t(i)}P.log('Cubism4','Startup failed, retrying 10ms later...'),setTimeout(i,10)}var s}()})),Yt)},test:e=>e instanceof Ht||Ht.isValidJSON(e),isValidMoc(e){if(e.byteLength<4)return!1;const t=new Int8Array(e,0,4);return'MOC3'===String.fromCharCode(...t)},createModelSettings:e=>new Ht(e),createCoreModel(e,t){const i=ii.create(e,!!(null==t?void 0:t.checkMocConsistency));try{const e=i.createModel();return e.__moc=i,e}catch(e){try{i.release()}catch(e){}throw e}},createInternalModel(e,t,i){const s=new Gt(e,t,i),o=e;return o.__moc&&(s.__moc=o.__moc,delete o.__moc,s.once('destroy',Ii)),s},createPhysics:(e,t)=>hi.create(t),createPose:(e,t)=>Jt.create(t)});class Ti{static instance=null;modelCache=new Map;loadingPromises=new Map;maxCacheSize=5;constructor(){console.info('[Live2D] ')}static getInstance(){return Ti.instance||(Ti.instance=new Ti),Ti.instance}async preloadModel(e){const t=e.id;if(this.modelCache.has(t)){return this.modelCache.get(t).lastUsed=Date.now(),void console.info(`[Live2D]  "${e.name}" `)}if(this.loadingPromises.has(t))return console.info(`[Live2D]  "${e.name}" ...`),void await this.loadingPromises.get(t);console.info(`[Live2D] : "${e.name}"`);const i=this.loadModelInternal(e);this.loadingPromises.set(t,i);try{const s=await i;this.cleanupCache(),this.modelCache.set(t,{model:s,config:e,lastUsed:Date.now()}),console.info(`[Live2D]  "${e.name}" `)}catch(t){throw console.error(`[Live2D]  "${e.name}" :`,t),t}finally{this.loadingPromises.delete(t)}}async preloadModels(e){console.info(`[Live2D]  ${e.length} `);const t=e.map(e=>this.preloadModel(e).catch(t=>{console.warn(`[Live2D]  "${e.name}" :`,t)}));Promise.all(t).then(()=>{console.info('[Live2D] ')})}getCachedModel(e){const t=this.modelCache.get(e);return t?(t.lastUsed=Date.now(),console.info(`[Live2D] : ${t.config.name}`),t.model):null}async getOrLoadModel(e){const t=e.id,i=this.getCachedModel(t);return i||(this.loadingPromises.has(t)?(console.info(`[Live2D]  "${e.name}" ...`),await this.loadingPromises.get(t)):(console.info(`[Live2D]  "${e.name}" ...`),await this.preloadModel(e),this.getCachedModel(t)))}async loadModelInternal(e){try{let t=e.modelPath;t.startsWith('http://')||t.startsWith('https://')||(t=e.basePath?`${e.basePath}${t}`:t),console.info(`[Live2D] : ${t}`);const i=await fe.from(t,{autoInteract:!1,autoUpdate:!0});return console.info(`[Live2D]  "${e.name}" `),i}catch(t){throw console.error(`[Live2D]  "${e.name}" :`,t),t}}cleanupCache(){if(this.modelCache.size<this.maxCacheSize)return;console.info(`[Live2D]  (${this.modelCache.size}/${this.maxCacheSize})...`);let e=null,t=1/0;for(const[i,s]of this.modelCache.entries())s.lastUsed<t&&(t=s.lastUsed,e=i);if(e){const t=this.modelCache.get(e);console.info(`[Live2D] : "${t.config.name}"`);try{t.model.destroy()}catch(e){console.warn('[Live2D] :',e)}this.modelCache.delete(e)}}clearCache(){console.info(`[Live2D]  (${this.modelCache.size} )`);for(const e of this.modelCache.values())try{e.model.destroy()}catch(t){console.warn(`[Live2D]  "${e.config.name}" :`,t)}this.modelCache.clear(),this.loadingPromises.clear()}getCacheStats(){return{cached:this.modelCache.size,loading:this.loadingPromises.size,maxSize:this.maxCacheSize,models:Array.from(this.modelCache.entries()).map(([e,t])=>({id:e,name:t.config.name,lastUsed:t.lastUsed}))}}setMaxCacheSize(e){this.maxCacheSize=Math.max(1,e),console.info(`[Live2D] : ${this.maxCacheSize}`),this.cleanupCache()}}const Bi=Ti.getInstance()},315(e){e.exports=PIXI},439(e,t,i){i.d(t,{default:()=>Yi});var s=i(61);const o=[{id:'none',name:'',pattern:''},{id:'grid',name:'',pattern:'linear-gradient(to right, VAR_BORDER_COLOR 1px, transparent 1px), linear-gradient(to bottom, VAR_BORDER_COLOR 1px, transparent 1px)'},{id:'dots',name:'',pattern:'radial-gradient(circle, VAR_BORDER_COLOR 1px, transparent 1px)'},{id:'diamonds',name:'',pattern:'linear-gradient(45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(-45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(45deg, transparent 75%, VAR_BORDER_COLOR 75%), linear-gradient(-45deg, transparent 75%, VAR_BORDER_COLOR 75%)'},{id:'stripes',name:'',pattern:'repeating-linear-gradient(45deg, transparent, transparent 10px, VAR_BORDER_COLOR 10px, VAR_BORDER_COLOR 20px)'},{id:'gradient-soft',name:'',pattern:'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 50%, VAR_BORDER_COLOR 100%)'}],r=[{id:'rounded',name:'',borderRadius:'12px',borderWidth:'1px',shadow:'0 4px 20px rgba(0,0,0,0.08)'},{id:'pill',name:'',borderRadius:'24px',borderWidth:'1px',shadow:'0 4px 24px rgba(0,0,0,0.1)'},{id:'sharp',name:'',borderRadius:'0px',borderWidth:'2px',shadow:'4px 4px 0 rgba(0,0,0,0.1)'},{id:'soft',name:'',borderRadius:'16px',borderWidth:'0px',shadow:'0 8px 32px rgba(0,0,0,0.12)'},{id:'frame',name:'',borderRadius:'4px',borderWidth:'3px',shadow:'inset 0 0 0 1px rgba(0,0,0,0.05)'}],a=[{id:'none',name:'',width:'0px'},{id:'thin',name:'',width:'1px'},{id:'medium',name:'',width:'2px'},{id:'thick',name:'',width:'3px'},{id:'bold',name:'',width:'4px'}],n=[{id:'tag',name:'',borderRadius:'6px 6px 0 0',style:'tag'},{id:'pill',name:'',borderRadius:'999px',style:'pill'},{id:'square',name:'',borderRadius:'0px',style:'square'},{id:'underline',name:'',borderRadius:'0px',style:'underline'},{id:'floating',name:'',borderRadius:'8px',style:'floating'}],l=[{id:'circle',name:'',type:'circle',isInner:!1},{id:'square',name:'',type:'square',isInner:!1},{id:'pill',name:'',type:'pill',isInner:!1},{id:'minimal',name:'',type:'minimal',isInner:!1},{id:'inner-round',name:'',type:'inner-round',isInner:!0},{id:'inner-square',name:'',type:'inner-square',isInner:!0}],c=[{id:'dots',name:'',type:'dots'},{id:'diamonds',name:'',type:'diamonds'},{id:'pulse',name:'',type:'pulse'},{id:'arrow',name:'',type:'arrow'},{id:'none',name:'',type:'none'}],d={boxShape:'rounded',nameShape:'tag',arrowShape:'circle',indicatorShape:'dots',backgroundPattern:'none',borderWidth:'thin',colors:{boxBackground:'rgba(255, 255, 255, 0.9)',boxBorder:'rgba(16, 185, 129, 0.3)',nameBackground:'rgba(236, 253, 245, 0.9)',nameText:'#059669',nameBorder:'rgba(16, 185, 129, 0.3)',dialogText:'#374151',narrationText:'#6b7280',arrowBackground:'rgba(255, 255, 255, 0.85)',arrowIcon:'#10b981',indicatorColor:'#10b981'},fontSize:16};function u(e){const t=e.match(/```json\s*([\s\S]*?)\s*```/);if(t)try{return JSON.parse(t[1])}catch(e){console.warn(' JSON :',e)}const i=e.replace(/^\uFEFF/,'').trim();if(i.startsWith('---')){const e=i.split('---');if(e.length>=3){return u(e.slice(2).join('---').trim())}}if(!i.startsWith('{')&&!i.startsWith('['))return null;try{return JSON.parse(i)}catch(e){return console.warn(' JSON :',e),null}}let h=null,m=0,p='';const g='-';async function v(){const e=Date.now();let t='';try{t=new RawCharacter(RawCharacter.find({name:'current'})).getCardData().name||''}catch(e){console.warn(':',e)}if(h&&e-m<5e3&&p===t)return h;const i={models:new Map,sprites:null,backgrounds:null,cgs:null},s=[];try{const e=getCharWorldbookNames('current');e.primary&&s.push(e.primary),s.push(...e.additional)}catch(e){console.warn(':',e)}s.includes(g)||s.push(g),console.info('[] :',s);for(const e of s)try{if('function'!=typeof getWorldbook){console.warn('[] getWorldbook ');continue}const t=await getWorldbook(e);console.info(`[]  ${e}  ${t.length} `);for(const e of t){if(!e.enabled)continue;const t=u(e.content);if(t){if(console.info(`[] : ${e.name}, type=${t.type}`),'live2d_model'===t.type){const e=t;i.models.has(e.modelName)||i.models.set(e.modelName,e)}else if('sprite'===t.type){const e=t;if(console.info(`[]  ${e.sprites?.length||0} `),e.sprites&&e.sprites.length>0)for(const t of e.sprites)console.info(`[] : ${t.name}, textMappings: ${t.textMappings?.join(', ')}`);if(i.sprites){const t=i.sprites,s=e;t.sprites.push(...s.sprites)}else i.sprites=e;console.info('[] :',i.sprites.sprites.length)}else if('background'===t.type)if(i.backgrounds){const e=i.backgrounds,s=t;e.backgrounds.push(...s.backgrounds)}else i.backgrounds=t;else if('cg'===t.type)if(i.cgs){const e=i.cgs,s=t;e.cgs.push(...s.cgs)}else i.cgs=t}else console.warn(`[] : ${e.name}`)}}catch(t){console.warn(` ${e} :`,t)}return h=i,m=e,p=t,console.info('[] :',{:i.models.size,:i.sprites?.sprites?.length||0,:i.backgrounds?.backgrounds?.length||0,CG:i.cgs?.cgs?.length||0}),i}function f(e){return e.replace(/[-/\\_.\s]/g,'').toLowerCase()}function x(e,t){const i=f(e),s=f(t);return i===s||i.includes(s)||s.includes(i)}function y(e){const t={},i=e.split('||').map(e=>e.trim()).filter(e=>e);for(const e of i){const i=e.match(/^([^:]+)[:]\s*(.+)$/);if(i){const e=i[1].trim(),s=i[2].trim();e&&s&&(t[e]=s)}}return t}async function C(e,t,i,s,o){const r={};try{const a=await v();if(t&&a.backgrounds)for(const e of a.backgrounds.backgrounds){const i=t;if(x(e.name,i)||e.textMappings?.some(e=>x(e,i))){r.sceneImageUrl=e.file;break}}if(o&&a.cgs)for(const e of a.cgs.cgs){const t=o;if(x(e.name,t)||e.textMappings?.some(e=>x(e,t))){r.cgImageUrl=e.file;break}}if(e&&a.sprites){const t=e;console.info('[] :',e,':',a.sprites.sprites.length,':',a.sprites.sprites.map(e=>({name:e.name,textMappings:e.textMappings})));for(const e of a.sprites.sprites){const i=e.textMappings?.some(e=>{const i=x(e,t);return console.info('[]  textMapping:',{mapping:e,matchText:t,result:i}),i}),s=x(e.name,t);if(console.info('[] :',{spriteName:e.name,textMappingMatch:i,nameMatch:s}),i||s){r.spriteImageUrl=e.file,console.info('[] ! sprite:',e.name,'textMappings:',i,'name:',s,'URL:',e.file);break}}r.spriteImageUrl||console.warn('[] :',e)}else e&&!a.sprites&&console.warn('[] :',e);const n=[];e&&n.push(e),t&&n.push(t),i&&n.push(i),s&&n.push(s);let l=null;for(const[e,t]of a.models.entries())if(n.some(t=>x(e,t))){l=t;break}if(l){if(i){let e=!1;if(l.motions&&l.motions.length>0)for(const t of l.motions)if('motion'===t.motionType&&t.textMappings&&t.textMappings.length>0){if(t.textMappings.some(e=>x(e,i))){r.motionFile=t.file,e=!0,console.info('[]  textMappings :',{motionName:t.name,motionFile:t.file,matchedText:i});break}}if(!e&&l.textMappings?.motion)for(const[t,s]of Object.entries(l.textMappings.motion))if(x(s,i)){const i=(l.motions||[]).find(e=>e.file===t||e.name===t);if(i){r.motionFile=i.file,e=!0;break}}if(!e)for(const e of l.motions||[])if('motion'===e.motionType&&(x(e.name,i)||x(e.file,i))){r.motionFile=e.file;break}}if(s){let e=!1;if(l.motions&&l.motions.length>0)for(const t of l.motions)if('expression'===t.motionType&&t.textMappings&&t.textMappings.length>0){if(t.textMappings.some(e=>x(e,s))){r.expressionFile=t.file,e=!0,console.info('[]  textMappings :',{motionName:t.name,motionFile:t.file,matchedText:s});break}}if(!e&&l.textMappings?.expression)for(const[t,i]of Object.entries(l.textMappings.expression))if(x(i,s)){const i=(l.expressions||[]).find(e=>e.file===t||e.name===t);if(i){r.expressionFile=i.file,e=!0;break}}if(!e){for(const t of l.motions||[])if('expression'===t.motionType&&(x(t.name,s)||x(t.file,s))){r.expressionFile=t.file,e=!0;break}if(!e&&l.expressions)for(const e of l.expressions){const t='string'==typeof e?e:e.name||e.file,i='string'==typeof e?e:e.file;if(x(t,s)||x(i,s)){r.expressionFile=i;break}}}}}}catch(e){console.warn(':',e)}return r}function b(e){const t=e.match(/<StatusBlock>([\s\S]*?)<\/StatusBlock>/i);if(!t)return null;const i={},s=t[1].trim().replace(/<skit>[\s\S]*?<\/skit>/gi,'').split('\n');let o=null,r=[];for(const e of s){const t=e.trim(),s=t.match(/^([^:]+)[:]\s*(.*)$/);if(s){if(o){const e=r.join('\n').trim();e&&(i[o]=e)}o=s[1].trim();const e=s[2].trim();r=e?[e]:[]}else o&&t&&r.push(t)}return o&&(i[o]=r.join('\n').trim()),Object.keys(i).length>0?i:null}function w(e){if(!e)return!1;const t=e.trim().toLowerCase();return'<user>'===t||'{{user}}'===t||'user'===t||''===t||''===t}async function M(e,t){const i=[];let s=t;const o=e.match(/<content>([\s\S]*?)<\/content>/i),r=o?o[1]:e,a=[],n=/\[\[(\w+)\|\|([^\]]*)\]\]/g;let l;for(;null!==(l=n.exec(r));)a.push({type:'format',start:l.index,end:l.index+l[0].length,match:l});const c=r.split('\n');let d=0,u=[],h=-1;for(let e=0;e<c.length;e++){const t=c[e],i=t.trim(),s=d,o=d+t.length;if(i.startsWith('> ')){0===u.length&&(h=s);const e=i.substring(2);u.push(e)}else if(u.length>0&&''===i)u.push('');else if(u.length>0&&!i.startsWith('> ')){const e=u.join('\n').trim();e&&a.push({type:'note',start:h,end:s,noteContent:e}),u=[],h=-1}d=o+1}if(u.length>0){const e=u.join('\n').trim();e&&a.push({type:'note',start:h,end:d,noteContent:e})}a.sort((e,t)=>e.start-t.start);for(const e of a){if('note'===e.type){i.push({type:'note',noteContent:e.noteContent});continue}l=e.match;const t=l[1],o=l[2];if('character'===t){const e=y(o),t=e['']||e.character||'';if(w(t)){const t=e['']||e.scene||s;let r=e['']||e['']||e.text||o;const a=/([^]+)/g,n=[];let l;for(;null!==(l=a.exec(r));)n.push(l[1]);r=r.replace(a,'').trim(),t&&(s=t);for(const e of n){const s={type:'narration',scene:t,message:e};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(s.sceneImageUrl=e.sceneImageUrl)}i.push(s)}const c={type:'user',scene:t,message:r};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(c.sceneImageUrl=e.sceneImageUrl)}i.push(c);continue}const r={type:'character'};r.character=t;const a=e['CG']||e['cg']||e.CG||e.cg;a?(r.scene=a,r.text=e['']||e.text||'',r.isCG=!0):(r.scene=e['']||e.scene||s,r.motion=e['']||e.motion||'',r.expression=e['']||e.expression||'',r.text=e['']||e.text||'',r.isCG=!1),!r.scene&&s&&(r.scene=s),r.scene&&(s=r.scene),console.info('[] :',{character:r.character,scene:r.isCG?void 0:r.scene,motion:r.motion,expression:r.expression,cgScene:r.isCG?r.scene:void 0,isCGMode:r.isCG});const n=await C(r.character,r.isCG?void 0:r.scene,r.motion,r.expression,r.isCG?r.scene:void 0);console.info('[] :',n),Object.assign(r,n),i.push(r)}else if('narration'===t){const e=y(o),t=e['']||e.scene||s;t&&(s=t);const r={type:'narration',scene:t,message:e['']||e['']||e.text||e['']||o};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(r.sceneImageUrl=e.sceneImageUrl)}i.push(r)}else if('blacktext'===t){const e=y(o),t=e['']||e.text||e['']||o;i.push({type:'blacktext',message:t})}else if('user'===t){const e=y(o),t=e['']||e.scene||s;let r=e['']||e['']||e['']||e.text||o;const a=/([^]+)/g,n=[];let l;for(;null!==(l=a.exec(r));)n.push(l[1]);r=r.replace(a,'').trim(),t&&(s=t);for(const e of n){const s={type:'narration',scene:t,message:e};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(s.sceneImageUrl=e.sceneImageUrl)}i.push(s)}const c={type:'user',scene:t,message:r};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(c.sceneImageUrl=e.sceneImageUrl)}i.push(c)}else if('choice'===t){const e=y(o),t=e['']||e.character||e['']||e.response||e.text||e['']||e.narration,s=[];for(const t in e)if(t.match(/^\d+?$/)){const e=t.replace(/^(\d+)?$/,'$1');s.push(e)}if(s.sort((e,t)=>parseInt(e)-parseInt(t)),1===s.length&&t){const t=`${s[0]}`,o=e[t]||e[`${t}`];o&&i.push({type:'choice',choiceFormat:'format1',options:[{id:'choice_0',text:o,character:e['']||e.character,response:e['']||e.response||e.text||e['']||e.narration}]})}else if(s.length>1){const t=[];for(const i of s){const s=`${i}`,o=e[s]||e[`${s}`];o&&t.push(o)}t.length>0&&i.push({type:'choice',choiceFormat:'format2',choices:t})}}}return i}function k(e,t,i,s){if(!e||!s||0===s.length)return!1;const o=s.find(t=>t.name===e);if(!o)return!1;if(t){let e=!1;if(e=o.motions?.some(e=>{const i='string'==typeof e?e:e.name||e.file;return i===t||i===`${t}.motion3.json`}),!e&&o.textMappings?.motion)for(const[i,s]of Object.entries(o.textMappings.motion)){const r=f(t),a=f(String(s));if((r===a||r.includes(a)||a.includes(r))&&(e=o.motions?.some(e=>{const t='string'==typeof e?e:e.file;return t===i||t===`${i}.motion3.json`}),e))break}if(!e)return!1}if(i){let e=!1;if(e=o.expressions?.some(e=>{const t='string'==typeof e?e:e.name||e.file;return t===i||t===`${i}.exp3.json`}),!e&&o.textMappings?.expression)for(const[t,s]of Object.entries(o.textMappings.expression)){const r=f(i),a=f(String(s));if((r===a||r.includes(a)||a.includes(r))&&(e=o.expressions?.some(e=>{const i='string'==typeof e?e:e.file;return i===t||i===`${t}.exp3.json`}),e))break}if(!e)return!1}return!0}var S=i(315),P=i(131);class E{canvas=null;app=null;model=null;isInitialized=!1;config=null;getDisplaySize(){const e=this.app?.renderer?.screen?.width,t=this.app?.renderer?.screen?.height;if(e&&t)return{width:e,height:t};return{width:this.canvas?.clientWidth||this.canvas?.offsetWidth||this.canvas?.width||800,height:this.canvas?.clientHeight||this.canvas?.offsetHeight||this.canvas?.height||600}}async init(e){if(!this.isInitialized)try{const t=e.clientWidth||e.offsetWidth||800,i=e.clientHeight||e.offsetHeight||600;console.info('[PixiLive2DRenderer] canvas:',{exists:!!e,clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,finalWidth:t,finalHeight:i}),0!==e.clientWidth&&0!==e.clientHeight||console.warn('[PixiLive2DRenderer] Canvas  0:',{width:t,height:i}),this.canvas=e,this.app=new S.Application({view:e,autoStart:!0,width:t,height:i,backgroundColor:0,backgroundAlpha:0,antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0}),console.info('[PixiLive2DRenderer] Pixi ',{screenWidth:this.app.renderer?.screen?.width,screenHeight:this.app.renderer?.screen?.height}),this.app.renderer?.screen||console.warn('[PixiLive2DRenderer] renderer.screen  canvas ');new ResizeObserver(()=>{this.resize()}).observe(e),this.isInitialized=!0,console.info('[PixiLive2DRenderer] ')}catch(e){const t=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;throw console.error('[PixiLive2DRenderer] :',t),i&&console.error('[PixiLive2DRenderer] :',i),console.error('[PixiLive2DRenderer] :',JSON.stringify({message:t,stack:i},null,2)),e}}async loadModel(e){if(!this.isInitialized||!this.app)throw new Error('');try{console.info(`[PixiLive2DRenderer] : "${e.name}"`);const t=await P.live2dModelManager.getOrLoadModel(e);this.model&&this.app.stage.removeChild(this.model),this.model=t,this.config=e,this.app.stage.addChild(t),t.anchor.set(.5,1);const{width:i,height:s}=this.getDisplaySize(),o=.3*Math.min(i/t.width,s/t.height);if(t.scale.set(o),t.x=i/2,t.y=s,t.alpha=1,t.visible=!0,console.info(`[PixiLive2DRenderer]  "${e.name}" `),e.defaultAnimation){if(e.defaultAnimation.motion){const t=e.motions?.find(t=>(t.name===e.defaultAnimation?.motion||t.file===e.defaultAnimation?.motion)&&'expression'!==t.motionType);if(t&&void 0!==t.index){const e=t.group??'default';this.playMotion(e,t.index,1)}else if(t){const t=e.motions?.findIndex(t=>t.name===e.defaultAnimation?.motion||t.file===e.defaultAnimation?.motion);if(void 0!==t&&t>=0&&e.motions){const i=e.motions[t].group??'default';this.playMotion(i,t,1)}}}if(e.defaultAnimation.expression){const t=e.motions?.find(t=>(t.name===e.defaultAnimation?.expression||t.file===e.defaultAnimation?.expression)&&'expression'===t.motionType);if(t&&void 0!==t.index){const e=t.group??'default';this.playMotion(e,t.index,2)}else{const t=e.expressions?.findIndex(t=>t===e.defaultAnimation?.expression||t.includes(e.defaultAnimation?.expression||''));void 0!==t&&t>=0&&this.playExpression(t)}}}}catch(e){throw console.error('[PixiLive2DRenderer] :',e),new Error(`: ${e instanceof Error?e.message:String(e)}`)}}playMotion(e,t,i=2){if(this.model)try{console.info(`[PixiLive2DRenderer] : ="${e}", =${t}, =${i}`),this.model.motion(e,t,i)}catch(e){console.error('[PixiLive2DRenderer] :',e)}else console.warn('[PixiLive2DRenderer] ')}playExpression(e){if(this.model)try{console.info(`[PixiLive2DRenderer] : =${e}`),this.model.expression(e)}catch(e){console.error('[PixiLive2DRenderer] :',e)}else console.warn('[PixiLive2DRenderer] ')}setPosition(e,t){if(!this.model||!this.app)return;const{width:i,height:s}=this.getDisplaySize();this.model.x=e/100*i,this.model.y=t/100*s}setScale(e){this.model&&this.model.scale.set(e)}getModel(){return this.model}isReady(){return this.isInitialized}setVisible(e){this.model&&(e?(this.model.alpha=1,this.model.visible=!0,console.info('[PixiLive2DRenderer] ')):(this.model.alpha=0,this.model.visible=!1,console.info('[PixiLive2DRenderer] ')))}playMotionByText(e,t){if(!this.model||!this.config?.motions)return!1;const i=e=>e.replace(/[-/\\_.\s]/g,'').toLowerCase(),s=i(e);for(const o of this.config.motions)if(o.textMappings&&o.textMappings.length>0){if(o.textMappings.some(e=>{const t=i(e);return s===t||s.includes(t)||t.includes(s)})){let i=t;if(void 0===i&&(i=2),void 0!==o.index)return console.info(`[PixiLive2DRenderer] : "${o.name}" (group="${o.group}", index=${o.index}, type=${o.motionType}, text="${e}")`),this.playMotion(o.group,o.index,i),!0}}return!1}unloadModel(){this.model&&this.app&&(this.app.stage.removeChild(this.model),this.model.destroy(),this.model=null),this.config=null}destroy(){this.unloadModel(),this.app&&(this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),this.app=null),this.canvas=null,this.isInitialized=!1}resize(e,t){if(!this.canvas||!this.app)return;const i=this.getDisplaySize(),s=e||this.canvas.clientWidth||i.width,o=t||this.canvas.clientHeight||i.height;this.app.renderer.resize(s,o),console.info('[PixiLive2DRenderer] :',{displayWidth:s,displayHeight:o})}}const I=['src'],T=(0,s.defineComponent)({__name:'CharacterSprite',props:{spriteScale:{},spritePositionX:{},spritePositionY:{},live2dScale:{},live2dPositionX:{},live2dPositionY:{},spriteType:{},imageUrl:{},live2dModelId:{},live2dModels:{},motion:{},expression:{}},setup(e){const t=e,i=(0,s.ref)(null);let o,r,a,n=null;const l=(0,s.computed)(()=>({left:`${t.spritePositionX}%`,bottom:100-t.spritePositionY+'%',transform:`translateX(-50%) scale(${t.spriteScale})`,transformOrigin:'bottom center'}));function c(e,t){if(!n)return;if(n.playMotionByText(t))return;let i=t;if(e.textMappings?.motions)for(const[s,o]of Object.entries(e.textMappings.motions))if(o===t||String(o).toLowerCase()===t.toLowerCase()){i=s,console.info(`[CharacterSprite]  textMappings : ${t} -> ${s}`);break}const s=e.motions?.find(e=>{const t='string'==typeof e?e:e.name||e.file;return t===i||t===`${i}.motion3.json`||e.file===i});if(s){const t='string'==typeof s?'idle':s.group??'idle';if('string'!=typeof s&&void 0!==s.index)return console.info(`[CharacterSprite] : group="${t}", index=${s.index}, motion=${i}`),void n.playMotion(t,s.index,2);const o=(e.motions?.filter(e=>('string'==typeof e?'idle':e.group??'idle')===t)||[]).findIndex(e=>{const t='string'==typeof e?e:e.name||e.file;return t===i||t===`${i}.motion3.json`||e.file===i});o>=0&&(console.info(`[CharacterSprite] : group="${t}", index=${o}, motion=${i}`),n.playMotion(t,o,2))}else console.warn(`[CharacterSprite] : ${i}`)}function d(e,t){if(!n)return;if(n.playMotionByText(t,3))return;let i=t;if(e.textMappings?.expressions)for(const[s,o]of Object.entries(e.textMappings.expressions))if(o===t||String(o).toLowerCase()===t.toLowerCase()){i=s,console.info(`[CharacterSprite]  textMappings : ${t} -> ${s}`);break}const s=e.expressions?.findIndex(e=>{const t='string'==typeof e?e:e.name||e.file;return t===i||t===`${i}.exp3.json`||'object'==typeof e&&e.file===i});void 0!==s&&s>=0?(console.info(`[CharacterSprite] : index=${s}, expression=${i}`),n.playExpression(s)):console.warn(`[CharacterSprite] : ${i}`)}async function u(){if(console.info('[CharacterSprite] loadLive2dModel ',{spriteType:t.spriteType,live2dModelId:t.live2dModelId,hasModels:!!t.live2dModels,modelsLength:t.live2dModels?.length||0,hasCanvas:!!i.value}),!t.live2dModelId||!t.live2dModels||!i.value)return void console.warn('[CharacterSprite] ',{live2dModelId:t.live2dModelId,hasModels:!!t.live2dModels,hasCanvas:!!i.value});if(!await async function(){if(n&&n.isReady())return!0;if(await(0,s.nextTick)(),i.value||(console.error('[CharacterSprite] Canvas '),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,s.nextTick)()),!i.value)return console.error('[CharacterSprite] Canvas '),!1;try{n||(console.info('[CharacterSprite]  Pixi Live2D '),n=new E);const e=n;return e?(e.isReady()||(await e.init(i.value),console.info('[CharacterSprite] Pixi Live2D ')),!!e&&e.isReady()):(console.error('[CharacterSprite] '),!1)}catch(e){const t=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;return console.error('[CharacterSprite] :',t),i&&console.error('[CharacterSprite] :',i),!1}}())return void console.error('[CharacterSprite] ');const e=t.live2dModels.map(e=>({id:e.id,name:e.name}));console.info('[CharacterSprite] :',e),console.info('[CharacterSprite] ID:',t.live2dModelId,':',typeof t.live2dModelId);let l=t.live2dModels.find(e=>e.id===t.live2dModelId);if(l||(l=t.live2dModels.find(e=>e.name===t.live2dModelId),l&&console.info(`[CharacterSprite]  name : ${t.live2dModelId} -> ${l.id}`)),l){console.info('[CharacterSprite] :',{id:l.id,name:l.name,modelPath:l.modelPath,basePath:l.basePath,motionsCount:l.motions?.length||0,expressionsCount:l.expressions?.length||0});try{const e=n;if(!e)return void console.error('[CharacterSprite] ');const i=a!==t.live2dModelId;i&&(console.info('[CharacterSprite] ID:',{oldModelId:a,newModelId:t.live2dModelId}),await e.loadModel(l),console.info('[CharacterSprite] Live2D '),a=t.live2dModelId,e.setScale(t.live2dScale),e.setPosition(t.live2dPositionX,t.live2dPositionY),console.info('[CharacterSprite] :',{scale:t.live2dScale,positionX:t.live2dPositionX,positionY:t.live2dPositionY}));const s=o!==t.motion,u=r!==t.expression;(s||u||i)&&(!async function(e){t.expression&&t.motion?(d(e,t.expression),await new Promise(e=>setTimeout(e,3e3)),c(e,t.motion)):(t.expression&&d(e,t.expression),t.motion&&c(e,t.motion))}(l),o=t.motion,r=t.expression)}catch(e){console.error('[CharacterSprite]  Live2D :',e);const s=e instanceof Error?e.message:String(e),o=e instanceof Error?e.stack:void 0,r={message:s,stack:o,modelId:t.live2dModelId,modelConfig:l?{id:l.id,name:l.name}:null,canvasInfo:i.value?{width:i.value.clientWidth,height:i.value.clientHeight,offsetWidth:i.value.offsetWidth,offsetHeight:i.value.offsetHeight}:null,rendererReady:n?.isReady()||!1};console.error('[CharacterSprite] :',JSON.stringify(r,null,2)),console.error('[CharacterSprite] :',s),o&&console.error('[CharacterSprite] :',o),console.error('[CharacterSprite] ID:',t.live2dModelId),console.error('[CharacterSprite] Canvas :',r.canvasInfo),console.error('[CharacterSprite] :',r.rendererReady)}}else console.warn(`[CharacterSprite]  Live2D : ${t.live2dModelId}`,{requestedId:t.live2dModelId,requestedIdType:typeof t.live2dModelId,availableIds:t.live2dModels.map(e=>({id:e.id,idType:typeof e.id,name:e.name})),availableIdsString:JSON.stringify(t.live2dModels.map(e=>e.id)),requestedIdString:JSON.stringify(t.live2dModelId)})}return(0,s.watch)(()=>[t.live2dModelId,t.live2dModels],async(e,a)=>{const n=a?.[1],l=n!==t.live2dModelId;console.info('[CharacterSprite] watch ID:',{live2dModelId:t.live2dModelId,modelsCount:t.live2dModels?.length,oldModelId:n,modelIdChanged:l}),l&&t.live2dModelId&&(o=void 0,r=void 0,await(0,s.nextTick)(),i.value||(console.error('[CharacterSprite] Canvas '),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,s.nextTick)()),i.value?await u():console.error('[CharacterSprite] Canvas '))},{immediate:!0}),(0,s.watch)(()=>t.spriteType,(e,t)=>{console.info('[CharacterSprite] spriteType :',{oldType:t,newType:e,hasRenderer:!!n}),n&&('live2d'===e?(console.info('[CharacterSprite]  Live2D '),n.setVisible(!0)):(console.info('[CharacterSprite]  Live2D '),n.setVisible(!1)))},{immediate:!0}),(0,s.watch)(()=>[t.motion,t.expression],()=>{if('live2d'===t.spriteType&&n&&t.live2dModelId&&t.live2dModels){const e=o!==t.motion,i=r!==t.expression;if(e||i){const s=t.live2dModels.find(e=>e.id===t.live2dModelId);s&&(t.expression&&t.motion&&(i||e)?(i&&t.expression&&d(s,t.expression),e&&t.motion&&setTimeout(()=>{c(s,t.motion)},3e3)):(e&&t.motion&&c(s,t.motion),i&&t.expression&&d(s,t.expression)),o=t.motion,r=t.expression)}}}),(0,s.watch)(()=>[t.live2dScale,t.live2dPositionX,t.live2dPositionY],()=>{'live2d'===t.spriteType&&n&&(n.setScale(t.live2dScale),n.setPosition(t.live2dPositionX,t.live2dPositionY))}),(0,s.onMounted)(async()=>{if(await(0,s.nextTick)(),i.value){if(!n)try{const e=i.value;if(!e)return void console.error('[CharacterSprite] Canvas ');const t=e.clientWidth||e.offsetWidth||800,o=e.clientHeight||e.offsetHeight||600;if(console.info('[CharacterSprite]  Pixi Live2D ',{canvasWidth:t,canvasHeight:o,clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight}),0===t||0===o){console.warn('[CharacterSprite] Canvas  0'),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,s.nextTick)();const t=e.clientWidth||e.offsetWidth||800,i=e.clientHeight||e.offsetHeight||600;if(console.info('[CharacterSprite]  Canvas :',{width:t,height:i}),0===t||0===i)return void console.error('[CharacterSprite] Canvas  0')}n=new E,await n.init(e),console.info('[CharacterSprite] Pixi Live2D ')}catch(e){const t=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;return console.error('[CharacterSprite] :',t),i&&console.error('[CharacterSprite] :',i),void console.error('[CharacterSprite] :',JSON.stringify({message:t,stack:i},null,2))}t.live2dModelId&&t.live2dModels&&(await u(),'live2d'===t.spriteType?n.setVisible(!0):n.setVisible(!1))}else console.error('[CharacterSprite] Canvas ')}),(0,s.onUnmounted)(()=>{n&&(n.destroy(),n=null)}),(t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createCommentVNode)('  -  '),'image'===e.spriteType?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'pointer-events-none absolute z-5 transition-all duration-300',style:(0,s.normalizeStyle)(l.value)},[(0,s.createElementVNode)('img',{src:e.imageUrl,alt:'',class:'h-[70vh] w-auto object-contain drop-shadow-2xl',draggable:'false'},null,8,I)],4)):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)(' Live2D  - / '),(0,s.createElementVNode)('canvas',{ref_key:'live2dCanvasRef',ref:i,class:'live2d-canvas pointer-events-none absolute inset-0 z-5',style:(0,s.normalizeStyle)({width:'100%',height:'100%',display:i.value?'block':'none'})},null,4)],64))}});var B=i(502);const L=(0,B.A)(T,[['__scopeId','data-v-110796a2']]),V={class:'status-container'},N={class:'status-header'},D={class:'status-main-content'},F={class:'status-info-bar'},R={class:'info-item'},A={class:'status-text-card'},O={class:'text-card-row'},U={class:'text-card-content'},j={class:'text-card-row'},G={class:'text-card-content'},W={class:'text-card-row'},H={class:'text-card-content'},X={class:'text-card-row'},Y={class:'text-card-content'},q=(0,s.defineComponent)({__name:'CharacterStatusPanel',props:{show:{type:Boolean},messageId:{},statusBlock:{},onClose:{type:Function}},setup(e){const t=e,i=(0,s.computed)(()=>{const e={:'',:'',:'',:'',:''};return t.statusBlock&&(t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.)),e});return(t,o)=>e.show?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'animate-in fade-in absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm duration-200',onClick:o[2]||(o[2]=(...t)=>e.onClose&&e.onClose(...t))},[(0,s.createElementVNode)('div',{class:'status-container-wrapper',onClick:o[1]||(o[1]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createElementVNode)('div',V,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',N,[o[4]||(o[4]=(0,s.createElementVNode)('span',{class:'summary-icon'},'',-1)),o[5]||(o[5]=(0,s.createElementVNode)('span',{class:'status-title'},'',-1)),(0,s.createElementVNode)('button',{class:'status-close','aria-label':'',onClick:o[0]||(o[0]=(...t)=>e.onClose&&e.onClose(...t))},[...o[3]||(o[3]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',D,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',F,[o[7]||(o[7]=(0,s.createElementVNode)('div',{class:'info-item'},[(0,s.createElementVNode)('span',null,''),(0,s.createElementVNode)('span',{textContent:'{{get_message_variable::stat_data.}}'})],-1)),(0,s.createElementVNode)('div',R,[o[6]||(o[6]=(0,s.createElementVNode)('span',null,'',-1)),(0,s.createElementVNode)('span',null,(0,s.toDisplayString)(i.value.||''),1)])]),(0,s.createCommentVNode)('  '),o[12]||(o[12]=(0,s.createStaticVNode)('<div class="status-values-grid" data-v-330f15ce><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce></div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data..}}</div></div><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce></div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data..}}</div></div><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce></div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data..}}</div></div><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce></div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data..}}</div></div></div>',1)),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',A,[(0,s.createElementVNode)('div',O,[o[8]||(o[8]=(0,s.createElementVNode)('span',{class:'text-card-label'},'',-1)),(0,s.createElementVNode)('span',U,(0,s.toDisplayString)(i.value.||''),1)]),(0,s.createElementVNode)('div',j,[o[9]||(o[9]=(0,s.createElementVNode)('span',{class:'text-card-label'},'',-1)),(0,s.createElementVNode)('span',G,(0,s.toDisplayString)(i.value.||''),1)]),(0,s.createElementVNode)('div',W,[o[10]||(o[10]=(0,s.createElementVNode)('span',{class:'text-card-label'},'',-1)),(0,s.createElementVNode)('span',H,(0,s.toDisplayString)(i.value.||''),1)]),(0,s.createElementVNode)('div',X,[o[11]||(o[11]=(0,s.createElementVNode)('span',{class:'text-card-label'},'',-1)),(0,s.createElementVNode)('span',Y,(0,s.toDisplayString)(i.value.||''),1)])])])])])])):(0,s.createCommentVNode)('v-if',!0)}}),J=(0,B.A)(q,[['__scopeId','data-v-330f15ce']]),Z=['onClick'],K={key:1,class:'flex items-center gap-2'},Q=(0,s.defineComponent)({__name:'ChoiceBox',props:{options:{},customStyle:{},onSelect:{type:Function},onPrev:{type:Function},onNext:{type:Function},onSave:{type:Function}},setup(e){const t=e,i=(0,s.ref)(!1),o=(0,s.ref)(''),n=(0,s.ref)(!1),l=(0,s.ref)(null);function c(){i.value?o.value.trim()&&!n.value?n.value=!0:n.value&&t.onSelect('custom',o.value):(i.value=!0,(0,s.nextTick)(()=>{l.value?.focus()}))}function u(){o.value.trim()&&(n.value?t.onSelect('custom',o.value):n.value=!0)}function h(){o.value.trim()&&t.onSave&&(t.onSave(o.value.trim()),o.value='',i.value=!1,n.value=!1)}(0,s.watch)(()=>t.options,()=>{i.value=!1,o.value='',n.value=!1});const m=(0,s.computed)(()=>t.customStyle||d),p=(0,s.computed)(()=>r.find(e=>e.id===m.value.boxShape)||r[0]),g=(0,s.computed)(()=>a.find(e=>e.id===m.value.borderWidth)||a[1]),v=(0,s.computed)(()=>'pill'===m.value.boxShape);function f(e){const i=e.currentTarget.getBoundingClientRect();e.clientX-i.left<i.width/2&&t.onPrev?.()}return(r,a)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{class:'absolute inset-0 z-25 flex items-center justify-center bg-black/30 backdrop-blur-sm',onClick:f},[(0,s.createElementVNode)('div',{class:'flex w-full max-w-md flex-col gap-3 px-6',onClick:a[2]||(a[2]=(0,s.withModifiers)(()=>{},['stop']))},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.options,(e,i)=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:e.id,class:'w-full p-4 text-left transition-all hover:scale-[1.02] active:scale-[0.98]',style:(0,s.normalizeStyle)({backgroundColor:v.value?'rgba(255, 255, 255, 0.7)':m.value.colors.boxBackground,borderRadius:p.value.borderRadius,borderTopWidth:g.value.width,borderLeftWidth:g.value.width,borderRightWidth:g.value.width,borderBottomWidth:g.value.width,borderStyle:'solid',borderColor:m.value.colors.boxBorder,boxShadow:p.value.shadow,color:m.value.colors.dialogText,fontSize:`${m.value.fontSize}px`,backdropFilter:v.value?'blur(12px)':void 0,WebkitBackdropFilter:v.value?'blur(12px)':void 0}),onClick:()=>{return i=e.id,n.value&&(n.value=!1),void t.onSelect(i);var i}},(0,s.toDisplayString)(e.text),13,Z))),128)),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['w-full p-4 transition-all cursor-pointer',n.value?'ring-2 ring-primary':'']),style:(0,s.normalizeStyle)({backgroundColor:v.value?'rgba(255, 255, 255, 0.7)':m.value.colors.boxBackground,borderRadius:p.value.borderRadius,borderTopWidth:g.value.width,borderLeftWidth:g.value.width,borderRightWidth:g.value.width,borderBottomWidth:g.value.width,borderStyle:'solid',borderColor:m.value.colors.boxBorder,boxShadow:p.value.shadow,fontSize:`${m.value.fontSize}px`,backdropFilter:v.value?'blur(12px)':void 0,WebkitBackdropFilter:v.value?'blur(12px)':void 0}),onClick:c},[i.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',K,[(0,s.withDirectives)((0,s.createElementVNode)('input',{ref_key:'inputRef',ref:l,'onUpdate:modelValue':a[0]||(a[0]=e=>o.value=e),type:'text',placeholder:'...',class:'flex-1 bg-transparent outline-none',style:(0,s.normalizeStyle)({color:m.value.colors.dialogText}),onClick:a[1]||(a[1]=(0,s.withModifiers)(()=>{},['stop'])),onKeydown:(0,s.withKeys)(u,['enter']),autofocus:''},null,36),[[s.vModelText,o.value]]),(0,s.createCommentVNode)(' / '),o.value.trim()?((0,s.openBlock)(),(0,s.createElementBlock)('svg',{key:0,class:'h-5 w-5 transition-colors cursor-pointer',style:(0,s.normalizeStyle)({color:n.value?m.value.colors.nameText:m.value.colors.narrationText}),fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',onClick:(0,s.withModifiers)(u,['stop'])},[...a[4]||(a[4]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'},null,-1)])],4)):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),o.value.trim()?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:1,class:'p-1 transition-colors hover:opacity-80',style:(0,s.normalizeStyle)({color:m.value.colors.nameText}),'aria-label':'',title:'',onClick:(0,s.withModifiers)(h,['stop'])},[...a[5]||(a[5]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12'})],-1)])],4)):(0,s.createCommentVNode)('v-if',!0)])):((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'flex items-center gap-2',style:(0,s.normalizeStyle)({color:m.value.colors.narrationText})},[...a[3]||(a[3]=[(0,s.createElementVNode)('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z'})],-1),(0,s.createElementVNode)('span',null,'...',-1)])],4))],6)])]))}}),ee={class:'absolute bottom-0 left-0 right-0 z-20 px-4 md:px-8 pb-4 md:pb-6'},te={class:'flex items-center gap-2 md:gap-4 max-w-4xl mx-auto'},ie=['disabled'],se={key:0,class:'absolute left-2 top-1/2 -translate-y-1/2 z-10'},oe=['disabled'],re={key:0,class:'ml-auto flex gap-2'},ae=['innerHTML'],ne={class:'absolute bottom-3 right-4'},le={key:2,class:'absolute right-2 top-1/2 -translate-y-1/2 z-10'},ce=['disabled'],de=['disabled'],ue={class:'flex gap-3 mt-4 justify-end'},he=(0,s.defineComponent)({__name:'DialogBox',props:{character:{},text:{},isLastDialogue:{type:Boolean},isFirstDialogue:{type:Boolean},onPrev:{type:Function},onNext:{type:Function},dialogKey:{},customStyle:{},isLoading:{type:Boolean},streamingText:{},isThrough:{type:Boolean},isEditable:{type:Boolean},messageId:{},onEdit:{type:Function},onDelete:{type:Function}},setup(e){const t=e,i=(0,s.ref)(''),u=(0,s.ref)(!0);let h=null;const m=(0,s.ref)(null),p=(0,s.ref)(!1),g=(0,s.computed)(()=>p.value?'justify-start':'justify-center'),v=(0,s.computed)(()=>t.customStyle||d),f=(0,s.computed)(()=>r.find(e=>e.id===v.value.boxShape)||r[0]),x=(0,s.computed)(()=>n.find(e=>e.id===v.value.nameShape)||n[0]),y=(0,s.computed)(()=>l.find(e=>e.id===v.value.arrowShape)||l[0]),C=(0,s.computed)(()=>c.find(e=>e.id===v.value.indicatorShape)||c[0]),b=(0,s.computed)(()=>a.find(e=>e.id===v.value.borderWidth)||a[1]),w=(0,s.computed)(()=>o.find(e=>e.id===v.value.backgroundPattern)),M=(0,s.computed)(()=>!t.character||''===t.character.trim()),k=(0,s.computed)(()=>y.value.isInner),S=(0,s.computed)(()=>'minimal'===y.value.type),P=(0,s.computed)(()=>'pill'===v.value.boxShape),E=(0,s.computed)(()=>{if(!w.value?.pattern)return{};const e=v.value.colors.boxBorder.replace(/[\d.]+\)$/,'0.08)'),t=w.value.pattern.replace(/VAR_BORDER_COLOR/g,e);let i='20px 20px';return'dots'===w.value.id&&(i='16px 16px'),'diamonds'===w.value.id&&(i='16px 16px'),'stripes'===w.value.id&&(i='28px 28px'),{backgroundImage:t,backgroundSize:i}}),I=(0,s.computed)(()=>({backgroundColor:P.value?'rgba(255, 255, 255, 0.7)':v.value.colors.boxBackground,borderRadius:f.value.borderRadius,borderTopWidth:b.value.width,borderLeftWidth:b.value.width,borderRightWidth:b.value.width,borderBottomWidth:b.value.width,borderStyle:'solid',borderColor:v.value.colors.boxBorder,boxShadow:f.value.shadow,...P.value?{backdropFilter:'blur(12px)',WebkitBackdropFilter:'blur(12px)'}:{},...E.value})),T=(0,s.computed)(()=>{const e=t.isFirstDialogue||t.isLastDialogue?`${v.value.colors.arrowIcon}66`:v.value.colors.arrowIcon;if(S.value)return{color:e};const i=v.value.colors.arrowBackground;let s='9999px';return'square'!==y.value.type&&'inner-square'!==y.value.type||(s='6px'),'pill'===y.value.type&&(s='16px'),{backgroundColor:i,borderRadius:s,color:e}}),B=(0,s.computed)(()=>{const e=t.isFirstDialogue?`${v.value.colors.arrowIcon}66`:v.value.colors.arrowIcon;return{background:'inner-round'===y.value.type?v.value.colors.arrowBackground:'transparent',color:e}}),L=(0,s.computed)(()=>{const e=t.isLastDialogue?`${v.value.colors.arrowIcon}66`:v.value.colors.arrowIcon;return{background:'inner-round'===y.value.type?v.value.colors.arrowBackground:'transparent',color:e}}),V=(0,s.computed)(()=>{const{type:e}=C.value,{indicatorColor:i}=v.value.colors;if('none'===e)return null;const o=t.isLoading||!1;return'dots'===e?(0,s.h)('div',{class:'flex gap-1 items-center'},[0,1,2].map(e=>(0,s.h)('span',{key:e,class:'w-1.5 h-1.5 rounded-full transition-opacity duration-500',style:{backgroundColor:i,opacity:o?2===e?1:.4:.6,animation:o&&2===e?'pulse 1s ease-in-out infinite':void 0}}))):'diamonds'===e?(0,s.h)('div',{class:'flex gap-1 items-center'},[0,1,2].map(e=>(0,s.h)('span',{key:e,class:'transition-all duration-300',style:{width:'8px',height:'8px',backgroundColor:i,opacity:o?2===e?1:.3+.15*e:.5,transform:`rotate(45deg) scale(${o&&2===e?1.1:.9})`,animation:o&&2===e?'diamondPulse 1.2s ease-in-out infinite':void 0,display:'inline-block'}}))):'pulse'===e?(0,s.h)('div',{class:'relative w-3 h-3'},[(0,s.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:i,opacity:.4,animation:o?'ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite':void 0}}),(0,s.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:i,animation:o?'pulse 2s ease-in-out infinite':void 0}})]):'arrow'===e?(0,s.h)('svg',{class:'w-4 h-4 transition-transform duration-300',style:{color:i,animation:o?'arrowBounce 0.8s ease-in-out infinite':void 0},fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.h)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})]):null});function N(){t.isFirstDialogue||t.onPrev()}function D(){t.isLastDialogue||t.onNext()}function F(e,t){const i=function(e){return e?e.replace(/\*([^*]+)\*/g,(e,t)=>'through'===t.trim()?e:` <span style="color: #9ca3af; font-style: italic;">${t}</span> `):''}(e);return t?i+'<span class="animate-pulse" style="display: inline; margin-left: 2px;">|</span>':i}function R(){h&&(clearInterval(h),h=null)}function A(){if(R(),t.isLoading)return i.value=t.text,void(u.value=!0);if(!t.text)return i.value='',void(u.value=!1);i.value='',u.value=!0;let e=0;h=setInterval(()=>{e<t.text.length?(i.value=t.text.slice(0,e+1),e++):(u.value=!1,R())},50)}function O(){M.value&&m.value?(0,s.nextTick)(()=>{if(!m.value)return;const e=m.value,t=e.querySelector('span');if(!t||!i.value)return void(p.value=!1);const s=e.offsetWidth-(parseInt(getComputedStyle(e).paddingLeft)||0)-(parseInt(getComputedStyle(e).paddingRight)||0);if(s<=0)return void(p.value=!1);const o=document.createElement('div');o.style.visibility='hidden',o.style.position='absolute',o.style.top='-9999px',o.style.left='-9999px',o.style.width=`${s}px`,o.style.fontSize=`${v.value.fontSize}px`,o.style.fontStyle='italic',o.style.fontFamily=getComputedStyle(e).fontFamily,o.style.lineHeight=getComputedStyle(e).lineHeight,o.style.textAlign='center',o.style.whiteSpace='normal',o.style.wordWrap='break-word',o.style.overflowWrap='break-word';const r=(t.innerHTML||'').replace(/<span[^>]*class="[^"]*animate-pulse[^"]*"[^>]*>.*?<\/span>/gi,'');o.innerHTML=r||'M',document.body.appendChild(o);const a=document.createElement('div');a.style.visibility='hidden',a.style.position='absolute',a.style.top='-9999px',a.style.left='-9999px',a.style.width=`${s}px`,a.style.fontSize=`${v.value.fontSize}px`,a.style.fontStyle='italic',a.style.fontFamily=getComputedStyle(e).fontFamily,a.style.lineHeight=getComputedStyle(e).lineHeight,a.style.textAlign='center',a.style.whiteSpace='nowrap',a.textContent='M',document.body.appendChild(a);const n=a.offsetHeight,l=o.offsetHeight;document.body.removeChild(o),document.body.removeChild(a),p.value=l>1.3*n}):p.value=!1}(0,s.watch)(()=>[t.text,t.dialogKey,t.isLoading],()=>{A()},{immediate:!0}),(0,s.watch)(()=>i.value,()=>{M.value&&setTimeout(()=>{O()},10)}),(0,s.onMounted)(()=>{A(),M.value&&O()}),(0,s.onUnmounted)(()=>{R()});const U=(0,s.ref)(!1),j=(0,s.ref)('');function G(){void 0!==t.messageId&&(j.value=t.text,U.value=!0)}function W(){void 0!==t.messageId&&t.onDelete&&confirm('')&&t.onDelete(t.messageId)}function H(){void 0!==t.messageId&&t.onEdit&&j.value.trim()&&(t.onEdit(t.messageId,j.value.trim()),U.value=!1)}function X(){U.value=!1,j.value=''}return(o,r)=>((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createElementVNode)('div',ee,[(0,s.createElementVNode)('div',te,[(0,s.createCommentVNode)('  '),k.value?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:0,disabled:e.isFirstDialogue,class:(0,s.normalizeClass)(['flex flex-shrink-0 items-center justify-center transition-all duration-200',e.isFirstDialogue?'cursor-not-allowed opacity-40':'hover:scale-105']),style:(0,s.normalizeStyle)(T.value),'aria-label':'',onClick:(0,s.withModifiers)(N,['stop'])},[...r[2]||(r[2]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'})],-1)])],14,ie)),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['flex-1 relative p-4 md:p-5 min-h-[120px]',[M.value?'flex flex-col':'']]),style:(0,s.normalizeStyle)(I.value)},[(0,s.createCommentVNode)('  '),k.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',se,[(0,s.createElementVNode)('button',{disabled:e.isFirstDialogue,class:(0,s.normalizeClass)(['flex items-center justify-center transition-all duration-200',e.isFirstDialogue?'cursor-not-allowed opacity-40':'hover:bg-opacity-100']),style:(0,s.normalizeStyle)(B.value),'aria-label':'',onClick:(0,s.withModifiers)(N,['stop'])},[...r[3]||(r[3]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'})],-1)])],14,oe)])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),M.value?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:1,class:'h-6 mb-2 flex items-start',style:(0,s.normalizeStyle)({paddingLeft:k.value?'48px':0,paddingRight:k.value?'48px':0})},[(0,s.createElementVNode)('div',{class:'px-3 py-1 text-sm font-medium',style:(0,s.normalizeStyle)({backgroundColor:v.value.colors.nameBackground,color:v.value.colors.nameText,borderRadius:x.value.borderRadius,borderBottom:'underline'===x.value.style?`2px solid ${v.value.colors.nameText}`:void 0,boxShadow:'floating'===x.value.style?'0 2px 8px rgba(0,0,0,0.1)':void 0})},(0,s.toDisplayString)(e.character),5),(0,s.createCommentVNode)(' /user '),t.isEditable&&void 0!==t.messageId?((0,s.openBlock)(),(0,s.createElementBlock)('div',re,[(0,s.createElementVNode)('button',{onClick:(0,s.withModifiers)(G,['stop']),class:'p-1 rounded transition-colors hover:bg-black/10','aria-label':'',title:''},[...r[4]||(r[4]=[(0,s.createElementVNode)('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'})],-1)])]),(0,s.createElementVNode)('button',{onClick:(0,s.withModifiers)(W,['stop']),class:'p-1 rounded transition-colors hover:bg-red-500/20','aria-label':'',title:''},[...r[5]||(r[5]=[(0,s.createElementVNode)('svg',{class:'h-4 w-4 text-red-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'})],-1)])])])):(0,s.createCommentVNode)('v-if',!0)],4)),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{ref_key:'textContentRef',ref:m,class:(0,s.normalizeClass)(['leading-relaxed',M.value?`italic text-center flex-1 flex flex-col ${g.value}`:'']),style:(0,s.normalizeStyle)({color:M.value?v.value.colors.narrationText:v.value.colors.dialogText,fontSize:`${v.value.fontSize}px`,paddingLeft:k.value?'48px':0,paddingRight:k.value?'48px':0})},[(0,s.createElementVNode)('span',{innerHTML:F(i.value,u.value)},null,8,ae)],6),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',ne,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(V.value)))]),(0,s.createCommentVNode)('  '),k.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',le,[(0,s.createElementVNode)('button',{disabled:e.isLastDialogue,class:(0,s.normalizeClass)(['flex items-center justify-center transition-all duration-200',e.isLastDialogue?'cursor-not-allowed opacity-40':'hover:bg-opacity-100']),style:(0,s.normalizeStyle)(L.value),'aria-label':'',onClick:(0,s.withModifiers)(D,['stop'])},[...r[6]||(r[6]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})],-1)])],14,ce)])):(0,s.createCommentVNode)('v-if',!0)],6),(0,s.createCommentVNode)('  '),k.value?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:1,disabled:e.isLastDialogue,class:(0,s.normalizeClass)(['flex flex-shrink-0 items-center justify-center transition-all duration-200',e.isLastDialogue?'cursor-not-allowed opacity-40':'hover:scale-105']),style:(0,s.normalizeStyle)(T.value),'aria-label':'',onClick:(0,s.withModifiers)(D,['stop'])},[...r[7]||(r[7]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})],-1)])],14,de))])]),(0,s.createCommentVNode)('  '),U.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:X},[(0,s.createElementVNode)('div',{class:'bg-card rounded-lg p-6 shadow-xl max-w-md w-full mx-4',onClick:r[1]||(r[1]=(0,s.withModifiers)(()=>{},['stop'])),style:(0,s.normalizeStyle)({backgroundColor:v.value.colors.boxBackground,borderColor:v.value.colors.boxBorder,borderWidth:'1px',borderStyle:'solid'})},[(0,s.createElementVNode)('h3',{class:'text-lg font-semibold mb-4',style:(0,s.normalizeStyle)({color:v.value.colors.dialogText})},'',4),(0,s.withDirectives)((0,s.createElementVNode)('textarea',{'onUpdate:modelValue':r[0]||(r[0]=e=>j.value=e),class:'w-full p-3 rounded border resize-none focus:outline-none focus:ring-2',style:(0,s.normalizeStyle)({backgroundColor:v.value.colors.boxBackground,borderColor:v.value.colors.boxBorder,color:v.value.colors.dialogText}),rows:'4',placeholder:'...'},null,4),[[s.vModelText,j.value]]),(0,s.createElementVNode)('div',ue,[(0,s.createElementVNode)('button',{onClick:X,class:'px-4 py-2 rounded transition-colors',style:(0,s.normalizeStyle)({backgroundColor:v.value.colors.boxBorder+'40',color:v.value.colors.dialogText})},'  ',4),(0,s.createElementVNode)('button',{onClick:H,class:'px-4 py-2 rounded transition-colors',style:(0,s.normalizeStyle)({backgroundColor:v.value.colors.nameBackground,color:v.value.colors.nameText})},'  ',4)])],4)])):(0,s.createCommentVNode)('v-if',!0)],64))}}),me=(0,B.A)(he,[['__scopeId','data-v-7ebdc071']]),pe={class:'note-lines'},ge={class:'note-content'},ve={class:'note-text'},fe=(0,s.defineComponent)({__name:'NoteCard',props:{content:{},noteUnitId:{},initialPosition:{}},emits:['close','positionChange'],setup(e,{emit:t}){const i=e,o=t,r=(0,s.ref)(null),a=(0,s.ref)(!1),n=(0,s.ref)({x:0,y:0}),l=(0,s.ref)({x:0,y:0});(0,s.onMounted)(()=>{if(i.noteUnitId){const e=`note_position_${i.noteUnitId}`,t=localStorage.getItem(e);if(t)try{l.value=JSON.parse(t)}catch(e){console.warn('Failed to parse saved note position:',e)}else i.initialPosition&&(l.value=i.initialPosition)}else i.initialPosition&&(l.value=i.initialPosition)}),(0,s.watch)(()=>i.initialPosition,e=>{e&&!a.value&&(l.value=e)});const c=(0,s.computed)(()=>({transform:`translate(${l.value.x}px, ${l.value.y}px)`,cursor:a.value?'grabbing':'grab'}));function d(e){e.target.closest('.note-close-btn')||(h(e.clientX,e.clientY),e.preventDefault())}function u(e){if(!e.target.closest('.note-close-btn')&&e.touches.length>0){const t=e.touches[0];h(t.clientX,t.clientY),e.preventDefault()}}function h(e,t){a.value=!0;const i=r.value?.getBoundingClientRect();i&&(n.value={x:e-i.left,y:t-i.top}),document.addEventListener('mousemove',m),document.addEventListener('mouseup',v),document.addEventListener('touchmove',p,{passive:!1}),document.addEventListener('touchend',f)}function m(e){a.value&&r.value&&g(e.clientX,e.clientY)}function p(e){if(a.value&&r.value&&e.touches.length>0){const t=e.touches[0];g(t.clientX,t.clientY),e.preventDefault()}}function g(e,t){if(!r.value)return;const i=(r.value.closest('.relative')||document.body).getBoundingClientRect(),s=r.value.getBoundingClientRect(),o=e-i.left-n.value.x,a=t-i.top-n.value.y,c=Math.max(0,i.width-s.width),d=Math.max(0,i.height-s.height);l.value={x:Math.max(.5*-s.width,Math.min(o,c+.5*s.width)),y:Math.max(.5*-s.height,Math.min(a,d+.5*s.height))}}function v(){x()}function f(){x()}function x(){a.value=!1,document.removeEventListener('mousemove',m),document.removeEventListener('mouseup',v),document.removeEventListener('touchmove',p),document.removeEventListener('touchend',f),i.noteUnitId&&o('positionChange',i.noteUnitId,l.value)}function y(){o('close')}return(0,s.onUnmounted)(()=>{document.removeEventListener('mousemove',m),document.removeEventListener('mouseup',v),document.removeEventListener('touchmove',p),document.removeEventListener('touchend',f)}),(t,i)=>e.content?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,ref_key:'noteCardRef',ref:r,class:'note-card',style:(0,s.normalizeStyle)(c.value),onMousedown:d,onTouchstart:u},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('button',{class:'note-close-btn','aria-label':'',onClick:(0,s.withModifiers)(y,['stop']),onTouchend:(0,s.withModifiers)(y,['stop'])},[...i[0]||(i[0]=[(0,s.createElementVNode)('svg',{width:'12',height:'12',viewBox:'0 0 12 12',fill:'none',xmlns:'http://www.w3.org/2000/svg'},[(0,s.createElementVNode)('path',{d:'M9 3L3 9M3 3L9 9',stroke:'currentColor','stroke-width':'1.5','stroke-linecap':'round','stroke-linejoin':'round'})],-1)])],32),(0,s.createCommentVNode)('  '),i[1]||(i[1]=(0,s.createElementVNode)('div',{class:'note-border'},null,-1)),(0,s.createCommentVNode)('  -  '),i[2]||(i[2]=(0,s.createElementVNode)('div',{class:'note-dots'},[(0,s.createElementVNode)('div',{class:'note-dot'}),(0,s.createElementVNode)('div',{class:'note-dot'}),(0,s.createElementVNode)('div',{class:'note-dot'})],-1)),(0,s.createCommentVNode)('  -  '),(0,s.createElementVNode)('div',pe,[((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(8,e=>(0,s.createElementVNode)('div',{key:e,class:'note-line'})),64))]),(0,s.createCommentVNode)('  '),i[3]||(i[3]=(0,s.createElementVNode)('div',{class:'note-binding'},null,-1)),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',ge,[(0,s.createElementVNode)('div',ve,(0,s.toDisplayString)(e.content),1)]),(0,s.createCommentVNode)('  -  '),i[4]||(i[4]=(0,s.createStaticVNode)('<div class="note-flower" data-v-68f5f8e2><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-68f5f8e2><circle cx="10" cy="10" r="2" fill="currentColor" data-v-68f5f8e2></circle><circle cx="10" cy="5" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="15" cy="10" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="10" cy="15" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="5" cy="10" r="2.5" fill="currentColor" data-v-68f5f8e2></circle></svg></div>',1))],36)):(0,s.createCommentVNode)('v-if',!0)}}),xe=(0,B.A)(fe,[['__scopeId','data-v-68f5f8e2']]),ye={class:'title-bar'},_e={class:'title-group'},Ce={class:'menu-bar'},be={key:0,class:'menu-item-badge'},we={class:'panel-body relative flex'},Me={key:0,class:'contacts-sidebar'},ke={class:'contacts-list'},Se=['onClick'],Pe={class:'contact-avatar'},Ee={key:0,class:'avatar-unread-dot'},Ie={class:'contact-info'},Te={class:'contact-name'},Be={key:0,class:'contact-badge'},Le={class:'display-wrapper'},Ve={key:0,class:'refresh-indicator'},Ne=['data-owner','innerHTML'],De={key:0,class:'typing-cursor'},Fe={class:'cmd-bar'},Re=['disabled'],Ae=['disabled'],Oe={class:'settings-header'},Ue={class:'settings-body'},ze={class:'settings-item'},$e=(0,s.defineComponent)({__name:'PhonePanel',props:{show:{type:Boolean},messageId:{},statusBlock:{},onClose:{type:Function}},setup(e,{expose:t}){const i=e,o=(0,s.ref)(null),r=(0,s.ref)(!1),a=(0,s.ref)(!1),n=(0,s.ref)(!1),l=(0,s.ref)(''),c=(0,s.ref)(''),d=(0,s.ref)([]),u=(0,s.ref)(new Map),h=(0,s.ref)(new Map),m=(0,s.ref)([]),p=(0,s.ref)(new Set),g=(0,s.ref)('  Phone'),v=(0,s.ref)([]),f=(0,s.ref)(0),x=(0,s.ref)(!1),y=(0,s.ref)(!1),C=(0,s.ref)(null),b=(0,s.ref)(''),w=(0,s.ref)(!1),M=(0,s.ref)(!1),k=(0,s.ref)(new Set),S=(0,s.ref)(null),P=(0,s.ref)(null);function E(){l.value=c.value,localStorage.setItem('phone-panel-bg-url',c.value),a.value=!1,console.info('[PhonePanel] :',c.value)}function I(){c.value='',l.value='';try{localStorage.removeItem('phone-panel-bg-url')}catch(e){console.warn('URL:',e)}a.value=!1}function T(){C.value&&(clearTimeout(C.value),C.value=null),y.value=!1,i.onClose()}function B(e){const t=e.match(/<StatusBlock>([\s\S]*?)<\/StatusBlock>/i);if(!t)return null;const i=t[1].match(/<skit>\s*([\s\S]*?)<\/skit>/i);if(!i)return null;const s=i[1].trim();if(!s)return null;const o=s.match(/^([^:\n]+?)[:]\s*(.+)$/s);if(o){return{title:o[1].trim(),content:o[2].trim()}}return{title:'',content:s}}function L(e){const t=/<phone>([\s\S]*?)<\/phone>/gi.exec(e);if(!t)return null;const i=t[1].trim().match(/(?:)?([^:]+)(?:)?[:](.*?)(?:\|(.+))?$/);if(!i)return null;const s=i[1].trim(),o=i[2].trim(),r=i[3]?.trim();let a='user';try{const e=new RawCharacter(RawCharacter.find({name:'current'})).getCardData();e.data?.user_name&&(a=e.data.user_name)}catch(e){console.warn('[PhonePanel] ')}const n=s===a||/user||/i.test(s);return{contact:n?'':s,messages:[{speaker:s,content:o,timestamp:r,isUser:n,hideLabel:!1}]}}function V(e){o.value=e;const t=h.value.get(e)||[];d.value=[...t],p.value.delete(e),(0,s.nextTick)(()=>{F()}),k.value.has(e)||A(e)}function N(){if(!b.value.trim()||!o.value)return;const e={speaker:'',content:b.value.trim(),isUser:!0,hideLabel:!1,timestamp:D()},t=u.value.get(o.value)||[];t.push(e),u.value.set(o.value,t);const i=h.value.get(o.value)||[];i.push(e),h.value.set(o.value,i),d.value.push(e),b.value='',(0,s.nextTick)(()=>{F()}),console.info('[PhonePanel] :',e)}function D(){try{if('undefined'!=typeof Mvu&&Mvu.get){const e=Mvu.get('');if(e){const t=e.match(/(\d{4})\/(\d{1,2})\/(\d{1,2}).*?(\d{1,2}):(\d{2})/);if(t)return`${t[1]}-${t[2].padStart(2,'0')}-${t[3].padStart(2,'0')} ${t[4].padStart(2,'0')}:${t[5]}`}}}catch(e){console.warn('[PhonePanel]  MVU :',e)}const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,'0')}-${String(e.getDate()).padStart(2,'0')} ${String(e.getHours()).padStart(2,'0')}:${String(e.getMinutes()).padStart(2,'0')}`}function F(){S.value&&(S.value.scrollTop=S.value.scrollHeight)}function R(){S.value&&o.value&&(0!==S.value.scrollTop||M.value||k.value.has(o.value)||(M.value=!0,A(o.value)))}async function A(e){try{console.info('[PhonePanel] :',e);const t=`[${e}]`,i=[];try{const e=getCharWorldbookNames('current');e.primary&&i.push(e.primary),i.push(...e.additional)}catch(e){console.warn('[PhonePanel] :',e)}if(0===i.length)return console.warn('[PhonePanel] '),void(M.value=!1);let r='';for(const e of i)try{const i=(await getWorldbook(e)).find(e=>e.enabled&&e.name===t);if(i){r=i.content,console.info('[PhonePanel] :',t,':',r.length);break}}catch(t){console.warn('[PhonePanel] :',e,t)}if(!r)return console.info('[PhonePanel] :',t),k.value.add(e),void(M.value=!1);const a=[],n=r.split('\n').filter(e=>e.trim());let l='user';try{const e=new RawCharacter(RawCharacter.find({name:'current'})).getCardData();e.data?.user_name&&(l=e.data.user_name)}catch(e){console.warn('[PhonePanel] ')}for(const e of n){const t=e.match(/^([^:]+)[:](.*?)(?:\|(.+))?$/);if(t){const e=t[1].trim(),i=t[2].trim(),s=t[3]?.trim(),o=e===l||'user'===e||/user||/i.test(e);a.push({speaker:e,content:i,timestamp:s,isUser:o,hideLabel:!1})}}for(let e=1;e<a.length;e++)a[e].speaker===a[e-1].speaker&&(a[e].hideLabel=!0);const c=h.value.get(e)||[];if(h.value.set(e,[...a,...c]),o.value===e){const e=S.value?.scrollHeight||0;d.value=[...a,...d.value],(0,s.nextTick)(()=>{if(S.value){const t=S.value.scrollHeight;S.value.scrollTop=t-e}})}k.value.add(e),console.info('[PhonePanel] :',a.length)}catch(e){console.error('[PhonePanel] :',e)}finally{M.value=!1}}async function O(e,t){try{const i=`[${e}]`,s=[];try{const e=getCharWorldbookNames('current');e.primary&&s.push(e.primary),s.push(...e.additional)}catch(e){console.warn('[PhonePanel] :',e)}if(0===s.length)return void console.warn('[PhonePanel] ');const o=s[0],r=(await getWorldbook(o)).find(e=>e.name===i),a=t.map(e=>`${e.speaker}${e.content}${e.timestamp?`|${e.timestamp}`:''}`).join('\n');if(r)r.content+='\n'+a,await replaceWorldbook(o,[r]),console.info('[PhonePanel] :',i);else{const t={name:i,content:a,enabled:!0,keys:[e],priority:100};await replaceWorldbook(o,[t]),console.info('[PhonePanel] :',i)}}catch(e){console.error('[PhonePanel] :',e)}}function U(){0!==v.value.length&&(f.value>=v.value.length?console.info('[PhonePanel] '):(y.value=!0,W(!0)))}function j(){0!==v.value.length&&(f.value>=v.value.length?console.info('[PhonePanel] '):(y.value=!1,C.value&&(clearTimeout(C.value),C.value=null),W(!1)))}function G(){y.value=!1,C.value&&(clearTimeout(C.value),C.value=null),f.value=0,d.value=[],console.info('[PhonePanel] ')}function W(e){if(f.value>=v.value.length)return void(y.value=!1);const t=v.value[f.value];f.value++,x.value=!0;const i=t.content.length>50?30:50;d.value.push({...t,content:''});const s=d.value.length-1;let o=0;const r=setInterval(()=>{o<t.content.length?(d.value[s].content+=t.content[o],o++,F()):(clearInterval(r),x.value=!1,e&&y.value&&(C.value=window.setTimeout(()=>{W(!0)},800)))},i)}async function H(){try{const e=await async function(){return new Promise((e,t)=>{if(void 0!==window.html2canvas)return void e(window.html2canvas);const i=document.createElement('script');i.src='https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',i.onload=()=>{void 0!==window.html2canvas?e(window.html2canvas):t(new Error('html2canvas '))},i.onerror=()=>t(new Error('html2canvas ')),document.head.appendChild(i)})}();if(x.value=!1,await(0,s.nextTick)(),!P.value)return;const t=await e(P.value,{backgroundColor:'#fdfdfb',scale:2}),i=document.createElement('a');i.download=`_${Date.now()}.png`,i.href=t.toDataURL(),i.click(),console.info('[PhonePanel] ')}catch(e){console.error('[PhonePanel] :',e)}}async function X(){g.value='  Phone',v.value=[],m.value=[],f.value=0,Y();try{let e=null;if(void 0!==i.messageId){const t=getChatMessages(i.messageId);if(t.length>0){e=B(t[0].message||'')}}if(!e)try{const t=void 0!==i.messageId?i.messageId:'function'==typeof getLastMessageId?getLastMessageId():null;if(null!==t)for(let i=t;i>=Math.max(0,t-10);i--){const t=getChatMessages(i);if(t.length>0){if(e=B(t[0].message||''),e)break}}}catch(e){console.warn(':',e)}if(!e&&i.statusBlock?.){const t=i.statusBlock.,s=t.match(/^([^:\n]+?)[:]\s*(.+)$/s);e=s?{title:s[1].trim(),content:s[2].trim()}:{title:'',content:t}}e&&e.content?(g.value=e.title||'  Phone',v.value=function(e){const t=[],i=/([^:]+)[:](.*?)/g;let s,o='user';try{const e=new RawCharacter(RawCharacter.find({name:'current'})).getCardData();e.data?.user_name&&(o=e.data.user_name)}catch(e){console.warn('[PhonePanel]  "user"')}for(;null!==(s=i.exec(e));){const e=s[1]?.trim()||'',i=s[2]?.trim()||'',r=e.split('')[0].split('(')[0].trim(),a=/<user>/i.test(e)||r===o||/user||/i.test(r);t.push({speaker:e,content:i,isUser:a,hideLabel:!1}),a||m.value.includes(r)||(m.value.push(r),console.info('[PhonePanel] :',r))}for(let e=1;e<t.length;e++)t[e].speaker===t[e-1].speaker&&(t[e].hideLabel=!0);return t}(e.content),console.info('[PhonePanel] :',v.value.length),m.value.length>0&&!o.value&&V(m.value[0]),p.value.size>0&&(r.value=!0)):g.value='  Phone'}catch(e){console.error('[PhonePanel] :',e)}}function Y(){C.value&&(clearTimeout(C.value),C.value=null),y.value=!1,x.value=!1}return(0,s.onMounted)(()=>{const e=localStorage.getItem('phone-panel-bg-url');e&&(l.value=e,c.value=e);const t=()=>{n.value=!!document.fullscreenElement};document.addEventListener('fullscreenchange',t);const i=setInterval(()=>{!async function(){try{const e='function'==typeof getLastMessageId?getLastMessageId():-1;if(e<0)return;const t=[];try{const i=Math.max(0,e-4);for(let s=e;s>=i;s--){const e=getChatMessages(s);e.length>0&&t.unshift(...e)}}catch(e){return void console.warn('[PhonePanel] :',e)}const i=t.slice(-5);for(const e of i){const t=/<phone>([\s\S]*?)<\/phone>/gi;let i;for(;null!==(i=t.exec(e.message||''));){const e=L(i[0]);if(e&&e.contact&&e.contact!==o.value){p.value.add(e.contact),m.value.includes(e.contact)||m.value.push(e.contact);const t=h.value.get(e.contact)||[];t.push(...e.messages),h.value.set(e.contact,t),O(e.contact,e.messages)}}}}catch(e){console.error('[PhonePanel] :',e)}}()},2e3);(0,s.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',t),clearInterval(i),C.value&&clearTimeout(C.value)})}),(0,s.watch)(()=>[i.show,i.messageId,i.statusBlock],async()=>{i.show?await X():Y()},{immediate:!0}),(0,s.watch)(()=>i.show,e=>{e||(f.value=0,y.value=!1,x.value=!1,C.value&&(clearTimeout(C.value),C.value=null))}),t({getPendingMessages:function(){const e=[];for(const[t,i]of u.value.entries())if(i.length>0){const s=i.map(e=>`${e.content}${e.timestamp?`|${e.timestamp}`:''}`).join('\n');e.push(`<phone>\n${t}${s}\n</phone>`)}return u.value.clear(),e.join('\n')}}),(t,i)=>e.show?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:(0,s.withModifiers)(T,['self'])},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['theater-window relative max-h-[85vh] w-[90%] max-w-md overflow-hidden rounded-xl shadow-2xl',{'theater-window-fullscreen':n.value}])},[(0,s.createCommentVNode)('  -  '),(0,s.createElementVNode)('div',ye,[(0,s.createElementVNode)('div',_e,[i[7]||(i[7]=(0,s.createElementVNode)('div',{class:'icon-charm'},null,-1)),(0,s.createElementVNode)('span',null,(0,s.toDisplayString)(o.value?`${o.value}`:g.value),1)]),(0,s.createElementVNode)('div',{class:'win-controls'},[(0,s.createElementVNode)('button',{class:'win-btn btn-close','aria-label':'',onClick:T},[...i[8]||(i[8]=[(0,s.createElementVNode)('svg',{t:'1766144599366',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'4447',width:'12',height:'12'},[(0,s.createElementVNode)('path',{d:'M886.784 746.496q29.696 30.72 43.52 56.32t-4.608 58.368q-4.096 6.144-11.264 14.848t-14.848 16.896-15.36 14.848-12.8 9.728q-25.6 15.36-60.416 8.192t-62.464-34.816l-43.008-43.008-57.344-57.344-67.584-67.584-73.728-73.728-131.072 131.072q-60.416 60.416-98.304 99.328-38.912 38.912-77.312 48.128t-68.096-17.408l-7.168-7.168-11.264-11.264-11.264-11.264q-6.144-6.144-7.168-8.192-11.264-14.336-13.312-29.184t2.56-29.184 13.824-27.648 20.48-24.576q9.216-8.192 32.768-30.72l55.296-57.344q33.792-32.768 75.264-73.728t86.528-86.016q-49.152-49.152-93.696-93.184t-79.872-78.848-57.856-56.832-27.648-27.136q-26.624-26.624-27.136-52.736t17.92-52.736q8.192-10.24 23.552-24.064t21.504-17.92q30.72-20.48 55.296-17.92t49.152 28.16l31.744 31.744q23.552 23.552 58.368 57.344t78.336 76.288 90.624 88.576q38.912-38.912 76.288-75.776t69.632-69.12 58.368-57.856 43.52-43.008q24.576-23.552 53.248-31.232t55.296 12.8q1.024 1.024 6.656 5.12t11.264 9.216 10.752 9.728 7.168 5.632q27.648 26.624 27.136 57.856t-27.136 57.856q-18.432 18.432-45.568 46.08t-60.416 60.416-70.144 69.632l-77.824 77.824q37.888 36.864 74.24 72.192t67.584 66.048 56.32 56.32 41.472 41.984z','p-id':'4448',fill:'currentColor'})],-1)])])])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Ce,[(0,s.createElementVNode)('span',{class:'menu-item',onClick:i[0]||(i[0]=e=>r.value=!r.value)},[(0,s.createTextVNode)((0,s.toDisplayString)(r.value?'':'')+' ',1),p.value.size>0?((0,s.openBlock)(),(0,s.createElementBlock)('span',be)):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createElementVNode)('span',{class:'menu-item',onClick:H},''),(0,s.createElementVNode)('span',{class:'menu-item',onClick:i[1]||(i[1]=e=>a.value=!a.value)},'')]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',we,[(0,s.createCommentVNode)('  '),r.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',Me,[i[9]||(i[9]=(0,s.createElementVNode)('div',{class:'contacts-header'},'',-1)),(0,s.createElementVNode)('div',ke,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(m.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e,class:(0,s.normalizeClass)(['contact-item',{active:o.value===e,'has-unread':p.value.has(e)}]),onClick:t=>V(e)},[(0,s.createElementVNode)('div',Pe,[(0,s.createTextVNode)((0,s.toDisplayString)(e.charAt(0))+' ',1),p.value.has(e)?((0,s.openBlock)(),(0,s.createElementBlock)('div',Ee)):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createElementVNode)('div',Ie,[(0,s.createElementVNode)('div',Te,(0,s.toDisplayString)(e),1)]),p.value.has(e)?((0,s.openBlock)(),(0,s.createElementBlock)('div',Be)):(0,s.createCommentVNode)('v-if',!0)],10,Se))),128))])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)(' / '),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['chat-area',{'w-full':!r.value,'w-2/3':r.value}])},[(0,s.createElementVNode)('div',Le,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'bg-image',style:(0,s.normalizeStyle)({backgroundImage:l.value?`url('${l.value}')`:'url(\'https://files.catbox.moe/2td8l0.jpg\')'})},null,4),i[12]||(i[12]=(0,s.createElementVNode)('div',{class:'watermark-xi'},'',-1)),(0,s.createElementVNode)('div',{ref_key:'scrollContainer',ref:S,class:'scroll-container',onScroll:R},[(0,s.createCommentVNode)('  '),M.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',Ve,[...i[10]||(i[10]=[(0,s.createElementVNode)('div',{class:'refresh-spinner'},null,-1),(0,s.createElementVNode)('span',null,'...',-1)])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{ref_key:'chatLog',ref:P,class:'chat-log'},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(d.value,(e,t)=>{return(0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:t},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['message-container',e.isUser?'message-right':'message-left'])},[(0,s.createCommentVNode)('  '),e.hideLabel?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:(0,s.normalizeClass)(['speaker-label',e.isUser?'text-right':'text-left'])},(0,s.toDisplayString)(e.speaker),3)),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['bubble',e.isUser?'bubble-right':'bubble-left']),'data-owner':e.speaker,innerHTML:(i=e.content,i.replace(/[(]([^)]+)[)]/g,'<span style="font-family: \'KaiTi\', \'\', serif; font-size: 0.9em; color: #888; margin: 0 2px;">$1</span>'))},null,10,Ne),(0,s.createCommentVNode)('  '),e.timestamp?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:1,class:(0,s.normalizeClass)(['timestamp',e.isUser?'text-right':'text-left'])},(0,s.toDisplayString)(e.timestamp),3)):(0,s.createCommentVNode)('v-if',!0)],2)],64);var i}),128)),(0,s.createCommentVNode)('  '),x.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',De,[...i[11]||(i[11]=[(0,s.createElementVNode)('span',{class:'cursor'},null,-1)])])):(0,s.createCommentVNode)('v-if',!0)],512)],544)]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Fe,[(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':i[2]||(i[2]=e=>b.value=e),type:'text',class:'cmd-input',disabled:x.value||w.value,placeholder:'...',onKeydown:(0,s.withKeys)(N,['enter'])},null,40,Re),[[s.vModelText,b.value]]),(0,s.createElementVNode)('button',{class:'cmd-send-btn',disabled:x.value||w.value||!b.value.trim()||!o.value,onClick:N},[...i[13]||(i[13]=[(0,s.createElementVNode)('svg',{t:'1766144631220',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'5495',width:'16',height:'16'},[(0,s.createElementVNode)('path',{d:'M1023.200312 43.682936L877.057399 920.640375c-1.899258 10.995705-8.096837 19.592347-18.292854 25.689965-5.29793 2.898868-11.295588 4.598204-17.693089 4.598204-4.19836 0-8.796564-0.99961-13.69465-2.898868l-236.707536-96.762202c-12.994924-5.29793-27.889106-1.499414-36.785631 9.296368l-123.251855 150.341273c-6.897306 8.796564-16.293635 13.094885-27.989066 13.094885-4.898087 0-9.096447-0.799688-12.695041-2.299102-7.197189-2.698946-12.994924-6.997267-17.393206-13.394768-4.398282-6.29754-6.697384-13.194846-6.697384-20.891839V811.083171c0-14.794221 5.098009-28.988676 14.394377-40.484186l478.912925-587.070676-602.864506 521.796174c-4.598204 3.898477-10.995705 4.998048-16.493557 2.698945L23.390863 619.358063C9.296369 614.060133 1.599375 603.664194 0.599766 587.870363c-0.799688-15.194065 5.29793-26.489652 18.292854-33.786802L968.921515 5.997657c5.797735-3.498633 11.795392-5.098009 18.292854-5.098008 7.696993 0 14.594299 2.199141 20.691918 6.397501 12.695041 8.996486 17.593128 21.291683 15.294025 36.385786z','p-id':'5496',fill:'currentColor'})],-1)])],8,Ae)]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'status-bar'},[(0,s.createElementVNode)('button',{class:'jade-btn',onClick:U},' '),(0,s.createElementVNode)('button',{class:'jade-btn',onClick:j},' '),(0,s.createElementVNode)('button',{class:'jade-btn jade-btn-red',onClick:G},' ')])],2)]),(0,s.createCommentVNode)('  '),a.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'settings-overlay',onClick:i[6]||(i[6]=e=>a.value=!1)},[(0,s.createElementVNode)('div',{class:'settings-panel',onClick:i[5]||(i[5]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createElementVNode)('div',Oe,[i[14]||(i[14]=(0,s.createElementVNode)('h3',null,'',-1)),(0,s.createElementVNode)('button',{class:'settings-close',onClick:i[3]||(i[3]=e=>a.value=!1)},'')]),(0,s.createElementVNode)('div',Ue,[(0,s.createElementVNode)('div',ze,[i[15]||(i[15]=(0,s.createElementVNode)('label',null,'URL',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':i[4]||(i[4]=e=>c.value=e),type:'text',class:'settings-input',placeholder:'URL',onBlur:E},null,544),[[s.vModelText,c.value]]),(0,s.createElementVNode)('button',{class:'settings-btn',onClick:I},'')])])])])):(0,s.createCommentVNode)('v-if',!0)],2)])):(0,s.createCommentVNode)('v-if',!0)}}),je=(0,B.A)($e,[['__scopeId','data-v-eef7e62c']]),Ge={class:'space-y-1.5'},We={class:'flex items-center justify-between'},He={class:'text-muted-foreground text-xs'},Xe={class:'flex items-center gap-2'},Ye={class:'text-muted-foreground w-5 text-[10px]'},qe=['onPointerdown','onPointermove','onPointerup'],Je={class:'text-muted-foreground w-9 text-right text-[10px]'},Ze=(0,s.defineComponent)({__name:'ColorSlider',props:{label:{},value:{},showAlpha:{type:Boolean,default:!0}},emits:['update:value'],setup(e,{emit:t}){const i=e,o=t;function r(e){let t=0,i=0,s=0,o=1;if(e.startsWith('rgba')){const r=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);r&&(t=Number.parseInt(r[1])/255,i=Number.parseInt(r[2])/255,s=Number.parseInt(r[3])/255,o=r[4]?Number.parseFloat(r[4]):1)}else if(e.startsWith('rgb')){const o=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);o&&(t=Number.parseInt(o[1])/255,i=Number.parseInt(o[2])/255,s=Number.parseInt(o[3])/255)}else if(e.startsWith('#')){const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);r&&(t=Number.parseInt(r[1],16)/255,i=Number.parseInt(r[2],16)/255,s=Number.parseInt(r[3],16)/255,o=r[4]?Number.parseInt(r[4],16)/255:1)}const r=Math.max(t,i,s),a=Math.min(t,i,s);let n=0,l=0;const c=(r+a)/2;if(r!==a){const e=r-a;switch(l=c>.5?e/(2-r-a):e/(r+a),r){case t:n=((i-s)/e+(i<s?6:0))/6;break;case i:n=((s-t)/e+2)/6;break;case s:n=((t-i)/e+4)/6}}return{h:Math.round(360*n),s:Math.round(100*l),l:Math.round(100*c),a:o}}function a(e,t,i,s){t/=100,i/=100;const o=t=>(t+e/30)%12,r=e=>i-t*Math.min(i,1-i)*Math.max(-1,Math.min(o(e)-3,Math.min(9-o(e),1))),a=Math.round(255*r(0)),n=Math.round(255*r(8)),l=Math.round(255*r(4));return s<1?`rgba(${a}, ${n}, ${l}, ${s.toFixed(2)})`:`#${a.toString(16).padStart(2,'0')}${n.toString(16).padStart(2,'0')}${l.toString(16).padStart(2,'0')}`}function n(e){if(e.startsWith('#'))return e.slice(0,7).toUpperCase();const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t){return`#${Number.parseInt(t[1]).toString(16).padStart(2,'0')}${Number.parseInt(t[2]).toString(16).padStart(2,'0')}${Number.parseInt(t[3]).toString(16).padStart(2,'0')}`.toUpperCase()}return'#000000'}const l=(0,s.computed)(()=>r(i.value)),c=(0,s.computed)(()=>n(i.value)),d=(0,s.ref)(c.value),u=(0,s.ref)(l.value),h=(0,s.ref)(!1),m={},p=(0,s.ref)(null),g=(0,s.ref)(null),v=(0,s.ref)(null);(0,s.watch)(()=>i.value,()=>{if(!h.value){const e=r(i.value);u.value=e,d.value=c.value}});const f=(0,s.computed)(()=>{const e=[{key:'h',label:'H',min:0,max:360,currentValue:u.value.h,gradient:'linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)',step:1,thumbColor:`hsl(${u.value.h}, 100%, 50%)`,displayValue:`${Math.round(u.value.h)}`},{key:'s',label:'S',min:0,max:100,currentValue:u.value.s,gradient:`linear-gradient(to right, hsl(${u.value.h}, 0%, ${u.value.l}%), hsl(${u.value.h}, 100%, ${u.value.l}%))`,step:1,thumbColor:a(u.value.h,u.value.s,u.value.l,1),displayValue:`${Math.round(u.value.s)}%`},{key:'l',label:'L',min:0,max:100,currentValue:u.value.l,gradient:`linear-gradient(to right, #000, hsl(${u.value.h}, ${u.value.s}%, 50%), #fff)`,step:1,thumbColor:a(u.value.h,u.value.s,u.value.l,1),displayValue:`${Math.round(u.value.l)}%`}];return i.showAlpha&&e.push({key:'a',label:'A',min:0,max:1,currentValue:u.value.a,gradient:`linear-gradient(to right, transparent, ${a(u.value.h,u.value.s,u.value.l,1)})`,step:.01,thumbColor:a(u.value.h,u.value.s,u.value.l,u.value.a),displayValue:`${Math.round(100*u.value.a)}%`}),e});function x(e,t){const i=m[t.key];if(!i)return;const s=i.getBoundingClientRect(),r=Math.max(0,Math.min(e.clientX-s.left,s.width))/s.width,n=t.min+r*(t.max-t.min),l=t.step<1?Math.round(100*n)/100:Math.round(n);u.value={...u.value,[t.key]:l};const c=a(u.value.h,u.value.s,u.value.l,u.value.a);o('update:value',c)}function y(){if(h.value){const e=a(u.value.h,u.value.s,u.value.l,u.value.a);o('update:value',e),h.value=!1}}function C(e){const t=e.target.value.toUpperCase();if(d.value=t,/^#[0-9A-F]{6}$/.test(t)){const e=r(t);e.a=u.value.a,u.value=e,o('update:value',a(e.h,e.s,e.l,e.a))}}function b(){d.value=n(i.value)}return(t,i)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Ge,[(0,s.createElementVNode)('div',We,[(0,s.createElementVNode)('label',He,(0,s.toDisplayString)(e.label),1),(0,s.createElementVNode)('div',Xe,[(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':i[0]||(i[0]=e=>d.value=e),type:'text',class:'bg-background text-foreground w-20 rounded border px-2 py-0.5 font-mono text-xs',placeholder:'#000000',onInput:C,onBlur:b},null,544),[[s.vModelText,d.value]]),(0,s.createElementVNode)('div',{class:'border-border h-6 w-6 rounded border shadow-sm',style:(0,s.normalizeStyle)({backgroundColor:e.value})},null,4)])]),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(f.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e.key,class:'flex items-center gap-2'},[(0,s.createElementVNode)('span',Ye,(0,s.toDisplayString)(e.label),1),(0,s.createElementVNode)('div',{ref_for:!0,ref:t=>m[e.key]=t,class:'relative flex h-6 flex-1 cursor-pointer touch-none items-center',onPointerdown:t=>function(e,t){h.value=!0,p.value=t.key,e.currentTarget.setPointerCapture(e.pointerId),x(e,t);const i=e=>{p.value===t.key&&h.value&&x(e,t)},s=()=>{p.value===t.key&&(y(),p.value=null,g.value&&document.removeEventListener('pointermove',g.value),v.value&&document.removeEventListener('pointerup',v.value),e.currentTarget instanceof HTMLElement&&e.currentTarget.releasePointerCapture(e.pointerId))};g.value=i,v.value=s,document.addEventListener('pointermove',i),document.addEventListener('pointerup',s)}(t,e),onPointermove:t=>function(e,t){p.value===t.key&&h.value&&x(e,t)}(t,e),onPointerup:t=>function(e,t){p.value===t.key&&(y(),p.value=null,e.currentTarget instanceof HTMLElement&&e.currentTarget.releasePointerCapture(e.pointerId))}(t,e)},[(0,s.createElementVNode)('div',{class:'absolute inset-y-2 right-0 left-0 rounded-full',style:(0,s.normalizeStyle)({background:e.gradient})},null,4),(0,s.createElementVNode)('div',{class:'pointer-events-none absolute top-1/2 h-4 w-4 -translate-y-1/2 rounded-full border-2 border-white shadow-md',style:(0,s.normalizeStyle)({left:`calc(${(e.currentValue-e.min)/(e.max-e.min)*100}% - 8px)`,background:e.thumbColor})},null,4)],40,qe),(0,s.createElementVNode)('span',Je,(0,s.toDisplayString)(e.displayValue),1)]))),128))]))}}),Ke=(0,B.A)(Ze,[['__scopeId','data-v-6137eb39']]),Qe={class:'flex items-center gap-1'},et={key:0,class:'p-1'},tt={key:0,class:'absolute left-1 top-1/2 -translate-y-1/2'},it={class:'absolute bottom-1.5 right-2'},st={key:1,class:'absolute right-1 top-1/2 -translate-y-1/2'},ot={key:1,class:'p-1'},rt=(0,s.defineComponent)({__name:'DialogPreview',props:{style:{}},setup(e){const t=e,i=(0,s.computed)(()=>t.style),d=(0,s.computed)(()=>r.find(e=>e.id===i.value.boxShape)||r[0]),u=(0,s.computed)(()=>n.find(e=>e.id===i.value.nameShape)||n[0]),h=(0,s.computed)(()=>l.find(e=>e.id===i.value.arrowShape)||l[0]),m=(0,s.computed)(()=>c.find(e=>e.id===i.value.indicatorShape)||c[0]),p=(0,s.computed)(()=>a.find(e=>e.id===i.value.borderWidth)||a[1]),g=(0,s.computed)(()=>o.find(e=>e.id===i.value.backgroundPattern)),v=(0,s.computed)(()=>h.value.isInner),f=((0,s.computed)(()=>'minimal'===h.value.type),(0,s.computed)(()=>'pill'===i.value.boxShape)),x=(0,s.computed)(()=>'square'===h.value.type||'inner-square'===h.value.type?'4px':'pill'===h.value.type?'12px':'9999px'),y=(0,s.computed)(()=>{if(!g.value?.pattern)return{};const e=i.value.colors.boxBorder.replace(/[\d.]+\)$/,'0.08)'),t=g.value.pattern.replace(/VAR_BORDER_COLOR/g,e);let s='20px 20px';return'dots'===g.value.id&&(s='16px 16px'),'diamonds'===g.value.id&&(s='16px 16px'),'stripes'===g.value.id&&(s='28px 28px'),{backgroundImage:t,backgroundSize:s}}),C=(0,s.computed)(()=>({backgroundColor:f.value?'rgba(255,255,255,0.7)':i.value.colors.boxBackground,borderRadius:d.value.borderRadius,borderTopWidth:p.value.width,borderLeftWidth:p.value.width,borderRightWidth:p.value.width,borderBottomWidth:p.value.width,borderStyle:'solid',borderColor:i.value.colors.boxBorder,boxShadow:d.value.shadow,...f.value?{backdropFilter:'blur(12px)',WebkitBackdropFilter:'blur(12px)'}:{},...y.value})),b=(0,s.computed)(()=>{const{type:e}=m.value,t=i.value.colors.indicatorColor;return'none'===e?null:'dots'===e?(0,s.h)('div',{class:'flex gap-0.5 items-center'},[0,1,2].map(e=>(0,s.h)('span',{key:e,class:'w-1 h-1 rounded-full',style:{backgroundColor:t,opacity:2===e?1:.4}}))):'diamonds'===e?(0,s.h)('div',{class:'flex gap-0.5 items-center'},[0,1,2].map(e=>(0,s.h)('span',{key:e,style:{width:'8px',height:'8px',backgroundColor:t,opacity:2===e?1:.3+.15*e,transform:'rotate(45deg)',display:'inline-block'}}))):'pulse'===e?(0,s.h)('div',{class:'relative w-2 h-2'},[(0,s.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:t}})]):'arrow'===e?(0,s.h)('svg',{class:'w-3 h-3',style:{color:t},fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.h)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})]):null});return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Qe,[v.value?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('div',et,[(0,s.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,s.normalizeStyle)({backgroundColor:i.value.colors.arrowBackground,borderRadius:x.value.value})},[((0,s.openBlock)(),(0,s.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,s.normalizeStyle)({color:i.value.colors.arrowIcon})},[...t[0]||(t[0]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'},null,-1)])],4))],4)])),(0,s.createElementVNode)('div',{class:'flex-1 p-2 min-h-[60px] relative',style:(0,s.normalizeStyle)(C.value)},[v.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',tt,[(0,s.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,s.normalizeStyle)({backgroundColor:i.value.colors.arrowBackground,borderRadius:x.value})},[((0,s.openBlock)(),(0,s.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,s.normalizeStyle)({color:i.value.colors.arrowIcon})},[...t[1]||(t[1]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'},null,-1)])],4))],4)])):(0,s.createCommentVNode)('v-if',!0),(0,s.createElementVNode)('div',{class:'h-4 mb-1 flex items-start',style:(0,s.normalizeStyle)({paddingLeft:v.value?'24px':0,paddingRight:v.value?'24px':0})},[(0,s.createElementVNode)('div',{class:'px-2 py-0.5 text-[10px] font-medium',style:(0,s.normalizeStyle)({backgroundColor:i.value.colors.nameBackground,color:i.value.colors.nameText,borderRadius:u.value.borderRadius,borderBottom:'underline'===u.value.style?`2px solid ${i.value.colors.nameText}`:void 0,boxShadow:'floating'===u.value.style?'0 2px 8px rgba(0,0,0,0.1)':void 0})},'  ',4)],4),(0,s.createElementVNode)('p',{class:'text-[10px] leading-relaxed',style:(0,s.normalizeStyle)({color:i.value.colors.dialogText,fontSize:`${i.value.fontSize}px`,paddingLeft:v.value?'24px':0,paddingRight:v.value?'24px':0})},' ... ',4),(0,s.createElementVNode)('div',it,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(b.value)))]),v.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',st,[(0,s.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,s.normalizeStyle)({backgroundColor:i.value.colors.arrowBackground,borderRadius:x.value})},[((0,s.openBlock)(),(0,s.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,s.normalizeStyle)({color:i.value.colors.arrowIcon})},[...t[2]||(t[2]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'},null,-1)])],4))],4)])):(0,s.createCommentVNode)('v-if',!0)],4),v.value?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('div',ot,[(0,s.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,s.normalizeStyle)({backgroundColor:i.value.colors.arrowBackground,borderRadius:x.value.value})},[((0,s.openBlock)(),(0,s.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,s.normalizeStyle)({color:i.value.colors.arrowIcon})},[...t[3]||(t[3]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'},null,-1)])],4))],4)]))]))}}),at={class:'animate-in fade-in absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm duration-200'},nt={class:'bg-card relative max-h-[85vh] w-[90%] max-w-lg overflow-hidden rounded-2xl shadow-2xl'},lt={class:'border-border flex items-center justify-between border-b p-4'},ct={class:'settings-scroll-container max-h-[calc(85vh-120px)] overflow-y-auto p-4'},dt={class:'space-y-6'},ut={class:'space-y-4'},ht={class:'space-y-3'},mt={class:'space-y-2'},pt=['value'],gt={class:'space-y-4'},vt={class:'space-y-3'},ft={class:'space-y-2'},xt={class:'text-muted-foreground text-xs'},yt=['value'],_t={class:'space-y-2'},Ct={class:'text-muted-foreground text-xs'},bt=['value'],wt={class:'space-y-2'},Mt={class:'text-muted-foreground text-xs'},kt=['value'],St={class:'space-y-4'},Pt={class:'space-y-3'},Et={class:'space-y-2'},It={class:'text-muted-foreground text-xs'},Tt=['value'],Bt={class:'space-y-2'},Lt={class:'text-muted-foreground text-xs'},Vt=['value'],Nt={class:'space-y-2'},Dt={class:'text-muted-foreground text-xs'},Ft=['value'],Rt={class:'space-y-4'},At={class:'flex items-center justify-between'},Ot={class:'relative inline-flex cursor-pointer items-center'},Ut=['checked'],zt={key:0,class:'animate-in fade-in space-y-2 duration-200'},$t={class:'text-muted-foreground text-xs'},jt=['value'],Gt={class:'space-y-4'},Wt={class:'flex items-center justify-between'},Ht={class:'relative inline-flex cursor-pointer items-center'},Xt=['checked'],Yt={key:0,class:'animate-in fade-in space-y-4 duration-200'},qt={class:'bg-muted/30 rounded-lg p-3'},Jt={class:'mb-2 flex items-center justify-between'},Zt=['disabled'],Kt={key:0,class:'h-3 w-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Qt={key:1,class:'h-3 w-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},ei={class:'px-6'},ti={class:'space-y-4'},ii={class:'bg-muted text-muted-foreground inline-flex h-9 w-full items-center justify-center rounded-lg p-[3px]'},si={key:0,class:'space-y-4'},oi={class:'space-y-2'},ri={class:'grid grid-cols-5 gap-2'},ai=['onClick'],ni={class:'space-y-2'},li={class:'grid grid-cols-6 gap-2'},ci=['onClick'],di={class:'space-y-2'},ui={class:'grid grid-cols-5 gap-2'},hi=['onClick'],mi={class:'space-y-2'},pi={class:'grid grid-cols-5 gap-2'},gi=['onClick'],vi={class:'space-y-2'},fi={class:'grid grid-cols-6 gap-2'},xi=['onClick'],yi={class:'space-y-2'},_i={class:'grid grid-cols-5 gap-2'},Ci=['onClick'],bi={class:'space-y-2'},wi={class:'text-muted-foreground text-xs'},Mi=['value'],ki={key:1,class:'space-y-4'},Si=(0,s.defineComponent)({__name:'SettingsPanel',props:{onClose:{type:Function},userDisplayName:{},onUserDisplayNameChange:{type:Function},spriteSettings:{},onSpriteSettingsChange:{type:Function},live2dSettings:{},onLive2dSettingsChange:{type:Function},autoPlay:{type:Boolean},onAutoPlayChange:{type:Function},autoPlaySpeed:{},onAutoPlaySpeedChange:{type:Function},dialogStyle:{},onDialogStyleChange:{type:Function},onSaveStyle:{type:Function},currentAppliedStyle:{},customModeEnabled:{type:Boolean},onCustomModeChange:{type:Function}},setup(e){const t=e,i=(0,s.ref)('shapes'),d=(0,s.computed)(()=>JSON.stringify(t.dialogStyle)!==JSON.stringify(t.currentAppliedStyle));function u(e){t.onSpriteSettingsChange(e)}function h(e){t.onLive2dSettingsChange(e)}function m(e,i){t.onDialogStyleChange({...t.dialogStyle,[e]:i})}function p(e,i){t.onDialogStyleChange({...t.dialogStyle,colors:{...t.dialogStyle.colors,[e]:i}})}return(g,v)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',at,[(0,s.createElementVNode)('div',nt,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',lt,[v[25]||(v[25]=(0,s.createElementVNode)('h2',{class:'text-foreground text-lg font-semibold'},'',-1)),(0,s.createElementVNode)('button',{class:'hover:bg-muted rounded-full p-1 transition-colors','aria-label':'',onClick:v[0]||(v[0]=(...t)=>e.onClose&&e.onClose(...t))},[...v[24]||(v[24]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',ct,[(0,s.createElementVNode)('div',dt,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',ut,[v[27]||(v[27]=(0,s.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),(0,s.createElementVNode)('div',ht,[(0,s.createElementVNode)('div',mt,[v[26]||(v[26]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('input',{type:'text',value:e.userDisplayName,placeholder:'',class:'border-border bg-background text-foreground w-full rounded-lg border px-3 py-2 text-sm placeholder:text-muted-foreground focus:border-primary focus:ring-primary focus:ring-1 focus:outline-none',onInput:v[1]||(v[1]=e=>{return i=e.target.value,void t.onUserDisplayNameChange(i);var i})},null,40,pt)])])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',gt,[v[28]||(v[28]=(0,s.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),v[29]||(v[29]=(0,s.createElementVNode)('p',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('div',vt,[(0,s.createElementVNode)('div',ft,[(0,s.createElementVNode)('label',xt,' ('+(0,s.toDisplayString)(Math.round(100*e.spriteSettings.scale))+'%)',1),(0,s.createElementVNode)('input',{type:'range',value:e.spriteSettings.scale,min:'0.5',max:'1.5',step:'0.05',class:'w-full',onInput:v[2]||(v[2]=t=>u({...e.spriteSettings,scale:parseFloat(t.target.value)}))},null,40,yt)]),(0,s.createElementVNode)('div',_t,[(0,s.createElementVNode)('label',Ct,' ('+(0,s.toDisplayString)(e.spriteSettings.positionX)+'%)',1),(0,s.createElementVNode)('input',{type:'range',value:e.spriteSettings.positionX,min:'0',max:'100',step:'1',class:'w-full',onInput:v[3]||(v[3]=t=>u({...e.spriteSettings,positionX:parseInt(t.target.value)}))},null,40,bt)]),(0,s.createElementVNode)('div',wt,[(0,s.createElementVNode)('label',Mt,' ('+(0,s.toDisplayString)(e.spriteSettings.positionY)+'%)',1),(0,s.createElementVNode)('input',{type:'range',value:e.spriteSettings.positionY,min:'0',max:'200',step:'1',class:'w-full',onInput:v[4]||(v[4]=t=>u({...e.spriteSettings,positionY:parseInt(t.target.value)}))},null,40,kt)])])]),(0,s.createCommentVNode)(' Live2D  '),(0,s.createElementVNode)('div',St,[v[30]||(v[30]=(0,s.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'Live2D ',-1)),v[31]||(v[31]=(0,s.createElementVNode)('p',{class:'text-muted-foreground text-xs'},' Live2D ',-1)),(0,s.createElementVNode)('div',Pt,[(0,s.createElementVNode)('div',Et,[(0,s.createElementVNode)('label',It,' ('+(0,s.toDisplayString)(Math.round(100*e.live2dSettings.scale))+'%)',1),(0,s.createElementVNode)('input',{type:'range',value:e.live2dSettings.scale,min:'0',max:'2',step:'0.05',class:'w-full',onInput:v[5]||(v[5]=t=>h({...e.live2dSettings,scale:parseFloat(t.target.value)}))},null,40,Tt)]),(0,s.createElementVNode)('div',Bt,[(0,s.createElementVNode)('label',Lt,' ('+(0,s.toDisplayString)(e.live2dSettings.positionX)+'%)',1),(0,s.createElementVNode)('input',{type:'range',value:e.live2dSettings.positionX,min:'0',max:'100',step:'1',class:'w-full',onInput:v[6]||(v[6]=t=>h({...e.live2dSettings,positionX:parseInt(t.target.value)}))},null,40,Vt)]),(0,s.createElementVNode)('div',Nt,[(0,s.createElementVNode)('label',Dt,' ('+(0,s.toDisplayString)(e.live2dSettings.positionY)+'%)',1),(0,s.createElementVNode)('input',{type:'range',value:e.live2dSettings.positionY,min:'0',max:'150',step:'1',class:'w-full',onInput:v[7]||(v[7]=t=>h({...e.live2dSettings,positionY:parseInt(t.target.value)}))},null,40,Ft)])])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Rt,[v[34]||(v[34]=(0,s.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),(0,s.createElementVNode)('div',At,[v[33]||(v[33]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('label',Ot,[(0,s.createElementVNode)('input',{type:'checkbox',checked:e.autoPlay,class:'peer sr-only',onChange:v[8]||(v[8]=t=>e.onAutoPlayChange(t.target.checked))},null,40,Ut),v[32]||(v[32]=(0,s.createElementVNode)('div',{class:'bg-input peer relative h-[1.15rem] w-8 rounded-full transition-colors peer-checked:bg-primary'},[(0,s.createElementVNode)('div',{class:'bg-background absolute top-0 left-0 h-4 w-4 rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]'})],-1))])]),e.autoPlay?((0,s.openBlock)(),(0,s.createElementBlock)('div',zt,[(0,s.createElementVNode)('label',$t,' ('+(0,s.toDisplayString)(e.autoPlaySpeed/1e3)+')',1),(0,s.createElementVNode)('input',{type:'range',value:e.autoPlaySpeed,min:'1000',max:'8000',step:'500',class:'w-full',onInput:v[9]||(v[9]=t=>e.onAutoPlaySpeedChange(parseInt(t.target.value)))},null,40,jt)])):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Gt,[(0,s.createElementVNode)('div',Wt,[v[36]||(v[36]=(0,s.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),(0,s.createElementVNode)('label',Ht,[(0,s.createElementVNode)('input',{type:'checkbox',checked:e.customModeEnabled,class:'peer sr-only',onChange:v[10]||(v[10]=e=>{return i=e.target.checked,t.onCustomModeChange(i),void(i&&t.onDialogStyleChange(t.currentAppliedStyle));var i})},null,40,Xt),v[35]||(v[35]=(0,s.createElementVNode)('div',{class:'bg-input peer relative h-[1.15rem] w-8 rounded-full transition-colors peer-checked:bg-primary'},[(0,s.createElementVNode)('div',{class:'bg-background absolute top-0 left-0 h-4 w-4 rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]'})],-1))])]),e.customModeEnabled?((0,s.openBlock)(),(0,s.createElementBlock)('div',Yt,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',qt,[(0,s.createElementVNode)('div',Jt,[v[39]||(v[39]=(0,s.createElementVNode)('span',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('button',{disabled:!d.value,class:(0,s.normalizeClass)(['flex h-7 items-center gap-1 rounded-md border px-3 text-xs transition-colors',d.value?'bg-primary text-primary-foreground border-primary hover:bg-primary/90':'bg-background cursor-not-allowed border-gray-200 opacity-50']),onClick:v[11]||(v[11]=(...t)=>e.onSaveStyle&&e.onSaveStyle(...t))},[d.value?((0,s.openBlock)(),(0,s.createElementBlock)('svg',Kt,[...v[37]||(v[37]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12'},null,-1)])])):((0,s.openBlock)(),(0,s.createElementBlock)('svg',Qt,[...v[38]||(v[38]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 13l4 4L19 7'},null,-1)])])),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(d.value?'':''),1)],10,Zt)]),(0,s.createElementVNode)('div',ei,[(0,s.createVNode)(rt,{style:(0,s.normalizeStyle)(e.dialogStyle)},null,8,['style'])])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',ti,[(0,s.createElementVNode)('div',ii,[(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)(['inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all','shapes'===i.value?'bg-background text-foreground border-input shadow-sm':'text-muted-foreground hover:text-foreground']),onClick:v[12]||(v[12]=e=>i.value='shapes')},'  ',2),(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)(['inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all','colors'===i.value?'bg-background text-foreground border-input shadow-sm':'text-muted-foreground hover:text-foreground']),onClick:v[13]||(v[13]=e=>i.value='colors')},'  ',2)]),(0,s.createCommentVNode)('  '),'shapes'===i.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',si,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',oi,[v[40]||(v[40]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('div',ri,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(r),t=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:t.id,class:(0,s.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.boxShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>m('boxShape',t.id)},(0,s.toDisplayString)(t.name),11,ai))),128))])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',ni,[v[41]||(v[41]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('div',li,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(o),t=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:t.id,class:(0,s.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.backgroundPattern===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>m('backgroundPattern',t.id)},(0,s.toDisplayString)(t.name),11,ci))),128))])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',di,[v[42]||(v[42]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('div',ui,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(a),t=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:t.id,class:(0,s.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.borderWidth===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>m('borderWidth',t.id)},(0,s.toDisplayString)(t.name),11,hi))),128))])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',mi,[v[43]||(v[43]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('div',pi,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(n),t=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:t.id,class:(0,s.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.nameShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>m('nameShape',t.id)},(0,s.toDisplayString)(t.name),11,gi))),128))])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',vi,[v[44]||(v[44]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('div',fi,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(l),t=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:t.id,class:(0,s.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.arrowShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>m('arrowShape',t.id)},(0,s.toDisplayString)(t.name),11,xi))),128))])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',yi,[v[45]||(v[45]=(0,s.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,s.createElementVNode)('div',_i,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(c),t=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:t.id,class:(0,s.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.indicatorShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>m('indicatorShape',t.id)},(0,s.toDisplayString)(t.name),11,Ci))),128))])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',bi,[(0,s.createElementVNode)('label',wi,' ('+(0,s.toDisplayString)(e.dialogStyle.fontSize)+'px)',1),(0,s.createElementVNode)('input',{type:'range',value:e.dialogStyle.fontSize,min:'12',max:'24',step:'1',class:'w-full',onInput:v[14]||(v[14]=t=>e.onDialogStyleChange({...e.dialogStyle,fontSize:parseInt(t.target.value)}))},null,40,Mi)])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),'colors'===i.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',ki,[(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.boxBackground,'onUpdate:value':v[15]||(v[15]=e=>p('boxBackground',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.boxBorder,'onUpdate:value':v[16]||(v[16]=e=>p('boxBorder',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.nameBackground,'onUpdate:value':v[17]||(v[17]=e=>p('nameBackground',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.nameText,'show-alpha':!1,'onUpdate:value':v[18]||(v[18]=e=>p('nameText',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.dialogText,'show-alpha':!1,'onUpdate:value':v[19]||(v[19]=e=>p('dialogText',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.narrationText,'show-alpha':!1,'onUpdate:value':v[20]||(v[20]=e=>p('narrationText',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.arrowBackground,'onUpdate:value':v[21]||(v[21]=e=>p('arrowBackground',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.arrowIcon,'show-alpha':!1,'onUpdate:value':v[22]||(v[22]=e=>p('arrowIcon',e))},null,8,['value']),(0,s.createVNode)(Ke,{label:'',value:e.dialogStyle.colors.indicatorColor,'onUpdate:value':v[23]||(v[23]=e=>p('indicatorColor',e))},null,8,['value'])])):(0,s.createCommentVNode)('v-if',!0)])])):(0,s.createCommentVNode)('v-if',!0)])])])])]))}}),Pi=(0,B.A)(Si,[['__scopeId','data-v-783ad584']]),Ei={class:'absolute top-4 left-4 z-50 flex flex-col items-start gap-2'},Ii={key:0,class:'animate-in fade-in slide-in-from-left-2 text-sm duration-200'},Ti={class:'absolute top-4 right-4 z-50 flex flex-col items-end gap-2'},Bi={key:0,class:'animate-in fade-in slide-in-from-left-2 text-sm duration-200'},Li=['aria-label'],Vi={key:0,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Ni={key:1,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Di={class:'text-sm'},Fi={class:'animate-in fade-in px-8 text-center text-xl leading-relaxed text-white duration-1000 md:text-2xl'},Ri={key:3,class:'absolute z-40',style:{right:'20%',top:'20%',maxWidth:'280px'}},Ai={class:'bg-card/95 text-foreground relative max-h-[85vh] w-[90%] max-w-3xl rounded-2xl shadow-2xl backdrop-blur-md'},Oi={class:'border-border/30 flex items-center justify-between border-b px-6 py-3'},Ui={class:'history-scroll-container max-h-[calc(85vh-100px)] overflow-y-auto px-6 py-2'},zi={key:0,class:'text-muted-foreground py-12 text-center text-sm'},$i=['onClick'],ji={class:'font-medium'},Gi=['innerHTML'],Wi={key:4,class:'bg-border/30 absolute right-3 bottom-0 left-3 h-px opacity-0 transition-opacity group-hover:opacity-100'},Hi={class:'flex items-center gap-3'},Xi=(0,s.defineComponent)({__name:'GalgamePlayer',setup(e){const t='galgame_dialog_style',o='galgame_sprite_settings',r='galgame_live2d_settings',a=(0,s.ref)(null),n=(0,s.ref)(null),l=(0,s.shallowRef)([]),c=(0,s.ref)(0),u=(0,s.computed)(()=>l.value[c.value]||null),h=(0,s.ref)(!1),m=(0,s.computed)(()=>{if(!u.value)return;const e=l.value.find(e=>e.noteUnitId===u.value?.unitId&&e.noteContent);return e?.noteContent}),p=(0,s.computed)(()=>{if(!u.value)return;const e=l.value.find(e=>e.noteUnitId===u.value?.unitId&&e.noteContent);return e?.noteUnitId}),g=(0,s.computed)(()=>{if(!u.value)return;const e=l.value.find(e=>e.noteUnitId===u.value?.unitId&&e.noteContent);return e?.notePosition});function f(e,t){const i=l.value.find(t=>t.noteUnitId===e&&t.noteContent);if(i){i.notePosition=t;const s=`note_position_${e}`;localStorage.setItem(s,JSON.stringify(t))}}const x=(0,s.ref)(!1),y=(0,s.ref)(!1),C=(0,s.ref)(!1),w=(0,s.ref)(3e3),S=(0,s.ref)(!1),P=(0,s.ref)(!1),E=(0,s.ref)(!1),I=(0,s.ref)(!1),T=(0,s.ref)(!1),B=(0,s.ref)(''),V=(0,s.ref)(!1),N=(0,s.ref)(!1),D=(0,s.ref)(!1),F=(0,s.ref)(''),R=(0,s.ref)(null),A=(0,s.ref)(null),O=(0,s.ref)(!1),U=(0,s.ref)(''),j=(0,s.ref)(null),G=(0,s.ref)(Z(o,{scale:1.15,positionX:24,positionY:120})),W=(0,s.ref)(Z(r,{scale:1.15,positionX:24,positionY:120})),H=(0,s.ref)(Z(t,d)),X=(0,s.ref)({...H.value}),Y=(0,s.shallowRef)([]),q=(0,s.shallowRef)(new Map);function Z(e,t){try{const t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){console.warn(` localStorage  ${e} :`,t)}return t}function K(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.warn(` localStorage ${e} :`,t)}}(0,s.watch)(H,e=>{K(t,e)},{deep:!0}),(0,s.watch)(G,e=>{K(o,e)},{deep:!0}),(0,s.watch)(W,e=>{K(r,e)},{deep:!0});const ee=(0,s.computed)(()=>{const e=window.innerHeight>window.innerWidth,t=!!document.fullscreenElement,i=16/9;if(e&&t){const e=window.innerHeight;return{width:`${e}px`,aspectRatio:'16 / 9',transform:'rotate(90deg)',transformOrigin:'center center',position:'absolute',left:'50%',top:'50%',marginLeft:`-${e/2}px`,marginTop:`-${e/i/2}px`,background:'transparent'}}return{width:'100%',aspectRatio:'16 / 9',margin:'0 auto',background:'transparent'}}),te=(0,s.computed)(()=>{const e=u.value;return e?.sceneImageUrl?e.sceneImageUrl:e?.scene&&(e.scene.match(/^https?:\/\//)||e.scene.match(/^\//))?e.scene:null}),ie=(0,s.computed)(()=>{const e=u.value;if(e?.sprite?.type)return console.info('[GalgamePlayer] currentSpriteType:  dialogue.sprite.type ',e.sprite.type),e.sprite.type;if(e?.isCG||'cg'===e?.type)return console.info('[GalgamePlayer] currentSpriteType: CG none'),'none';if(e?.character){const t=Y.value.some(t=>t.name===e.character),i=!!e.sprite?.imageUrl;return console.info('[GalgamePlayer] currentSpriteType: ',{character:e.character,hasLive2d:t,hasImage:i,availableModels:Y.value.map(e=>({id:e.id,name:e.name}))}),t?'live2d':i?'image':'none'}return console.info('[GalgamePlayer] currentSpriteType:  none'),'none'}),se=(0,s.computed)(()=>{const e=u.value;return e?.sprite?.imageUrl||'/placeholder-user.jpg'}),oe=(0,s.computed)(()=>{const e=u.value;if(e?.sprite?.live2dModelId)return console.info('[GalgamePlayer] currentLive2dModelId: ID',{modelId:e.sprite.live2dModelId,character:e.character,source:'dialogue.sprite.live2dModelId (dialogue)'}),e.sprite.live2dModelId;if(e?.character){const t=Y.value.find(t=>t.name===e.character);return console.info('[GalgamePlayer] currentLive2dModelId: ',{character:e.character,foundModel:t?{id:t.id,name:t.name}:null,availableModels:Y.value.map(e=>({id:e.id,name:e.name})),source:'live2dModels.value ()'}),t?.id}console.info('[GalgamePlayer] currentLive2dModelId: ID',{hasDialogue:!!e,hasCharacter:!!e?.character,availableModels:Y.value.map(e=>({id:e.id,name:e.name}))})}),re=(0,s.ref)(new Map);async function ae(){try{const e=getChatMessages('0-{{lastMessageId}}'),t=[];let s,o,r,a,n,d,u;if(Y.value.length>0){console.info(`[]  ${Y.value.length}  Live2D `);const{live2dModelManager:e}=await Promise.resolve().then(i.bind(i,131));e.preloadModels(Y.value).catch(e=>{console.warn('[] Live2D :',e)})}const m=e=>{!e.scene&&s&&(e.scene=s),!e.sceneImageUrl&&o&&(!e.scene||s&&e.scene===s)&&(e.sceneImageUrl=o)},p=e=>{'blackscreen'!==e.type&&void 0===e.isCG&&d&&(e.isCG=d,u&&(e.cgImageUrl=u))},g=e=>{'blackscreen'!==e.type&&(r&&(e.sprite={...r}),!e.motion&&a&&(e.motion=a),!e.expression&&n&&(e.expression=n))},v=e=>{'blackscreen'!==e.type&&(e.scene&&(s=e.scene),e.sceneImageUrl&&(o=e.sceneImageUrl))},f=e=>{!1===e.isCG?(r=e.sprite?{...e.sprite}:void 0,a=e.motion,n=e.expression,d=!1,u=void 0):!0===e.isCG?(r=void 0,a=void 0,n=void 0,d=!0,u=e.cgImageUrl):(r=e.sprite?{...e.sprite}:void 0,a=e.motion,n=e.expression,void 0!==e.isCG&&(d=e.isCG,u=e.cgImageUrl))};for(const i of e){const e=i.message||'',o=await M(e,s);if(0===o.length)continue;const r=b(e);let a=0,n=0;for(;n<o.length;){const e=o[n];if('choice'===e.type){const s=[e];let l=n+1;for(;l<o.length&&'choice'===o[l].type;)s.push(o[l]),l++;const c=s.some(e=>'format1'===e.choiceFormat),d=s.some(e=>'format2'===e.choiceFormat);if(c){const e=[];for(const t of s)t.options&&e.push(...t.options);if(e.length>0){const s={unitId:`msg_${i.message_id}_unit_${a}`,unitIndex:a++,character:'',text:'',type:'choice',message_id:i.message_id,role:'system',choiceFormat:'format1',options:e,statusBlock:r};m(s),g(s),p(s),t.push(s),v(s)}}else if(d){const e=[];for(const t of s)t.choices&&e.push(...t.choices);if(e.length>0){const s={unitId:`msg_${i.message_id}_unit_${a}`,unitIndex:a++,character:'',text:'',type:'choice',message_id:i.message_id,role:'system',choiceFormat:'format2',options:e.map((e,t)=>({id:`choice_${t}`,text:e})),statusBlock:r};m(s),g(s),p(s),t.push(s),v(s)}}n=l;continue}if('character'===e.type){const s=e.motion||e.motionFile,o=e.expression||e.expressionFile,n=k(e.character||'',s,o,Y.value),l=Y.value.find(t=>t.name===e.character),c=!!e.spriteImageUrl||!!i.extra?.sprite_image;console.info('[] :',{character:e.character,hasLive2dModel:!!l,hasMotionExpr:n,hasSpriteImage:c,spriteImageUrl:e.spriteImageUrl,blockIsCG:e.isCG});const d=!0===e.isCG;console.info('[] CG:',{isCGMode:d,reason:!0===e.isCG?'CGCG':!1===e.isCG?'':'isCG'});const u={unitId:`msg_${i.message_id}_unit_${a}`,unitIndex:a++,character:e.character,text:e.text||'',message_id:i.message_id,role:'assistant',type:d?'cg':void 0,scene:e.scene,sceneImageUrl:e.sceneImageUrl,motion:s,expression:o,isCG:d,cgImageUrl:d?e.cgImageUrl||e.scene:void 0,statusBlock:r,sprite:d?{type:'none'}:(()=>{const t=e.spriteImageUrl||i.extra?.sprite_image||void 0;return l?(console.info('[]  Live2D :',{character:e.character,modelId:l.id,modelName:l.name,source:'live2dModels.value ()'}),{type:'live2d',live2dModelId:l.id,imageUrl:void 0}):t?(console.info('[] :',e.character,'imageUrl:',t),{type:'image',live2dModelId:void 0,imageUrl:t}):(console.info('[] :',e.character,''),{type:'none',live2dModelId:void 0,imageUrl:void 0})})()};m(u),t.push(u),v(u),f(u)}else if('narration'===e.type){const s={unitId:`msg_${i.message_id}_unit_${a}`,unitIndex:a++,character:'',text:e.message||'',type:'narration',message_id:i.message_id,role:'system',scene:e.scene,sceneImageUrl:e.sceneImageUrl,statusBlock:r};m(s),g(s),p(s),t.push(s),v(s)}else if('blacktext'===e.type){const s={unitId:`msg_${i.message_id}_unit_${a}`,unitIndex:a++,character:'',text:e.message||'',type:'blackscreen',message_id:i.message_id,role:'system',statusBlock:r};d=void 0,u=void 0,t.push(s)}else if('user'===e.type){const s={unitId:`msg_${i.message_id}_unit_${a}`,unitIndex:a++,character:'',text:e.message||'',type:'user',message_id:i.message_id,role:'user',scene:e.scene,sceneImageUrl:e.sceneImageUrl,isEditable:!0,statusBlock:r};m(s),g(s),p(s);const o=re.value.get(i.message_id);o&&(o.deleted?s.isDeleted=!0:void 0!==o.text&&(s.editedText=o.text,s.text=o.text)),t.push(s),v(s)}else if('note'===e.type){let s;for(let e=t.length-1;e>=0;e--){const i=t[e];if('choice'!==i.type&&!i.noteContent){s=i.unitId;break}}if(s){const i=t.find(e=>e.unitId===s);i&&(i.noteContent=e.noteContent,i.noteUnitId=s,e.noteUnitId&&(i.noteUnitId=e.noteUnitId))}else{const s={unitId:`msg_${i.message_id}_unit_${a}`,unitIndex:a++,character:'',text:'',type:'narration',message_id:i.message_id,role:'system',noteContent:e.noteContent,noteUnitId:e.noteUnitId,statusBlock:r};m(s),t.push(s)}}n++}}const x=t.filter(e=>!e.isDeleted),y=l.value.length;l.value=x,h.value?h.value=!1:0===y&&x.length>0?c.value=0:c.value>=x.length&&(c.value=Math.max(0,x.length-1)),console.info(` ${l.value.length} `),0===l.value.length&&ne()}catch(e){console.error(':',e),ne()}}function ne(){console.info('');let e=0;const t=t=>({unitId:`test_unit_${e}`,unitIndex:e++,message_id:0,role:'assistant',character:'',text:'',...t});l.value=[t({character:'',text:' Galgame ',type:void 0,scene:'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=1920&h=1080&fit=crop',sprite:{type:'image',imageUrl:'/placeholder-user.jpg'}}),t({character:'',text:'',isThrough:!1}),t({character:'',text:'',type:'narration'}),t({character:'',text:'*through*  through ',isThrough:!0}),t({character:'',text:'...',type:'blackscreen'}),t({character:'',text:''}),t({character:'',text:''}),t({character:'',text:'',type:'choice',options:[{id:'opt1',text:''},{id:'opt2',text:''},{id:'opt3',text:''}]}),t({character:'',text:' Live2D '}),t({character:'',text:''}),t({character:'',text:'---  Live2D  ---',type:'narration'}),t({character:'',text:' 1 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:' Live2D """"',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 2 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 3 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 4 Live2D ',type:'narration',scene:''}),t({character:'',text:' Live2D ',type:void 0,scene:'',sprite:{type:'image',imageUrl:'https://iili.io/f01ajiN.png'}}),t({character:'',text:' 5 -  + ',type:'narration'}),t({character:'',text:'""""',type:void 0,motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 6 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 7 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:'--- Live2D  ---',type:'narration'}),t({character:'',text:'',type:'narration'})]}function le(e=!1){if(c.value<l.value.length-1){const t=c.value+1;c.value=t,e&&(T.value=!1),V.value=!1}}function ce(){c.value>0&&(c.value--,V.value=!1)}async function de(){try{if(!document.fullscreenElement&&a.value){if(window.innerHeight>window.innerWidth&&screen.orientation&&'lock'in screen.orientation)try{await screen.orientation.lock('landscape')}catch(e){console.warn(':',e)}await a.value.requestFullscreen(),y.value=!0}else if(await document.exitFullscreen(),y.value=!1,screen.orientation&&'unlock'in screen.orientation)try{screen.orientation.unlock()}catch(e){}S.value=!1}catch(e){console.error(':',e)}}(0,s.watch)(()=>[c.value,u.value],()=>{const e=u.value;e&&(null!==j.value&&e.message_id!==j.value&&(O.value=!1,U.value='',j.value=null),'blackscreen'===e.type?(B.value=e.text,T.value=!0,V.value=!1):'choice'===e.type?(V.value=!0,T.value=!1):(T.value=!1,V.value=!1))},{immediate:!0}),(0,s.watch)(()=>[C.value,w.value,c.value,V.value,u.value],()=>{if(n.value&&(clearTimeout(n.value),n.value=null),C.value&&c.value<l.value.length-1&&!V.value){const e=u.value,t='blackscreen'===e?.type?w.value+2e3:w.value;n.value=setTimeout(()=>{le()},t)}},{immediate:!0});const ue=()=>{y.value=!!document.fullscreenElement,(0,s.nextTick)(()=>{})},he=()=>{(0,s.nextTick)(()=>{})},pe=[];function ge(e){const t=e.currentTarget.getBoundingClientRect();e.clientX-t.left<t.width/2?c.value>0&&(c.value--,T.value=!1):le(!0)}function ve(){x.value||S.value||V.value||T.value||le()}(0,s.onMounted)(()=>{if(document.addEventListener('fullscreenchange',ue),window.addEventListener('resize',he),window.addEventListener('orientationchange',he),(0,s.nextTick)(()=>{he()}),async function(){try{const e=new Map;try{const t=await v();console.info(`[GalgamePlayer]  ${t.models.size}  Live2D `);for(const[i,s]of t.models.entries()){const t=s.files?.model3||'',o=t.startsWith('http://')||t.startsWith('https://'),r=t.substring(0,t.lastIndexOf('/')+1),a=o?t:t?t.split('/').pop():'',n={name:i,id:i,basePath:r,modelPath:a,version:3,textures:s.files?.textures||[],motions:s.motions?.map(e=>({group:e.group??'default',name:e.name,file:e.file,index:e.index,motionType:e.motionType,textMappings:e.textMappings}))||[],expressions:s.expressions?.map(e=>e.name||e.file)||[],defaultAnimation:s.defaultAnimation,textMappings:s.textMappings};console.info(`[GalgamePlayer] : ${i}`,{modelPath:a,basePath:r,isFullUrl:o,motionsCount:n.motions.length,expressionsCount:n.expressions.length,hasTextMappings:!!n.textMappings}),e.set(i,n)}q.value=t.models}catch(e){console.warn('[GalgamePlayer] :',e)}Y.value=Array.from(e.values()),console.info(`[GalgamePlayer]  ${Y.value.length}  Live2D `),console.info('[GalgamePlayer] :',Y.value.map(e=>({id:e.id,name:e.name,modelPath:e.modelPath,basePath:e.basePath,motionsCount:e.motions?.length||0,expressionsCount:e.expressions?.length||0,hasTextMappings:!!e.textMappings})))}catch(e){console.error('[GalgamePlayer]  Live2D :',e)}}(),ae(),'function'==typeof eventOn&&'undefined'!=typeof tavern_events){const e=eventOn(tavern_events.MESSAGE_RECEIVED,async e=>{const t=Number(e);try{const e=getChatMessages(t);if(e.length>0){const t=e[0].message||'';await async function(e){const t=/<phone>([\s\S]*?)<\/phone>/gi,i=Array.from(e.matchAll(t));if(0===i.length)return;const s=new Set;try{let e=null;try{const t=getCharWorldbookNames('current');e=t.primary||t.additional[0]||null}catch(e){console.warn(':',e)}e||(e='-');let t=[];try{t=await getWorldbook(e)}catch{await createOrReplaceWorldbook(e,[]),t=[]}for(const e of i){const i=e[1].trim();if(!i)continue;const o=i.split('\n').filter(e=>e.trim()),r=new Map;for(const e of o){let t=e.match(/^(.+?)[:](.+?)\|(.+)$/),i=null,o=null,a=null,n=null;if(t){const e=t[1].trim(),r=t[2].trim(),l=t[3].trim(),c=e.match(/^(.+?)$/);if(c)i=c[1].trim(),a=r,n=l,a.includes('{{user}}')||a.includes('<user>')?(o='{{user}}',a=a.replace(/{{user}}|<user>/gi,'').trim()):o=i;else{if('{{user}}'===e||'<user>'===e)continue;i=e,o=i,a=r,n=l,s.add(i)}}else t=e.match(/^(.+?)\|(.+?)\|(.+)$/),t&&(i=t[1].trim(),a=t[2].trim(),n=t[3].trim(),o='{{user}}');i&&a&&n&&o&&(r.has(i)||r.set(i,[]),r.get(i).push({speaker:o,content:a,time:n}))}for(const[e,i]of r.entries()){const s=`${e}`;let o=t.find(e=>e.name===s);o||(o={name:s,content:'',comment:'',priority:100,enabled:!0,insertion_order:0,case_sensitive:!1,name_regex:!1,content_regex:!1,exclude_recursion:!1,display_index:0,probability:100,delay:0,delay_on:0,delay_off:0,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},position:{before:[],after:[],order:0},disable:!1,exclude:!1,uid:Date.now().toString()},t.push(o));const r=o.content||'',a=i.map(e=>`${e.speaker}${e.content}|${e.time}`),n=r?`${r}\n${a.join('\n')}`:a.join('\n');o.content=n}}t.length>0&&(await updateWorldbookWith(e,()=>t),console.info(` ${e} `)),s.size>0&&s.forEach(e=>{fe.value.add(e)})}catch(e){console.error(' phone :',e)}}(t)}}catch(e){console.warn(' phone :',e)}await ae(),Number.isNaN(t)||j.value!==t||(O.value=!1,U.value='',j.value=null)});e&&pe.push(()=>e.stop());const t=eventOn(tavern_events.MESSAGE_UPDATED,async()=>{if(await ae(),null!==j.value){const e=l.value.find(e=>e.message_id===j.value);e&&e.text===U.value&&(O.value=!1,U.value='',j.value=null)}});t&&pe.push(()=>t.stop());const i=eventOn(tavern_events.CHAT_CHANGED,()=>{ae(),c.value=0,O.value=!1,U.value='',j.value=null});i&&pe.push(()=>i.stop());const s=eventOn(tavern_events.STREAM_TOKEN_RECEIVED,e=>{!function(e){if(!O.value||null===j.value)return;U.value=e}(e)});s&&pe.push(()=>s.stop())}}),(0,s.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',ue),window.removeEventListener('resize',he),window.removeEventListener('orientationchange',he),n.value&&(clearTimeout(n.value),n.value=null),pe.forEach(e=>e()),pe.length=0});const fe=(0,s.ref)(new Set),ye=(0,s.computed)(()=>{if('undefined'!=typeof window&&window.getUnreadContacts){const e=window.getUnreadContacts();return e&&e.length>0}return!1});async function _e(e){const t=A.value&&'function'==typeof A.value.getPendingMessages?A.value.getPendingMessages():'',i=t?`${e}\n\n${t}`:e;await createChatMessages([{role:'user',message:i}],{refresh:'all'})}function Ce(e){const t=e.indexOf('<content>');if(-1!==t)return e.substring(t);const i=e.indexOf('</content>');return-1!==i?e.substring(i):e}async function be(e){try{const t=getCurrentMessageId(),i=getChatMessages(t)[0];if(!i)return void console.warn('');const s=u.value?.scene||'{{scene}}',o=i.message+'\n\n[[user||'+s+'||'+e+']]';await setChatMessages([{message_id:t,message:o}],{refresh:'none'});const r=getLastMessageId()+1,a=l.value.length,n={unitId:`msg_${r}_unit_${a}`,unitIndex:a,character:'',text:e,type:'user',isEditable:!0,message_id:r,role:'user'},d=[...l.value];d.splice(c.value+1,0,n),l.value=d,c.value=c.value+1,console.info(':',e)}catch(e){console.error(':',e)}}async function we(e,t){console.info(':',e,t);const i=u.value?.message_id;if(void 0===i)return console.warn('ID'),void le();try{const s=getLastMessageId(),o=c.value>=l.value.length-1;let r,a='';if('custom'===e&&t?a=t.trim():(r=u.value?.options?.find(t=>t.id===e),a=r?.text||''),!a)return console.warn(''),void le();await async function(e,t){try{const i=getChatMessages(e);if(0===i.length)return;const s=i[0].message||'',o=s.match(/<content>([\s\S]*?)<\/content>/i);if(!o)return void console.warn(' <content> ');let r=o[1],a=!1;const n=/\[\[choice\|\|([^\]]+)\]\]/g,l=[];let c;for(;null!==(c=n.exec(r));)l.push({block:c[0],content:c[1]});console.info(` ${l.length} `);for(const e of l){const i={},s=e.content.split('||');for(const e of s){const t=e.match(/^([^:]+)[:]\s*(.*)$/);if(t){const e=t[1].trim(),s=t[2].trim();i[e]=s}}const o=i['']||i.character||i['']||i.response||i.text||i['']||i.narration,n=[];for(const e in i)if(e.match(/^\d+$/)){const t=e.replace(/^(\d+)$/,'$1');n.push(t)}if(1===n.length&&o){const s=i[`${n[0]}`];s!==t?(r=r.replace(e.block,''),a=!0,console.info('1:',s)):console.info('1:',s)}else if(n.length>1){let s='',o=!1;for(const e of n){const r=i[`${e}`];if(r===t){s=`${e}${r}`,o=!0;break}}if(o){const i=`[[choice||${s}]]`;r=r.replace(e.block,i),a=!0,console.info('2:',t)}}}if(a){r=r.replace(/\n{3,}/g,'\n\n').trim();const t=s.replace(o[0],`<content>${r}</content>`);t!==s&&(await setChatMessages([{message_id:e,message:t}],{refresh:'none'}),console.info(''))}}catch(e){console.error(':',e)}}(i,a);if(r&&r.character&&r.response){const e=u.value?.unitId,t=l.value.findIndex(t=>t.isChoiceResponse&&t.choiceParentId===e&&'user'===t.type),s=l.value.findIndex(t=>t.isChoiceResponse&&t.choiceParentId===e&&'user'!==t.type&&'choice'!==t.type),o=u.value,n=o?.scene,d=o?.sceneImageUrl,h=o?.sprite,m=o?.motion,p=o?.expression,g=o?.isCG,v=o?.cgImageUrl;if(-1!==t)l.value[t].text=a,n&&(l.value[t].scene=n),d&&(l.value[t].sceneImageUrl=d);else{const t={unitId:void 0!==i?`msg_${i}_unit_choice_user`:'temp_unit_choice_user',unitIndex:c.value+1,character:'',text:a,type:'user',message_id:i,role:'user',isChoiceResponse:!0,choiceParentId:e,scene:n,sceneImageUrl:d},s=[...l.value];s.splice(c.value+1,0,t),l.value=s,c.value++}const f=r?.character||'',x=r?.response||'';if(-1!==s)l.value[s].character=f,l.value[s].text=x,n&&(l.value[s].scene=n),d&&(l.value[s].sceneImageUrl=d),h&&(l.value[s].sprite={...h}),m&&(l.value[s].motion=m),p&&(l.value[s].expression=p),void 0!==g&&(l.value[s].isCG=g),v&&(l.value[s].cgImageUrl=v);else{const s={unitId:void 0!==i?`msg_${i}_unit_choice_response`:'temp_unit_choice_response',unitIndex:c.value+1,character:f,text:x,type:void 0,message_id:i,role:'assistant',isChoiceResponse:!0,choiceParentId:e,scene:n,sceneImageUrl:d,sprite:h?{...h}:void 0,motion:m,expression:p,isCG:g,cgImageUrl:v},o=[...l.value],r=-1!==t?t+1:c.value+1;o.splice(r,0,s),l.value=o}}if(o){if(void 0!==i)try{const e=getChatMessages(i);if(e.length>0){const t=e[0].message||'',s=Ce(t);s!==t&&(await setChatMessages([{message_id:i,message:s}],{refresh:'none'}),console.info(' <content>...</content> '))}}catch(e){console.error(':',e)}if(void 0!==i&&i<s){const e=[];for(let t=i+1;t<=s;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'all'}),console.info(` ${e.length} `))}await _e(a),console.info(':',a);const e=getLastMessageId()+1;O.value=!0,U.value='',j.value=e,await triggerSlash('/trigger'),console.info(' AI '),await ae()}if(!o&&'custom'===e&&t){if(void 0!==i)try{const e=getChatMessages(i);if(e.length>0){const t=e[0].message||'',s=Ce(t);s!==t&&(await setChatMessages([{message_id:i,message:s}],{refresh:'none'}),console.info(' </content> '))}}catch(e){console.error(':',e)}if(void 0!==i&&i<s){const e=[];for(let t=i+1;t<=s;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'all'}),console.info(` ${e.length} `))}await createChatMessages([{role:'user',message:a}],{refresh:'all'}),console.info(':',a);const e=getLastMessageId()+1;O.value=!0,U.value='',j.value=e,await triggerSlash('/trigger'),console.info(' AI '),await ae()}else o||le()}catch(e){console.error(':',e),O.value=!1,U.value='',j.value=null,le()}}function Me(){const e=u.value;if(!e)return'';const t=e.text||'';return t?(O.value&&(j.value,e.message_id),t):''}const ke=(0,s.ref)(!1),Se=(0,s.ref)([]);async function Pe(){S.value=!1,ke.value=!0;try{const e=getLastMessageId(),t=[];for(let i=0;i<=e;i++)try{const e=getChatMessages(i);if(e.length>0){const s=e[0],o=s.message||'',r=await M(o),a=[];for(const e of r)if('character'===e.type&&e.character&&e.text)a.push({type:'character',character:e.character,text:e.text});else if('user'===e.type){const t='message'in e?e.message:e.text;t&&a.push({type:'user',character:'',text:t})}else if('narration'===e.type){const t='message'in e?e.message:e.text;t&&a.push({type:'narration',text:t})}else if('blacktext'===e.type){const t='message'in e?e.message:e.text;t&&a.push({type:'blacktext',text:t})}else'choice'===e.type&&(e.choiceText||e.text)&&a.push({type:'choice',text:e.choiceText||e.text||''});if(0===a.length){const e=o.replace(/\[\[[^\]]+\]\]/g,'').replace(/<[^>]+>/g,'').trim();e&&a.push({type:'user'===s.role?'user':'character',character:'user'===s.role?'':'AI',text:e})}a.length>0&&t.push({id:i,role:s.role||'user',items:a})}}catch(e){console.warn(` ${i} :`,e)}Se.value=t.reverse(),console.info(` ${Se.value.length} `)}catch(e){console.error(':',e)}}function Ee(){H.value={...X.value}}function Ie(){S.value?(N.value||(X.value={...H.value}),x.value=!0,S.value=!1):S.value=!0}function Te(){P.value?(E.value=!0,P.value=!1):P.value=!0}function Be(){I.value=!0,P.value=!1}function Le(){I.value=!0,P.value=!1,(0,s.nextTick)(()=>{})}function Ve(){D.value=!0,P.value=!1,(0,s.nextTick)(()=>{R.value?.focus()})}async function Ne(){if(!F.value.trim())return;const e=F.value.trim();F.value='',D.value=!1;const t=c.value>=l.value.length-1,i=u.value?.message_id,s=getLastMessageId();if(!t&&void 0!==i)try{const e=getChatMessages(i);if(e.length>0){const t=e[0].message||'',s=Ce(t);s!==t&&(await setChatMessages([{message_id:i,message:s}],{refresh:'none'}),console.info(' <content>...</content> '))}if(i<s){const e=[];for(let t=i+1;t<=s;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'all'}),console.info(` ${e.length} `))}}catch(e){console.error(':',e)}const o=getLastMessageId()+1,r=l.value.length,a={unitId:`msg_${o}_unit_${r}`,unitIndex:r,character:'',text:e,type:'user',isEditable:!0,message_id:o,role:'user'},n=[...l.value];n.splice(c.value+1,0,a),l.value=n,c.value=c.value+1;try{await async function(){if(0===re.value.size)return;try{for(const[e,t]of re.value.entries())t.deleted?(await deleteChatMessages([e],{refresh:'none'}),console.info(':',e)):t.text&&(await Ae(e,t.text),console.info(':',e));re.value.clear()}catch(e){console.error(':',e)}}();const t=`[[user||${u.value?.scene||'{{scene}}'}||${e}]]`;await _e(t),console.info(':',e);const i=getLastMessageId()+1;O.value=!0,U.value='',j.value=i,await triggerSlash('/trigger'),console.info(' AI '),await ae()}catch(e){console.error(':',e),O.value=!1,U.value='',j.value=null}}async function De(){if(!F.value.trim())return;const e=F.value.trim();F.value='',D.value=!1,await be(e)}async function Fe(e,t){try{await Ae(e,t),re.value.set(e,{text:t});const i=l.value.findIndex(t=>t.message_id===e);if(-1!==i){const e=[...l.value];e[i]={...e[i],text:t},l.value=e}console.info(':',e,t)}catch(e){console.error(':',e)}}async function Re(e){try{re.value.set(e,{deleted:!0});const t=l.value.findIndex(t=>t.message_id===e);if(-1!==t){const e=[...l.value];e.splice(t,1),l.value=e,c.value>=e.length&&(c.value=Math.max(0,e.length-1))}console.info(':',e)}catch(e){console.error(':',e)}}async function Ae(e,t){try{const i=getChatMessages(e);if(i.length>0){const s=i[0].message||'',o=s.match(/<content>([\s\S]*?)<\/content>/i),r=o?o[1]:s,a=/\[\[user\|\|([^\]]+)\]\]/g;let n,l=s,c=!1;for(;null!==(n=a.exec(r));){const e=n[1],i={},a=e.split('||').map(e=>e.trim()).filter(e=>e);for(const e of a){const t=e.match(/^([^:]+)[:]\s*(.+)$/);if(t){const e=t[1].trim(),s=t[2].trim();e&&s&&(i[e]=s)}}if(i['']||i.scene||i['']||i['']||i['']||i.text){const e=i['']||i.scene||'{{scene}}',a=n[0],d=`[[user||${e}||${t}]]`;if(o){const e=r.replace(a,d);l=s.replace(o[0],`<content>${e}</content>`)}else l=s.replace(a,d);c=!0;break}}if(!c)if(o){const e=r+`\n[[user||{{scene}}||${t}]]`;l=s.replace(o[0],`<content>${e}</content>`)}else l=s+`\n[[user||{{scene}}||${t}]]`;await setChatMessages([{message_id:e,message:l}],{refresh:'none'}),console.info(':',e,t)}}catch(e){console.error(':',e)}}return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{ref_key:'containerRef',ref:a,class:'relative w-full overflow-hidden select-none',style:(0,s.normalizeStyle)([ee.value,{background:'transparent'}])},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'absolute inset-0 bg-center bg-no-repeat',style:(0,s.normalizeStyle)({backgroundImage:te.value?`url('${te.value}')`:void 0,backgroundColor:'transparent',backgroundSize:te.value?'cover':void 0,backgroundPosition:'center',backgroundRepeat:'no-repeat',objectFit:'cover'})},null,4),(0,s.createCommentVNode)('  '),t[23]||(t[23]=(0,s.createElementVNode)('div',{class:'bg-primary/5 absolute inset-0'},null,-1)),(0,s.createCommentVNode)('  '),(0,s.createVNode)(L,{'sprite-scale':G.value.scale,'sprite-position-x':G.value.positionX,'sprite-position-y':G.value.positionY,'live2d-scale':W.value.scale,'live2d-position-x':W.value.positionX,'live2d-position-y':W.value.positionY,'sprite-type':ie.value,'image-url':se.value,'live2d-model-id':oe.value,'live2d-models':Y.value,motion:u.value?.motion,expression:u.value?.expression},null,8,['sprite-scale','sprite-position-x','sprite-position-y','live2d-scale','live2d-position-x','live2d-position-y','sprite-type','image-url','live2d-model-id','live2d-models','motion','expression']),(0,s.createCommentVNode)(' CGCG '),u.value?.isCG&&u.value.cgImageUrl?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'absolute inset-0 z-5 bg-cover bg-center',style:(0,s.normalizeStyle)({backgroundImage:`url('${u.value.cgImageUrl}')`})},null,4)):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Ei,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)(['bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',P.value?'pr-4':'']),'aria-label':'',onClick:(0,s.withModifiers)(Te,['stop'])},[(0,s.createCommentVNode)('  SVG '),t[8]||(t[8]=(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'})],-1)),P.value?((0,s.openBlock)(),(0,s.createElementBlock)('span',Ii,'')):(0,s.createCommentVNode)('v-if',!0)],2),(0,s.createCommentVNode)('  '),P.value?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:0,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'25ms'},'aria-label':'',onClick:(0,s.withModifiers)(Be,['stop'])},[...t[9]||(t[9]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M7 4h10a1 1 0 011 1v14a1 1 0 01-1 1H7a1 1 0 01-1-1V5a1 1 0 011-1z'}),(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5h2m-2 14h2'})],-1),(0,s.createElementVNode)('span',{class:'text-sm'},'',-1)])])):(0,s.createCommentVNode)('v-if',!0),P.value?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:1,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'75ms'},'aria-label':'',onClick:(0,s.withModifiers)(Ve,['stop'])},[...t[10]||(t[10]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z'})],-1),(0,s.createElementVNode)('span',{class:'text-sm'},'',-1)])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),ye.value?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:2,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center justify-center rounded-full p-2 shadow-lg backdrop-blur-sm transition-all duration-200 hover:bg-card hover:scale-110',style:{'animation-delay':'100ms'},'aria-label':'',onClick:(0,s.withModifiers)(Le,['stop'])},[...t[11]||(t[11]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M7 4h10a1 1 0 011 1v14a1 1 0 01-1 1H7a1 1 0 01-1-1V5a1 1 0 011-1z'}),(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5h2m-2 14h2'})],-1)])])):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Ti,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)(['bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',S.value?'pr-4':'']),'aria-label':'',onClick:Ie},[t[12]||(t[12]=(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'}),(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 12a3 3 0 11-6 0 3 3 0 016 0z'})],-1)),S.value?((0,s.openBlock)(),(0,s.createElementBlock)('span',Bi,'')):(0,s.createCommentVNode)('v-if',!0)],2),(0,s.createCommentVNode)('  '),S.value?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:0,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card','aria-label':y.value?'':'',onClick:de},[y.value?((0,s.openBlock)(),(0,s.createElementBlock)('svg',Vi,[...t[13]||(t[13]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25'},null,-1)])])):((0,s.openBlock)(),(0,s.createElementBlock)('svg',Ni,[...t[14]||(t[14]=[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'},null,-1)])])),(0,s.createElementVNode)('span',Di,(0,s.toDisplayString)(y.value?'':''),1)],8,Li)):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),S.value?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:1,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'50ms'},'aria-label':'',onClick:Pe},[...t[15]||(t[15]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z'})],-1),(0,s.createElementVNode)('span',{class:'text-sm'},'',-1)])])):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'absolute inset-0 z-10 cursor-pointer',onClick:ve}),(0,s.createCommentVNode)('  '),S.value||P.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:1,class:'absolute inset-0 z-40',onClick:t[0]||(t[0]=e=>{S.value=!1,P.value=!1})})):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['absolute inset-0 z-30 flex items-center justify-center bg-black transition-opacity duration-1000',T.value?'opacity-100':'pointer-events-none opacity-0']),onClick:ge},[(0,s.createElementVNode)('p',Fi,(0,s.toDisplayString)(B.value),1),(0,s.createCommentVNode)('  '),T.value?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[t[16]||(t[16]=(0,s.createStaticVNode)('<div class="absolute top-1/2 left-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60" data-v-ae9bdb74><svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ae9bdb74><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" data-v-ae9bdb74></path></svg></div><div class="absolute top-1/2 right-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60" data-v-ae9bdb74><svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ae9bdb74><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-ae9bdb74></path></svg></div>',2))],64)):(0,s.createCommentVNode)('v-if',!0)],2),(0,s.createCommentVNode)('  '),V.value&&u.value?.options?((0,s.openBlock)(),(0,s.createBlock)(Q,{key:2,options:u.value.options,'custom-style':H.value,'on-select':we,'on-prev':ce,'on-next':()=>le(),'on-save':be},null,8,['options','custom-style','on-next'])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),!T.value&&!V.value&&u.value&&m.value&&'blackscreen'!==u.value.type&&'choice'!==u.value.type?((0,s.openBlock)(),(0,s.createElementBlock)('div',Ri,[(0,s.createVNode)(xe,{content:m.value,'note-unit-id':p.value,'initial-position':g.value,onPositionChange:f},null,8,['content','note-unit-id','initial-position'])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),!T.value&&!V.value&&u.value&&'blackscreen'!==u.value.type&&'choice'!==u.value.type&&Me()?((0,s.openBlock)(),(0,s.createBlock)(me,{key:4,character:u.value.character||'',text:Me(),'is-last-dialogue':c.value>=l.value.length-1,'is-first-dialogue':0===c.value,'on-prev':ce,'on-next':le,'dialog-key':c.value,'custom-style':H.value,'is-loading':O.value&&j.value===u.value.message_id,'streaming-text':O.value&&j.value===u.value.message_id?U.value:void 0,'is-through':u.value.isThrough,'is-editable':u.value.isEditable,'message-id':u.value.message_id,'on-edit':Fe,'on-delete':Re},null,8,['character','text','is-last-dialogue','is-first-dialogue','dialog-key','custom-style','is-loading','streaming-text','is-through','is-editable','message-id'])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),x.value?((0,s.openBlock)(),(0,s.createBlock)(Pi,{key:5,'on-close':()=>x.value=!1,'sprite-settings':G.value,'on-sprite-settings-change':e=>G.value=e,'live2d-settings':W.value,'on-live2d-settings-change':e=>W.value=e,'auto-play':C.value,'on-auto-play-change':e=>C.value=e,'auto-play-speed':w.value,'on-auto-play-speed-change':e=>w.value=e,'dialog-style':X.value,'on-dialog-style-change':e=>X.value=e,'on-save-style':Ee,'current-applied-style':H.value,'custom-mode-enabled':N.value,'on-custom-mode-change':e=>N.value=e},null,8,['on-close','sprite-settings','on-sprite-settings-change','live2d-settings','on-live2d-settings-change','auto-play','on-auto-play-change','auto-play-speed','on-auto-play-speed-change','dialog-style','on-dialog-style-change','current-applied-style','custom-mode-enabled','on-custom-mode-change'])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),(0,s.createVNode)(J,{show:E.value,'message-id':u.value?.message_id,'status-block':u.value?.statusBlock,'on-close':()=>E.value=!1},null,8,['show','message-id','status-block','on-close']),(0,s.createCommentVNode)('  +  '),(0,s.createVNode)(je,{ref_key:'phonePanelRef',ref:A,show:I.value,'message-id':u.value?.message_id,'status-block':u.value?.statusBlock,'on-close':()=>I.value=!1},null,8,['show','message-id','status-block','on-close']),(0,s.createCommentVNode)('  '),ke.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:6,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:t[2]||(t[2]=(0,s.withModifiers)(e=>ke.value=!1,['self']))},[(0,s.createElementVNode)('div',Ai,[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Oi,[t[18]||(t[18]=(0,s.createElementVNode)('h2',{class:'text-lg font-medium'},'',-1)),(0,s.createElementVNode)('button',{class:'hover:bg-muted rounded-full p-1 transition-colors','aria-label':'',onClick:t[1]||(t[1]=e=>ke.value=!1)},[...t[17]||(t[17]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Ui,[0===Se.value.length?((0,s.openBlock)(),(0,s.createElementBlock)('div',zi,'  ')):(0,s.createCommentVNode)('v-if',!0),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(Se.value,(e,i)=>((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:e.id},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.items,(o,r)=>{return(0,s.openBlock)(),(0,s.createElementBlock)('div',{key:`${e.id}-${r}`,class:'history-message-item group relative cursor-pointer rounded px-3 py-2 transition-all',onClick:t=>async function(e){try{ke.value=!1;const t=c.value;h.value=!0,await ae(),await(0,s.nextTick)();let i=-1;if(i=l.value.findIndex(t=>t.message_id===e),i<0){const t=l.value.map((e,t)=>({dialogue:e,index:t})).filter(({dialogue:t})=>t.message_id===e);t.length>0&&(i=t[0].index)}i>=0?(c.value=i,await(0,s.nextTick)(),console.info(` ${e} ${i}: ${l.value.length}`)):(console.warn(` ${e} : ${l.value.length}`,' message_id :',l.value.map((e,t)=>({index:t,message_id:e.message_id})).slice(0,10)),t>=0&&t<l.value.length?(c.value=t,console.info(` ${t}`)):l.value.length>0&&(c.value=0,console.info('')))}catch(e){console.error(':',e),h.value=!1}}(e.id)},[(0,s.createCommentVNode)('  '),'character'===o.type||'user'===o.type?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'leading-relaxed',style:(0,s.normalizeStyle)({color:H.value.colors.dialogText,fontSize:`${H.value.fontSize}px`})},[(0,s.createElementVNode)('span',ji,(0,s.toDisplayString)(o.character)+'',1),(0,s.createElementVNode)('span',{innerHTML:(a=o.text,a?a.replace(/\*([^*]+)\*/g,(e,t)=>'through'===t.trim()?e:` <span style="color: #9ca3af; font-style: italic;">${t}</span> `):'')},null,8,Gi)],4)):'narration'===o.type?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:1},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'ml-6 leading-relaxed italic',style:(0,s.normalizeStyle)({color:H.value.colors.narrationText,fontSize:`${H.value.fontSize}px`})},(0,s.toDisplayString)(o.text),5)],2112)):'blacktext'===o.type?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:2},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'ml-6 leading-relaxed italic opacity-70',style:(0,s.normalizeStyle)({color:H.value.colors.narrationText,fontSize:`${H.value.fontSize}px`})},(0,s.toDisplayString)(o.text),5)],2112)):'choice'===o.type?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:3},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'leading-relaxed',style:(0,s.normalizeStyle)({color:H.value.colors.dialogText,fontSize:`${H.value.fontSize}px`})},[t[19]||(t[19]=(0,s.createElementVNode)('span',{class:'font-medium'},'',-1)),(0,s.createElementVNode)('span',null,(0,s.toDisplayString)(o.text),1)],4)],2112)):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)(' hover '),r<e.items.length-1||i<Se.value.length-1?((0,s.openBlock)(),(0,s.createElementBlock)('div',Wi)):(0,s.createCommentVNode)('v-if',!0)],8,$i);var a}),128))],64))),128))])])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),D.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:7,class:'absolute inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm',onClick:t[7]||(t[7]=()=>D.value=!1)},[(0,s.createElementVNode)('div',{class:'relative mx-4 w-full max-w-lg p-4',style:(0,s.normalizeStyle)({backgroundColor:'pill'===H.value.boxShape?'rgba(255, 255, 255, 0.85)':H.value.colors.boxBackground,borderRadius:'16px',borderWidth:'1px',borderStyle:'solid',borderColor:H.value.colors.boxBorder,boxShadow:'0 8px 32px rgba(0,0,0,0.15)',backdropFilter:'pill'===H.value.boxShape?'blur(12px)':void 0}),onClick:t[6]||(t[6]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('button',{class:'absolute top-2 right-2 rounded-full p-1 transition-colors hover:bg-black/5',onClick:t[3]||(t[3]=()=>D.value=!1)},[...t[20]||(t[20]=[(0,s.createElementVNode)('svg',{class:'text-muted-foreground h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])]),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',{class:'mb-3 inline-block px-3 py-1 text-sm font-medium',style:(0,s.normalizeStyle)({backgroundColor:H.value.colors.nameBackground,color:H.value.colors.nameText,borderRadius:'6px'})},'  ',4),(0,s.createCommentVNode)('  '),(0,s.createElementVNode)('div',Hi,[(0,s.withDirectives)((0,s.createElementVNode)('input',{ref_key:'inputRef',ref:R,'onUpdate:modelValue':t[4]||(t[4]=e=>F.value=e),type:'text',placeholder:'...',class:'flex-1 bg-transparent text-base outline-none',style:(0,s.normalizeStyle)({color:H.value.colors.dialogText}),onKeydown:[(0,s.withKeys)(Ne,['enter']),t[5]||(t[5]=(0,s.withKeys)(()=>D.value=!1,['escape']))]},null,36),[[s.vModelText,F.value]]),(0,s.createCommentVNode)('  '),F.value.trim()?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:0,class:'p-1 transition-colors hover:opacity-80',style:(0,s.normalizeStyle)({color:H.value.colors.nameText}),'aria-label':'',title:'',onClick:(0,s.withModifiers)(De,['stop'])},[...t[21]||(t[21]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12'})],-1)])],4)):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)('  '),F.value.trim()?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:1,class:'p-1 transition-colors hover:opacity-80',style:(0,s.normalizeStyle)({color:H.value.colors.nameText}),'aria-label':'',onClick:(0,s.withModifiers)(Ne,['stop'])},[...t[22]||(t[22]=[(0,s.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,s.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 12h14M12 5l7 7-7 7'})],-1)])],4)):(0,s.createCommentVNode)('v-if',!0)])],4)])):(0,s.createCommentVNode)('v-if',!0)],4))}}),Yi=(0,B.A)(Xi,[['__scopeId','data-v-ae9bdb74']])},502(e,t){t.A=(e,t)=>{const i=e.__vccOpts||e;for(const[e,s]of t)i[e]=s;return i}}},l={};function c(e){var t=l[e];if(void 0!==t)return t.exports;var i=l[e]={exports:{}};return n[e](i,i.exports,c),i.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var d=c(315),u=c(61);function h(e,t){return new Promise((i,s)=>{if(t&&window[t])return void i();const o=document.createElement('script');o.src=e,o.async=!1,o.onload=()=>i(),o.onerror=()=>s(new Error(`Failed to load script: ${e}`)),document.head.appendChild(o)})}window.PIXI=d,$(()=>{(async function(){try{void 0===window.Live2D?(console.info('[Live2D]  Cubism 2.1 ...'),await h('https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js','Live2D'),console.info('[Live2D] Cubism 2.1 ')):console.info('[Live2D] Cubism 2.1  HTML '),void 0===window.Live2DCubismCore?(console.info('[Live2D]  Cubism 4 ...'),await h('https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js','Live2DCubismCore'),console.info('[Live2D] Cubism 4 ')):console.info('[Live2D] Cubism 4  HTML '),console.info('[Live2D]  Cubism 2/3/4 ')}catch(e){throw console.error('[Live2D] :',e),e}})().then(async()=>{const{default:e}=await Promise.resolve().then(c.bind(c,439));(0,u.createApp)(e).mount('#app'),console.info('[] Vue ')}).catch(e=>{console.error('[] :',e),toastr.error('Live2D ')})});
//# sourceMappingURL=index.js.map</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap);
/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */@layer properties;@layer theme,base,components,utilities;@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-500:oklch(63.7% 0.237 25.331);--color-gray-200:oklch(92.8% 0.006 264.531);--color-black:#000;--color-white:#fff;--spacing:0.25rem;--container-md:28rem;--container-lg:32rem;--container-2xl:42rem;--container-3xl:48rem;--container-4xl:56rem;--text-xs:0.75rem;--text-xs--line-height:calc(1 / 0.75);--text-sm:0.875rem;--text-sm--line-height:calc(1.25 / 0.875);--text-base:1rem;--text-base--line-height:calc(1.5 / 1);--text-lg:1.125rem;--text-lg--line-height:calc(1.75 / 1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75 / 1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2 / 1.5);--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--leading-relaxed:1.625;--radius-2xl:1rem;--drop-shadow-2xl:0 25px 25px rgb(0 0 0/0.15);--ease-in-out:cubic-bezier(0.4,0,0.2,1);--animate-pulse:pulse 2s cubic-bezier(0.4,0,0.6,1) infinite;--blur-sm:8px;--blur-md:12px;--default-transition-duration:150ms;--default-transition-timing-function:cubic-bezier(0.4,0,0.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono)}}@layer base{*,::after,::before,::backdrop,::file-selector-button{box-sizing:border-box;margin:0;padding:0;border:0 solid}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea,::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;border-radius:0;background-color:transparent;opacity:1}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not (-webkit-appearance:-apple-pay-button)) or (contain-intrinsic-size:1px){::placeholder{color:currentcolor;@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit,::-webkit-datetime-edit-year-field,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute-field,::-webkit-datetime-edit-second-field,::-webkit-datetime-edit-millisecond-field,::-webkit-datetime-edit-meridiem-field{padding-block:0}::-webkit-calendar-picker-indicator{line-height:1}:-moz-ui-invalid{box-shadow:none}button,input:where([type="button"],[type="reset"],[type="submit"]),::file-selector-button{-webkit-appearance:button;appearance:button}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden="until-found"])){display:none !important}}@layer utilities{.pointer-events-none{pointer-events:none}.visible{visibility:visible}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip-path:inset(50%);white-space:nowrap;border-width:0}.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.static{position:static}.sticky{position:sticky}.inset-0{inset:calc(var(--spacing) * 0)}.inset-y-2{inset-block:calc(var(--spacing) * 2)}.top-0{top:calc(var(--spacing) * 0)}.top-1\/2{top:calc(1/2 * 100%)}.top-2{top:calc(var(--spacing) * 2)}.top-4{top:calc(var(--spacing) * 4)}.right-0{right:calc(var(--spacing) * 0)}.right-1{right:calc(var(--spacing) * 1)}.right-2{right:calc(var(--spacing) * 2)}.right-3{right:calc(var(--spacing) * 3)}.right-4{right:calc(var(--spacing) * 4)}.right-6{right:calc(var(--spacing) * 6)}.bottom-0{bottom:calc(var(--spacing) * 0)}.bottom-1\.5{bottom:calc(var(--spacing) * 1.5)}.bottom-3{bottom:calc(var(--spacing) * 3)}.left-0{left:calc(var(--spacing) * 0)}.left-1{left:calc(var(--spacing) * 1)}.left-2{left:calc(var(--spacing) * 2)}.left-3{left:calc(var(--spacing) * 3)}.left-4{left:calc(var(--spacing) * 4)}.left-6{left:calc(var(--spacing) * 6)}.z-5{z-index:5}.z-10{z-index:10}.z-20{z-index:20}.z-25{z-index:25}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.container{width:100%;@media (width >= 40rem){max-width:40rem}@media (width >= 48rem){max-width:48rem}@media (width >= 64rem){max-width:64rem}@media (width >= 80rem){max-width:80rem}@media (width >= 96rem){max-width:96rem}}.mx-4{margin-inline:calc(var(--spacing) * 4)}.mx-auto{margin-inline:auto}.mt-4{margin-top:calc(var(--spacing) * 4)}.mb-1{margin-bottom:calc(var(--spacing) * 1)}.mb-2{margin-bottom:calc(var(--spacing) * 2)}.mb-3{margin-bottom:calc(var(--spacing) * 3)}.mb-4{margin-bottom:calc(var(--spacing) * 4)}.ml-6{margin-left:calc(var(--spacing) * 6)}.ml-auto{margin-left:auto}.block{display:block}.contents{display:contents}.flex{display:flex}.grid{display:grid}.hidden{display:none}.inline{display:inline}.inline-block{display:inline-block}.inline-flex{display:inline-flex}.h-1{height:calc(var(--spacing) * 1)}.h-1\.5{height:calc(var(--spacing) * 1.5)}.h-2{height:calc(var(--spacing) * 2)}.h-3{height:calc(var(--spacing) * 3)}.h-4{height:calc(var(--spacing) * 4)}.h-5{height:calc(var(--spacing) * 5)}.h-6{height:calc(var(--spacing) * 6)}.h-7{height:calc(var(--spacing) * 7)}.h-8{height:calc(var(--spacing) * 8)}.h-9{height:calc(var(--spacing) * 9)}.h-\[1\.15rem\]{height:1.15rem}.h-\[70vh\]{height:70vh}.h-\[calc\(100\%-1px\)\]{height:calc(100% - 1px)}.h-px{height:1px}.max-h-\[85vh\]{max-height:85vh}.max-h-\[calc\(85vh-100px\)\]{max-height:calc(85vh - 100px)}.max-h-\[calc\(85vh-120px\)\]{max-height:calc(85vh - 120px)}.min-h-\[60px\]{min-height:60px}.min-h-\[120px\]{min-height:120px}.w-1{width:calc(var(--spacing) * 1)}.w-1\.5{width:calc(var(--spacing) * 1.5)}.w-2{width:calc(var(--spacing) * 2)}.w-2\/3{width:calc(2/3 * 100%)}.w-3{width:calc(var(--spacing) * 3)}.w-4{width:calc(var(--spacing) * 4)}.w-5{width:calc(var(--spacing) * 5)}.w-6{width:calc(var(--spacing) * 6)}.w-8{width:calc(var(--spacing) * 8)}.w-9{width:calc(var(--spacing) * 9)}.w-20{width:calc(var(--spacing) * 20)}.w-\[90\%\]{width:90%}.w-auto{width:auto}.w-full{width:100%}.max-w-2xl{max-width:var(--container-2xl)}.max-w-3xl{max-width:var(--container-3xl)}.max-w-4xl{max-width:var(--container-4xl)}.max-w-lg{max-width:var(--container-lg)}.max-w-md{max-width:var(--container-md)}.flex-1{flex:1}.flex-shrink{flex-shrink:1}.flex-shrink-0{flex-shrink:0}.-translate-y-1\/2{--tw-translate-y:calc(calc(1/2 * 100%) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}.transform{transform:var(--tw-rotate-x,) var(--tw-rotate-y,) var(--tw-rotate-z,) var(--tw-skew-x,) var(--tw-skew-y,)}.animate-pulse{animation:var(--animate-pulse)}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.touch-none{touch-action:none}.resize{resize:both}.resize-none{resize:none}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.items-end{align-items:flex-end}.items-start{align-items:flex-start}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.justify-start{justify-content:flex-start}.gap-0\.5{gap:calc(var(--spacing) * 0.5)}.gap-1{gap:calc(var(--spacing) * 1)}.gap-1\.5{gap:calc(var(--spacing) * 1.5)}.gap-2{gap:calc(var(--spacing) * 2)}.gap-3{gap:calc(var(--spacing) * 3)}.space-y-1\.5{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1.5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1.5) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-2{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 2) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-3{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-4{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 4) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-6{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 6) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 6) * calc(1 - var(--tw-space-y-reverse)))}}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:var(--radius-2xl)}.rounded-full{border-radius:calc(infinity * 1px)}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-xl{border-radius:calc(var(--radius) + 4px)}.border{border-style:var(--tw-border-style);border-width:1px}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-b{border-bottom-style:var(--tw-border-style);border-bottom-width:1px}.border-border{border-color:oklch(0.85 0.04 145)}.border-border\/30{border-color:color-mix(in oklab,oklch(0.85 0.04 145) 30%,transparent)}.border-gray-200{border-color:var(--color-gray-200)}.border-input{border-color:oklch(0.9 0.03 145)}.border-primary{border-color:oklch(0.55 0.15 145)}.border-transparent{border-color:transparent}.border-white{border-color:var(--color-white)}.bg-background{background-color:oklch(0.97 0.02 145)}.bg-black{background-color:var(--color-black)}.bg-black\/30{background-color:color-mix(in srgb,#000 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 30%,transparent)}}.bg-black\/40{background-color:color-mix(in srgb,#000 40%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 40%,transparent)}}.bg-black\/50{background-color:color-mix(in srgb,#000 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 50%,transparent)}}.bg-border\/30{background-color:color-mix(in oklab,oklch(0.85 0.04 145) 30%,transparent)}.bg-card{background-color:oklch(0.99 0.01 145)}.bg-card\/80{background-color:color-mix(in oklab,oklch(0.99 0.01 145) 80%,transparent)}.bg-card\/95{background-color:color-mix(in oklab,oklch(0.99 0.01 145) 95%,transparent)}.bg-input{background-color:oklch(0.9 0.03 145)}.bg-muted{background-color:oklch(0.94 0.02 145)}.bg-muted\/30{background-color:color-mix(in oklab,oklch(0.94 0.02 145) 30%,transparent)}.bg-primary{background-color:oklch(0.55 0.15 145)}.bg-primary\/5{background-color:color-mix(in oklab,oklch(0.55 0.15 145) 5%,transparent)}.bg-primary\/10{background-color:color-mix(in oklab,oklch(0.55 0.15 145) 10%,transparent)}.bg-transparent{background-color:transparent}.bg-cover{background-size:cover}.bg-center{background-position:center}.bg-no-repeat{background-repeat:no-repeat}.object-contain{object-fit:contain}.p-1{padding:calc(var(--spacing) * 1)}.p-2{padding:calc(var(--spacing) * 2)}.p-3{padding:calc(var(--spacing) * 3)}.p-4{padding:calc(var(--spacing) * 4)}.p-6{padding:calc(var(--spacing) * 6)}.p-\[3px\]{padding:3px}.px-2{padding-inline:calc(var(--spacing) * 2)}.px-3{padding-inline:calc(var(--spacing) * 3)}.px-4{padding-inline:calc(var(--spacing) * 4)}.px-6{padding-inline:calc(var(--spacing) * 6)}.px-8{padding-inline:calc(var(--spacing) * 8)}.py-0\.5{padding-block:calc(var(--spacing) * 0.5)}.py-1{padding-block:calc(var(--spacing) * 1)}.py-2{padding-block:calc(var(--spacing) * 2)}.py-3{padding-block:calc(var(--spacing) * 3)}.py-4{padding-block:calc(var(--spacing) * 4)}.py-12{padding-block:calc(var(--spacing) * 12)}.pr-4{padding-right:calc(var(--spacing) * 4)}.pb-4{padding-bottom:calc(var(--spacing) * 4)}.text-center{text-align:center}.text-left{text-align:left}.text-right{text-align:right}.font-mono{font-family:var(--font-mono)}.text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.text-lg{font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}.text-xs{font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}.text-\[10px\]{font-size:10px}.leading-relaxed{--tw-leading:var(--leading-relaxed);line-height:var(--leading-relaxed)}.font-bold{--tw-font-weight:var(--font-weight-bold);font-weight:var(--font-weight-bold)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.font-semibold{--tw-font-weight:var(--font-weight-semibold);font-weight:var(--font-weight-semibold)}.whitespace-nowrap{white-space:nowrap}.text-foreground{color:oklch(0.25 0.05 145)}.text-muted-foreground{color:oklch(0.5 0.05 145)}.text-primary{color:oklch(0.55 0.15 145)}.text-primary-foreground{color:oklch(0.99 0.01 145)}.text-red-500{color:var(--color-red-500)}.text-white{color:var(--color-white)}.text-white\/40{color:color-mix(in srgb,#fff 40%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 40%,transparent)}}.capitalize{text-transform:capitalize}.lowercase{text-transform:lowercase}.uppercase{text-transform:uppercase}.italic{font-style:italic}.underline{text-decoration-line:underline}.opacity-0{opacity:0%}.opacity-40{opacity:40%}.opacity-50{opacity:50%}.opacity-70{opacity:70%}.opacity-100{opacity:100%}.shadow{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px var(--tw-shadow-color,rgb(0 0 0/0.25));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 4px 6px -4px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 2px 4px -2px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 8px 10px -6px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-2{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-primary{--tw-ring-color:oklch(0.55 0.15 145)}.outline{outline-style:var(--tw-outline-style);outline-width:1px}.blur{--tw-blur:blur(8px);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.drop-shadow-2xl{--tw-drop-shadow-size:drop-shadow(0 25px 25px var(--tw-drop-shadow-color,rgb(0 0 0/0.15)));--tw-drop-shadow:drop-shadow(var(--drop-shadow-2xl));filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.invert{--tw-invert:invert(100%);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.filter{filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.backdrop-blur-md{--tw-backdrop-blur:blur(var(--blur-md));backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.backdrop-blur-sm{--tw-backdrop-blur:blur(var(--blur-sm));backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.backdrop-filter{backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,backdrop-filter,display,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-colors{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-transform{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.duration-200{--tw-duration:200ms;transition-duration:200ms}.duration-300{--tw-duration:300ms;transition-duration:300ms}.duration-500{--tw-duration:500ms;transition-duration:500ms}.duration-1000{--tw-duration:1000ms;transition-duration:1000ms}.ease-in-out{--tw-ease:var(--ease-in-out);transition-timing-function:var(--ease-in-out)}.outline-none{--tw-outline-style:none;outline-style:none}.select-none{-webkit-user-select:none;user-select:none}.group-hover\:opacity-100{&:is(:where(.group):hover *){@media (hover:hover){opacity:100%}}}.peer-checked\:translate-x-\[calc\(100\%-2px\)\]{&:is(:where(.peer):checked~*){--tw-translate-x:calc(100% - 2px);translate:var(--tw-translate-x) var(--tw-translate-y)}}.peer-checked\:bg-primary{&:is(:where(.peer):checked~*){background-color:oklch(0.55 0.15 145)}}.placeholder\:text-muted-foreground{&::placeholder{color:oklch(0.5 0.05 145)}}.hover\:scale-105{&:hover{@media (hover:hover){--tw-scale-x:105%;--tw-scale-y:105%;--tw-scale-z:105%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:scale-110{&:hover{@media (hover:hover){--tw-scale-x:110%;--tw-scale-y:110%;--tw-scale-z:110%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:scale-\[1\.02\]{&:hover{@media (hover:hover){scale:1.02}}}.hover\:border-primary\/50{&:hover{@media (hover:hover){border-color:color-mix(in oklab,oklch(0.55 0.15 145) 50%,transparent)}}}.hover\:bg-black\/5{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#000 5%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 5%,transparent)}}}}.hover\:bg-black\/10{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#000 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 10%,transparent)}}}}.hover\:bg-card{&:hover{@media (hover:hover){background-color:oklch(0.99 0.01 145)}}}.hover\:bg-muted{&:hover{@media (hover:hover){background-color:oklch(0.94 0.02 145)}}}.hover\:bg-primary\/90{&:hover{@media (hover:hover){background-color:color-mix(in oklab,oklch(0.55 0.15 145) 90%,transparent)}}}.hover\:bg-red-500\/20{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-500) 20%,transparent)}}}}.hover\:text-foreground{&:hover{@media (hover:hover){color:oklch(0.25 0.05 145)}}}.hover\:text-white\/60{&:hover{@media (hover:hover){color:color-mix(in srgb,#fff 60%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 60%,transparent)}}}}.hover\:opacity-80{&:hover{@media (hover:hover){opacity:80%}}}.focus\:border-primary{&:focus{border-color:oklch(0.55 0.15 145)}}.focus\:ring-1{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-2{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-primary{&:focus{--tw-ring-color:oklch(0.55 0.15 145)}}.focus\:outline-none{&:focus{--tw-outline-style:none;outline-style:none}}.active\:scale-\[0\.98\]{&:active{scale:0.98}}.md\:gap-4{@media (width >= 48rem){gap:calc(var(--spacing) * 4)}}.md\:p-5{@media (width >= 48rem){padding:calc(var(--spacing) * 5)}}.md\:px-8{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 8)}}.md\:pb-6{@media (width >= 48rem){padding-bottom:calc(var(--spacing) * 6)}}.md\:text-2xl{@media (width >= 48rem){font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}}}html,body{width:100%;margin:0;padding:0;overflow:hidden;background:transparent}#app{width:100%;aspect-ratio:16/9;margin:0 auto;position:relative;background:transparent;overflow:hidden}@layer base{*{border-color:oklch(0.85 0.04 145);outline-color:color-mix(in oklab,oklch(0.55 0.15 145) 50%,transparent)}body{background-color:oklch(0.97 0.02 145);color:oklch(0.25 0.05 145)}}:root{--background:oklch(0.97 0.02 145);--foreground:oklch(0.25 0.05 145);--card:oklch(0.99 0.01 145);--card-foreground:oklch(0.25 0.05 145);--popover:oklch(0.99 0.01 145);--popover-foreground:oklch(0.25 0.05 145);--primary:oklch(0.55 0.15 145);--primary-foreground:oklch(0.99 0.01 145);--secondary:oklch(0.92 0.03 145);--secondary-foreground:oklch(0.35 0.08 145);--muted:oklch(0.94 0.02 145);--muted-foreground:oklch(0.5 0.05 145);--accent:oklch(0.75 0.12 90);--accent-foreground:oklch(0.25 0.05 145);--destructive:oklch(0.577 0.245 27.325);--destructive-foreground:oklch(0.577 0.245 27.325);--border:oklch(0.85 0.04 145);--input:oklch(0.9 0.03 145);--ring:oklch(0.55 0.15 145)}.dark{--background:oklch(0.145 0 0);--foreground:oklch(0.985 0 0);--card:oklch(0.145 0 0);--card-foreground:oklch(0.985 0 0);--popover:oklch(0.145 0 0);--popover-foreground:oklch(0.985 0 0);--primary:oklch(0.985 0 0);--primary-foreground:oklch(0.205 0 0);--secondary:oklch(0.269 0 0);--secondary-foreground:oklch(0.985 0 0);--muted:oklch(0.269 0 0);--muted-foreground:oklch(0.708 0 0);--accent:oklch(0.269 0 0);--accent-foreground:oklch(0.985 0 0);--destructive:oklch(0.396 0.141 25.723);--destructive-foreground:oklch(0.637 0.237 25.331);--border:oklch(0.269 0 0);--input:oklch(0.269 0 0);--ring:oklch(0.439 0 0)}*{border-color:var(--border)}body{background-color:var(--background);color:var(--foreground)}@keyframes fade-in{from{opacity:0}to{opacity:1}}@keyframes slide-in-from-left-2{from{transform:translateX(-8px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slide-in-from-top-2{from{transform:translateY(-8px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes slide-in-from-bottom-2{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-in{animation-duration:0.3s;animation-timing-function:ease-out;animation-fill-mode:both}.fade-in{animation-name:fade-in}.slide-in-from-left-2{animation-name:slide-in-from-left-2}.slide-in-from-top-2{animation-name:slide-in-from-top-2}.slide-in-from-bottom-2{animation-name:slide-in-from-bottom-2}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0px}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-outline-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-backdrop-blur{syntax:"*";inherits:false}@property --tw-backdrop-brightness{syntax:"*";inherits:false}@property --tw-backdrop-contrast{syntax:"*";inherits:false}@property --tw-backdrop-grayscale{syntax:"*";inherits:false}@property --tw-backdrop-hue-rotate{syntax:"*";inherits:false}@property --tw-backdrop-invert{syntax:"*";inherits:false}@property --tw-backdrop-opacity{syntax:"*";inherits:false}@property --tw-backdrop-saturate{syntax:"*";inherits:false}@property --tw-backdrop-sepia{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-ease{syntax:"*";inherits:false}@property --tw-scale-x{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-y{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-z{syntax:"*";inherits:false;initial-value:1}@keyframes pulse{50%{opacity:0.5}}@layer properties{@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,::before,::after,::backdrop{--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0;--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-space-y-reverse:0;--tw-border-style:solid;--tw-leading:initial;--tw-font-weight:initial;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-outline-style:solid;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-backdrop-blur:initial;--tw-backdrop-brightness:initial;--tw-backdrop-contrast:initial;--tw-backdrop-grayscale:initial;--tw-backdrop-hue-rotate:initial;--tw-backdrop-invert:initial;--tw-backdrop-opacity:initial;--tw-backdrop-saturate:initial;--tw-backdrop-sepia:initial;--tw-duration:initial;--tw-ease:initial;--tw-scale-x:1;--tw-scale-y:1;--tw-scale-z:1}}}

.live2d-canvas[data-v-110796a2]{width:100%;height:70vh;min-height:400px;display:block}

.status-container-wrapper[data-v-330f15ce]{width:90%;max-width:32rem;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;font-size:14px}.status-container[data-v-330f15ce]{background:linear-gradient(rgba(255,255,255,0.3),rgba(255,255,255,0.3)),url('https://pic.imgdd.cc/item/691e765bc828c4c6def97018.jpg') center center /cover no-repeat;background-color:#f4f8f2;border:1px solid #d1e5d9;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(168,216,195,0.2);transition:all 0.3s ease-in-out;max-height:85vh;overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none}.status-container[data-v-330f15ce]::-webkit-scrollbar{display:none}.status-header[data-v-330f15ce]{display:flex;align-items:center;padding:12px 20px;color:#5a6e65;font-weight:600;background-color:rgba(231,244,238,0.87);border-bottom:1px solid #d1e5d9;position:relative}.summary-icon[data-v-330f15ce]{margin-right:10px;font-size:1.2em;color:#a8d8c3}.status-title[data-v-330f15ce]{flex:1}.status-close[data-v-330f15ce]{background:transparent;border:none;color:#5a6e65;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s;opacity:0.7}.status-close[data-v-330f15ce]:hover{opacity:1}.status-main-content[data-v-330f15ce]{padding:20px;display:flex;flex-direction:column;gap:16px}.status-info-bar[data-v-330f15ce]{display:flex;justify-content:space-between;background:rgba(224,242,233,0.8);padding:10px 15px;border-radius:10px;color:#5a6e65}.info-item[data-v-330f15ce]{display:flex;align-items:center;gap:8px}.status-values-grid[data-v-330f15ce]{display:grid;grid-template-columns:1fr 1fr;gap:12px}.value-card[data-v-330f15ce]{background:rgba(255,255,255,0.85);padding:12px;border-radius:8px;border:1px solid #d1e5d9;text-align:center}.value-name[data-v-330f15ce]{font-weight:600;color:#5a6e65}.value-number[data-v-330f15ce]{font-size:1.5em;color:#a8d8c3;font-weight:bold}.status-text-card[data-v-330f15ce]{background:rgba(255,255,255,0.85);padding:15px;border-radius:10px;border:1px solid #d1e5d9}.text-card-row[data-v-330f15ce]{margin-bottom:8px}.text-card-row[data-v-330f15ce]:last-child{margin-bottom:0}.text-card-label[data-v-330f15ce]{font-weight:600;color:#5a6e65;margin-right:8px;display:inline-block;background-color:rgba(224,242,233,0.9);padding:2px 8px;border-radius:12px}.text-card-content[data-v-330f15ce]{color:#788a82;white-space:pre-wrap}@media (max-width:600px){.status-info-bar[data-v-330f15ce]{flex-direction:column;gap:8px;align-items:flex-start}}

@keyframes pulse-7ebdc071{0%,100%{opacity:1}50%{opacity:0.5}}@keyframes diamondPulse-7ebdc071{0%,100%{opacity:1;transform:rotate(45deg) scale(1)}50%{opacity:0.6;transform:rotate(45deg) scale(0.8)}}@keyframes ping-7ebdc071{75%,100%{transform:scale(2);opacity:0}}@keyframes arrowBounce-7ebdc071{0%,100%{transform:translateX(0)}50%{transform:translateX(3px)}}

.note-card[data-v-68f5f8e2]{position:relative;width:100%;max-width:280px;aspect-ratio:1;background:white;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);overflow:hidden;-webkit-user-select:none;user-select:none;transition:box-shadow 0.2s}.note-card[data-v-68f5f8e2]:hover{box-shadow:0 6px 16px rgba(0,0,0,0.15)}.note-close-btn[data-v-68f5f8e2]{position:absolute;top:8px;right:8px;z-index:20;width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.9);border:1px solid rgba(16,185,129,0.2);border-radius:50%;color:#10b981;cursor:pointer;transition:all 0.2s;opacity:0.7}.note-close-btn[data-v-68f5f8e2]:hover{opacity:1;background:rgba(255,255,255,1);border-color:rgba(16,185,129,0.4);transform:scale(1.1)}.note-border[data-v-68f5f8e2]{position:absolute;inset:0;border:2px solid rgba(16,185,129,0.15);border-radius:12px;pointer-events:none}.note-dots[data-v-68f5f8e2]{position:absolute;top:12px;left:0;right:0;display:flex;justify-content:center;gap:8px;pointer-events:none;z-index:10}.note-dot[data-v-68f5f8e2]{width:6px;height:6px;border-radius:50%;background:rgba(16,185,129,0.3)}.note-lines[data-v-68f5f8e2]{position:absolute;inset:0;pointer-events:none;margin-top:48px;z-index:1}.note-line[data-v-68f5f8e2]{height:32px;border-bottom:1px solid rgba(16,185,129,0.08)}.note-binding[data-v-68f5f8e2]{position:absolute;left:16px;top:0;bottom:0;width:1px;background:linear-gradient(to bottom,transparent,rgba(16,185,129,0.2) 20%,rgba(16,185,129,0.2) 80%,transparent);pointer-events:none;z-index:2}.note-content[data-v-68f5f8e2]{position:relative;z-index:10;height:100%;padding:48px 24px 24px;overflow-y:auto}.note-content[data-v-68f5f8e2]::-webkit-scrollbar{width:4px}.note-content[data-v-68f5f8e2]::-webkit-scrollbar-thumb{background:rgba(16,185,129,0.2);border-radius:2px}.note-text[data-v-68f5f8e2]{font-size:14px;line-height:1.6;color:#374151;white-space:pre-wrap;word-break:break-word}.note-flower[data-v-68f5f8e2]{position:absolute;bottom:12px;right:12px;pointer-events:none;z-index:5;color:rgba(16,185,129,0.25)}

.theater-window[data-v-eef7e62c]{width:90%;max-width:28rem;max-height:85vh;background:linear-gradient(to bottom,#fafffe 0%,#f0fdf4 100%);border:2px solid rgba(129,199,132,0.3);border-radius:16px;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(76,175,80,0.15);overflow:hidden}.theater-window-fullscreen[data-v-eef7e62c]{width:90%;max-width:32rem;max-height:none;aspect-ratio:32/23}.title-bar[data-v-eef7e62c]{height:32px;background:linear-gradient(to right,#81c784 0%,#a5d6a7 100%);display:flex;align-items:center;justify-content:space-between;padding:0 12px;color:#ffffff;font-weight:500;font-size:13px;letter-spacing:2px;-webkit-user-select:none;user-select:none;flex-shrink:0;font-family:'Zen Maru Gothic',sans-serif;box-shadow:0 2px 8px rgba(76,175,80,0.15)}.title-group[data-v-eef7e62c]{display:flex;align-items:center;gap:8px}.icon-charm[data-v-eef7e62c]{width:12px;height:12px;background:#ffffff;border-radius:50%;box-shadow:0 0 0 2px #66bb6a inset}.win-controls[data-v-eef7e62c]{display:flex;gap:6px}.win-btn[data-v-eef7e62c]{width:20px;height:20px;border-radius:50%;cursor:pointer;border:1px solid rgba(255,255,255,0.4);transition:all 0.2s;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.8);color:#4caf50;padding:0}.win-btn[data-v-eef7e62c]:hover{transform:scale(1.1);filter:brightness(1.1);box-shadow:0 2px 4px rgba(76,175,80,0.2)}.win-btn .icon[data-v-eef7e62c]{width:12px;height:12px}.menu-bar[data-v-eef7e62c]{height:32px;background:rgba(232,245,233,0.5);backdrop-filter:blur(10px);border-bottom:1px solid rgba(129,199,132,0.2);display:flex;align-items:center;padding:0 16px;gap:20px;font-size:14px;color:#4caf50;flex-shrink:0;font-family:'SimSun',serif}.menu-item[data-v-eef7e62c]{position:relative;transition:color 0.2s;cursor:pointer}.menu-item[data-v-eef7e62c]:hover{color:#2e7d32}.menu-item[data-v-eef7e62c]::after{content:'';position:absolute;bottom:-2px;left:0;width:0;height:2px;background:#66bb6a;transition:width 0.3s}.menu-item[data-v-eef7e62c]:hover::after{width:100%}.menu-item-badge[data-v-eef7e62c]{position:absolute;top:4px;right:4px;width:8px;height:8px;background:#f44336;border-radius:50%;border:1px solid rgba(255,255,255,0.8)}.contacts-sidebar[data-v-eef7e62c]{width:200px;background:rgba(255,255,255,0.5);backdrop-filter:blur(20px);border-right:1px solid rgba(129,199,132,0.3);display:flex;flex-direction:column;overflow:hidden}.contacts-header[data-v-eef7e62c]{padding:12px;border-bottom:1px solid rgba(129,199,132,0.2);font-size:13px;color:#4caf50;font-weight:500}.contacts-list[data-v-eef7e62c]{flex:1;overflow-y:auto;padding:8px}.contacts-list[data-v-eef7e62c]::-webkit-scrollbar{width:4px;background:transparent}.contacts-list[data-v-eef7e62c]::-webkit-scrollbar-thumb{background:rgba(129,199,132,0.3);border-radius:2px}.contact-item[data-v-eef7e62c]{display:flex;align-items:center;gap:10px;padding:10px;cursor:pointer;border-radius:8px;transition:all 0.2s;position:relative;margin-bottom:4px}.contact-item[data-v-eef7e62c]:hover{background:rgba(129,199,132,0.15)}.contact-item.active[data-v-eef7e62c]{background:rgba(129,199,132,0.25)}.contact-avatar[data-v-eef7e62c]{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#81c784,#66bb6a);display:flex;align-items:center;justify-content:center;color:white;font-size:14px;font-weight:500;flex-shrink:0;position:relative}.contact-info[data-v-eef7e62c]{flex:1;min-width:0}.contact-name[data-v-eef7e62c]{font-size:13px;color:#2e7d32;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.contact-badge[data-v-eef7e62c]{position:absolute;top:8px;right:8px;width:8px;height:8px;background:#f44336;border-radius:50%;display:none}.contact-item.has-unread .contact-badge[data-v-eef7e62c]{display:block}.avatar-unread-dot[data-v-eef7e62c]{position:absolute;top:0;right:0;width:10px;height:10px;background:#f44336;border-radius:50%;border:2px solid rgba(255,255,255,0.9);z-index:1}.chat-area[data-v-eef7e62c]{flex:1;display:flex;flex-direction:column;min-width:0}.panel-body[data-v-eef7e62c]{height:auto;max-height:400px}.display-wrapper[data-v-eef7e62c]{flex:1;border:1px solid rgba(165,214,167,0.3);margin:8px 8px 0 8px;position:relative;background:rgba(255,255,255,0.4);backdrop-filter:blur(20px);overflow:hidden;box-shadow:inset 0 0 30px rgba(76,175,80,0.05);border-radius:8px}.bg-image[data-v-eef7e62c]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:url('https://files.catbox.moe/2td8l0.jpg');background-position:center center;background-repeat:no-repeat;background-size:contain;opacity:0.06;filter:sepia(0.2) hue-rotate(80deg) saturate(1.5) brightness(1.2);z-index:0;mix-blend-mode:multiply}.watermark-xi[data-v-eef7e62c]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:160px;color:#81c784;font-weight:normal;-webkit-user-select:none;user-select:none;pointer-events:none;opacity:0.04;z-index:1;font-family:'Songti SC',serif;writing-mode:vertical-rl;text-shadow:none;border:4px double #a5d6a7;padding:20px}.scroll-container[data-v-eef7e62c]{position:absolute;top:0;left:0;width:100%;height:100%;overflow-y:scroll;overflow-x:hidden;z-index:5;scroll-behavior:smooth}.scroll-container[data-v-eef7e62c]::-webkit-scrollbar{width:6px;background:transparent}.scroll-container[data-v-eef7e62c]::-webkit-scrollbar-thumb{background:rgba(129,199,132,0.3);border-radius:3px}.scroll-container[data-v-eef7e62c]::-webkit-scrollbar-thumb:hover{background:rgba(129,199,132,0.6)}.chat-log[data-v-eef7e62c]{display:flex;flex-direction:column;gap:24px;padding:30px 24px}.message-container[data-v-eef7e62c]{display:flex;flex-direction:column;margin-bottom:16px}.message-container.message-left[data-v-eef7e62c]{align-items:flex-start}.message-container.message-right[data-v-eef7e62c]{align-items:flex-end}.speaker-label[data-v-eef7e62c]{font-size:0.75em;color:#788a82;margin-bottom:4px;padding:0 8px}.timestamp[data-v-eef7e62c]{font-size:0.75em;color:#aaa;margin-top:4px;padding:0 8px}.bubble[data-v-eef7e62c]{max-width:80%;padding:10px 15px;border-radius:18px;position:relative;line-height:1.5;white-space:pre-wrap;word-break:break-all}.bubble-left[data-v-eef7e62c]{background-color:rgba(224,242,233,0.9);color:#5a6e65;border-bottom-left-radius:4px;align-self:flex-start}.bubble-right[data-v-eef7e62c]{background-color:rgba(255,255,255,0.85);color:#788a82;border:1px solid #d1e5d9;border-bottom-right-radius:4px;align-self:flex-end}.sub-text[data-v-eef7e62c]{font-family:'KaiTi','',serif;font-size:0.9em;color:#66bb6a;margin:0 2px}.cursor[data-v-eef7e62c]{display:inline-block;width:6px;height:6px;background:#4caf50;border-radius:50%;animation:blink-eef7e62c 1s infinite;margin-left:4px;vertical-align:middle}.cmd-bar[data-v-eef7e62c]{height:48px;background:rgba(232,245,233,0.5);backdrop-filter:blur(10px);padding:8px 16px;display:flex;align-items:center;gap:10px;flex-shrink:0;border-top:1px solid rgba(165,214,167,0.3)}.cmd-input[data-v-eef7e62c]{flex:1;height:32px;background:rgba(255,255,255,0.7);border:1px solid rgba(129,199,132,0.3);border-radius:16px;font-family:'Noto Serif SC',sans-serif;font-size:14px;color:#2e7d32;padding:0 12px;outline:none;transition:all 0.3s}.cmd-input[data-v-eef7e62c]:focus{border-color:#66bb6a;background:rgba(255,255,255,0.9)}.cmd-input[data-v-eef7e62c]:disabled{opacity:0.6;cursor:not-allowed}.cmd-send-btn[data-v-eef7e62c]{padding:6px 16px;height:32px;background:rgba(129,199,132,0.8);border:1px solid rgba(129,199,132,0.5);border-radius:16px;color:white;font-size:13px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;min-width:40px}.cmd-send-btn[data-v-eef7e62c]:hover:not(:disabled){background:rgba(129,199,132,1);transform:translateY(-1px);box-shadow:0 2px 8px rgba(76,175,80,0.3)}.cmd-send-btn[data-v-eef7e62c]:disabled{opacity:0.5;cursor:not-allowed}.cmd-send-btn .icon[data-v-eef7e62c]{width:16px;height:16px}.status-bar[data-v-eef7e62c]{height:48px;background:rgba(240,253,244,0.8);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;gap:24px;padding:0 10px;flex-shrink:0;z-index:20}.jade-btn[data-v-eef7e62c]{padding:6px 18px;background:rgba(255,255,255,0.6);backdrop-filter:blur(10px);border:1.5px solid rgba(129,199,132,0.4);border-radius:20px;font-family:'Zen Maru Gothic',sans-serif;font-size:11px;color:#4caf50;cursor:pointer;outline:none;transition:all 0.3s;display:flex;align-items:center;gap:4px}.jade-btn[data-v-eef7e62c]:hover{background:rgba(129,199,132,0.2);color:#2e7d32;border-color:#66bb6a;transform:translateY(-2px);box-shadow:0 4px 12px rgba(76,175,80,0.15)}.jade-btn-red[data-v-eef7e62c]:hover{border-color:#81c784;color:#43a047;background:rgba(165,214,167,0.2)}.refresh-indicator[data-v-eef7e62c]{position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);padding:8px 16px;border-radius:20px;border:1px solid rgba(129,199,132,0.3);box-shadow:0 2px 8px rgba(76,175,80,0.2);z-index:10;font-size:12px;color:#2e7d32}.refresh-spinner[data-v-eef7e62c]{width:16px;height:16px;border:2px solid rgba(129,199,132,0.3);border-top-color:#4caf50;border-radius:50%;animation:spin-eef7e62c 1s linear infinite}@keyframes spin-eef7e62c{to{transform:rotate(360deg)}}.settings-overlay[data-v-eef7e62c]{position:absolute;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);backdrop-filter:blur(4px)}.settings-panel[data-v-eef7e62c]{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:12px;border:2px solid rgba(129,199,132,0.3);box-shadow:0 10px 40px rgba(76,175,80,0.2);width:90%;max-width:400px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}.settings-header[data-v-eef7e62c]{background:linear-gradient(to right,#66bb6a 0%,#81c784 100%);color:white;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(129,199,132,0.3)}.settings-header h3[data-v-eef7e62c]{margin:0;font-size:16px;font-weight:500}.settings-close[data-v-eef7e62c]{background:transparent;border:none;color:white;font-size:24px;line-height:1;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s}.settings-close[data-v-eef7e62c]:hover{opacity:0.8}.settings-body[data-v-eef7e62c]{padding:20px;overflow-y:auto}.settings-item[data-v-eef7e62c]{margin-bottom:20px}.settings-item label[data-v-eef7e62c]{display:block;margin-bottom:8px;font-size:14px;color:#2e7d32;font-weight:500}.settings-input[data-v-eef7e62c]{width:100%;padding:8px 12px;border:1px solid rgba(129,199,132,0.3);border-radius:8px;font-size:14px;color:#2e7d32;background:rgba(255,255,255,0.8);outline:none;transition:all 0.3s;box-sizing:border-box}.settings-input[data-v-eef7e62c]:focus{border-color:#66bb6a;background:rgba(255,255,255,1)}.settings-btn[data-v-eef7e62c]{margin-top:8px;padding:6px 16px;background:rgba(129,199,132,0.8);border:1px solid rgba(129,199,132,0.5);border-radius:8px;color:white;font-size:12px;cursor:pointer;transition:all 0.2s}.settings-btn[data-v-eef7e62c]:hover{background:rgba(129,199,132,1);transform:translateY(-1px);box-shadow:0 2px 8px rgba(76,175,80,0.3)}@keyframes blink-eef7e62c{0%{opacity:0.2;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}100%{opacity:0.2;transform:scale(0.8)}}@media (max-width:800px){.theater-window[data-v-eef7e62c]:not(.theater-window-fullscreen){width:95%;max-width:28rem}.theater-window[data-v-eef7e62c]{max-height:none;height:auto}.theater-window-fullscreen[data-v-eef7e62c]{width:90%;max-width:28rem;border-radius:12px;height:auto;max-height:none}.panel-body[data-v-eef7e62c]{height:auto;max-height:none}}

input[type='text'][data-v-6137eb39]{font-family:monospace}

.settings-scroll-container[data-v-783ad584]{scrollbar-width:none;-ms-overflow-style:none}.settings-scroll-container[data-v-783ad584]::-webkit-scrollbar{display:none}input[type='range'][data-v-783ad584]{-webkit-appearance:none;appearance:none;height:6px;background:var(--muted);border-radius:9999px;outline:none}input[type='range'][data-v-783ad584]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--primary);border-radius:9999px;cursor:pointer}input[type='range'][data-v-783ad584]::-moz-range-thumb{width:16px;height:16px;background:var(--primary);border-radius:9999px;cursor:pointer;border:none}

.history-scroll-container[data-v-ae9bdb74]{scrollbar-width:none;-ms-overflow-style:none}.history-scroll-container[data-v-ae9bdb74]::-webkit-scrollbar{display:none}.history-message-item[data-v-ae9bdb74]{position:relative;margin-bottom:0}.history-message-item[data-v-ae9bdb74]:hover{background-color:rgba(0,0,0,0.04)}


/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>