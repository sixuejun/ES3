```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>小剧场_Zen.exe</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap');
  body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: transparent; overflow: hidden; display: flex; justify-content: center; align-items: center; font-family: 'Noto Serif SC', 'SimSun', serif; color: #2d2d2d; }
  #stage-wrapper { position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.15); flex-shrink: 0; overflow: hidden; border-radius: 4px; }
  #stage { width: 620px; height: 450px; position: absolute; top: 0; left: 0; transform-origin: top left; background: #e6e6e6; visibility: hidden; }
    .crt-layer { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(rgba(255,255,255,0) 50%, rgba(0,0,0,0.02) 50%), url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDIiLz4KPC9zdmc+'); background-size: 100% 4px, 4px 4px; pointer-events: none; z-index: 9999; mix-blend-mode: multiply; opacity: 0.6; }
    .xp-window { width: 100%; height: 100%; background: #f4f1ea; border: 1px solid #bba; display: flex; flex-direction: column; position: relative; z-index: 10; box-sizing: border-box; }
    .title-bar { height: 32px; background: #2f3a4c; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; color: #f4f1ea; font-weight: 500; font-size: 13px; letter-spacing: 2px; user-select: none; flex-shrink: 0; font-family: 'Zen Maru Gothic', sans-serif; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
  .title-group { display: flex; align-items: center; gap: 8px; }
  .icon-charm { width: 12px; height: 12px; background: #b7412d; border-radius: 50%; box-shadow: 0 0 0 2px #f4f1ea inset; }
  .win-controls { display: flex; gap: 6px; }
  .win-btn { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); transition: all 0.2s; }
  .btn-min { background: #dcd3b2; }
  .btn-max { background: #8a9a5b; }
  .btn-close { background: #b7412d; }
  .win-btn:hover { transform: scale(1.1); filter: brightness(1.2); }
    .menu-bar { height: 28px; background: #e8e4d9; border-bottom: 1px solid #dcd3b2; display: flex; align-items: center; padding: 0 16px; gap: 20px; font-size: 11px; color: #595045; flex-shrink: 0; font-family: 'SimSun'; }
  .menu-item { position: relative; transition: color 0.2s; }
  .menu-item:hover { color: #b7412d; cursor: pointer; }
  .menu-item::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 1px; background: #b7412d; transition: width 0.3s; }
  .menu-item:hover::after { width: 100%; }
    .display-wrapper { flex: 1; border: 1px solid #dcd3b2; margin: 8px 8px 0 8px; position: relative; background: #fdfdfb; overflow: hidden; box-shadow: inset 0 0 15px rgba(0,0,0,0.02); }
    .bg-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('https://files.catbox.moe/2td8l0.jpg') center/cover no-repeat; opacity: 0.15; filter: sepia(0.4) contrast(0.9); z-index: 0; mix-blend-mode: multiply; }
  .watermark-xi { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 160px; color: #b7412d; font-weight: normal; user-select: none; pointer-events: none; opacity: 0.08; z-index: 1; font-family: 'Songti SC', serif; writing-mode: vertical-rl; text-shadow: none; border: 4px double #b7412d; padding: 20px; }
  .scroll-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: scroll; overflow-x: hidden; z-index: 5; scroll-behavior: smooth; }
    .scroll-container::-webkit-scrollbar { width: 6px; background: transparent; }
  .scroll-container::-webkit-scrollbar-thumb { background: rgba(183, 65, 45, 0.2); border-radius: 3px; }
  .scroll-container::-webkit-scrollbar-thumb:hover { background: rgba(183, 65, 45, 0.5); }
  #chat-log { display: flex; flex-direction: column; gap: 24px; padding: 30px 24px; }
    .bubble { max-width: 82%; padding: 12px 16px; border: 1px solid rgba(0,0,0,0.05); font-size: 17px; line-height: 1.8; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.04); color: #444; word-break: break-all; border-radius: 8px; transition: transform 0.2s; }
  .bubble:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .sub-text { font-family: 'KaiTi', '楷体', serif; font-size: 0.9em; color: #888; margin: 0 2px; }
    .bubble::before {
    content: attr(data-owner);
    position: absolute; top: -26px;
    font-size: 13px; color: #999;
    font-family: 'Zen Maru Gothic', sans-serif; font-weight: 500;
    letter-spacing: 1px;
  }
    .bubble.bubble-hide-label { margin-top: -12px; }
  .bubble.bubble-hide-label::before { display: none; }
    .bubble-left { align-self: flex-start; background: #fff; border-top-left-radius: 2px; }
  .bubble-left::before { left: 2px; }
    .bubble-right { align-self: flex-end; background: #eff4f3; color: #2c3e50; border-top-right-radius: 2px; border: 1px solid rgba(138, 154, 91, 0.1); }
  .bubble-right::before { right: 2px; text-align: right; }
  .cursor { display: inline-block; width: 6px; height: 6px; background: #b7412d; border-radius: 50%; animation: blink 1s infinite; margin-left: 4px; vertical-align: middle; }
    .cmd-bar { height: 32px; background: #f4f1ea; padding: 6px 16px; display: flex; align-items: center; gap: 10px; flex-shrink: 0; border-top: 1px solid #e8e4d9; }
  .cmd-label { font-size: 10px; color: #888; font-family: 'Zen Maru Gothic', sans-serif; letter-spacing: 1px; }
  .cmd-input { flex: 1; height: 24px; background: transparent; border: none; border-bottom: 1px dashed #ccc; font-family: 'Noto Serif SC', monospace; font-size: 11px; color: #555; padding: 0 4px; outline: none; transition: border-color 0.3s; }
  .cmd-input:focus { border-bottom-color: #b7412d; color: #000; }
  .status-bar { height: 48px; background: #f4f1ea; display: flex; align-items: center; justify-content: center; gap: 24px; padding: 0 10px; flex-shrink: 0; z-index: 20; }
  .jade-btn { padding: 4px 16px; background: transparent; border: 1px solid #dcd3b2; border-radius: 20px; font-family: 'Zen Maru Gothic'; font-size: 11px; color: #666; cursor: pointer; outline: none; transition: all 0.3s; display: flex; align-items: center; gap: 4px; }
  .jade-btn:hover { background: #e8e4d9; color: #2f3a4c; border-color: #2f3a4c; }
  .jade-btn-red:hover { border-color: #b7412d; color: #b7412d; background: rgba(183, 65, 45, 0.05); }
    .sys-msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 240px; background: #fff; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: none; z-index: 100; border-radius: 2px; border: 1px solid #eee; }
  .sys-header { background: #b7412d; color: white; padding: 8px; font-size: 11px; letter-spacing: 1px; text-align: center; }
  .sys-body { padding: 24px; text-align: center; font-size: 12px; color: #444; font-family: 'Noto Serif SC'; }
  .sys-btn { margin-top: 16px; padding: 4px 12px; background: white; border: 1px solid #ccc; cursor: pointer; font-size: 10px; color: #666; transition: 0.2s; }
  .sys-btn:hover { border-color: #b7412d; color: #b7412d; }
  @keyframes blink { 0% { opacity: 0.2; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0.2; transform: scale(0.8); } }
  @media (max-width: 800px) { #stage-wrapper { box-shadow: none; border-radius: 0; } }
</style>
</head>
<body>
<div id="stage-wrapper">
  <div id="stage">
    <div class="crt-layer"></div>
    <div class="xp-window" id="main-window">
      <div class="title-bar">
        <div class="title-group">
          <div class="icon-charm"></div>
          <span id="win-title">$1.log :: READING...</span>
        </div>
        <div class="win-controls">
          <div class="win-btn btn-min"></div>
          <div class="win-btn btn-max"></div>
          <div class="win-btn btn-close"></div>
        </div>
      </div>
      <div class="menu-bar">
        <span class="menu-item">記録 (Rec)</span><span class="menu-item">設定 (Set)</span><span class="menu-item">表示 (View)</span><span class="menu-item">終了 (Exit)</span>
      </div>
      <div class="display-wrapper">
        <div class="bg-image"></div>
        <div class="scroll-container" id="scroll-view"><div id="chat-log"></div></div>
      </div>
      <div class="cmd-bar">
        <span class="cmd-label">STATUS_</span>
        <input type="text" class="cmd-input" id="status-output" value="Initializing..." readonly>
      </div>
      <div class="status-bar">
        <button class="jade-btn" onclick="playAuto()">▶ 自動再生</button>
        <button class="jade-btn" onclick="playStep()">⏯ ステップ</button>
        <button class="jade-btn jade-btn-red" onclick="reset()">↺ リセット</button>
      </div>
      <div class="sys-msg" id="alert-box">
        <div class="sys-header">SYSTEM_NOTICE</div>
        <div class="sys-body"><div>記録終了<br>End of Record</div><button class="sys-btn" onclick="closeAlert()">閉じる</button></div>
      </div>
    </div>
  </div>
</div>
<script>
  const SCRIPT_TITLE = `$1`;
  const RAW_CONTENT = `$2`;
  function fitStage() {
    const wrapper = document.getElementById('stage-wrapper');
    const stage = document.getElementById('stage');
    const designW = 620; const designH = 450;
    const winW = window.innerWidth; const winH = window.innerHeight;
    let scale;
    if (winW < 800) { scale = winW / designW; } else { scale = Math.min(winW / designW, winH / designH); if (scale > 0.15) scale = 1.05; }
    stage.style.transform = `scale(${scale})`;
    wrapper.style.width = (designW * scale) + 'px';
    wrapper.style.height = (designH * scale) + 'px';
    stage.style.visibility = 'visible';
  }
  window.addEventListener('resize', fitStage);
  window.addEventListener('load', fitStage);
  const dialogues = [];
  function parseContent(content) {
    const dialRegex = /【(.*?)[:：](.*?)】/g;
    let match;
    while ((match = dialRegex.exec(content)) !== null) {
      let rawName = match[1];
      let contentStr = match[2];
      let displayName = rawName.replace(/[（(].*?[）)]/g, "").trim();
      let actionPrefix = "";
      let actionMatch = rawName.match(/[（(](.*?)[）)]/);
      if (actionMatch) actionPrefix = actionMatch[0];
      let type = 'right';
      if (/祁三|user/i.test(displayName)) {
        type = 'left';
      } else {
        type = 'right';
      }
      dialogues.push({
        type: type,
        owner: displayName,
        text: actionPrefix + contentStr
      });
    }
  }
  parseContent(RAW_CONTENT);
  let idx = 0; let typingTimer = null; let autoTimer = null;
  const chatLog = document.getElementById('chat-log');
  const scrollView = document.getElementById('scroll-view');
  const alertBox = document.getElementById('alert-box');
  const statusOutput = document.getElementById('status-output');
  const titleSpan = document.getElementById('win-title');
  window.onload = function() {
    fitStage();
    titleSpan.innerText = `${SCRIPT_TITLE} :: LOADED`;
    updateStatus(`Ready. Loaded "${SCRIPT_TITLE}" (${dialogues.length} fragments).`);
  }
  function updateStatus(msg, force) {
    if(force) { statusOutput.value = msg; return; }
    const countStr = `[${idx}/${dialogues.length}]`;
    statusOutput.value = `${countStr} :: ${msg}`;
  }
  function typeWriter(element, text, speed, callback) {
    let i = 0;
    const cursor = document.createElement('span'); cursor.className = 'cursor';
    element.appendChild(cursor);
    updateStatus(`Writing...`);
    let inParen = false; let currentContainer = null;
    typingTimer = setInterval(() => {
      if (i < text.length) {
        const char = text.charAt(i);
        if (char === '（' || char === '(') { inParen = true; const span = document.createElement('span'); span.className = 'sub-text'; cursor.before(span); currentContainer = span; }
        if (inParen && currentContainer) { currentContainer.textContent += char; } else { cursor.before(char); }
        if (char === '）' || char === ')') { inParen = false; currentContainer = null; }
        i++;       
        scrollView.scrollTop = scrollView.scrollHeight;
      } else {
        clearInterval(typingTimer); cursor.remove(); typingTimer = null; updateStatus(`Waiting_`); if (callback) callback();
      }
    }, speed);
  }
  function addNext(isAuto) {
    if (idx >= dialogues.length) { clearInterval(autoTimer); updateStatus("End of stream.", true); alertBox.style.display = 'block'; return; }
    if (typingTimer) return;
    const d = dialogues[idx];
    const el = document.createElement('div');
    el.className = `bubble bubble-${d.type}`;
    el.setAttribute('data-owner', d.owner);    
    const prevBubble = chatLog.lastElementChild;
    if (prevBubble && prevBubble.getAttribute('data-owner') === d.owner) {
      el.classList.add('bubble-hide-label');
    }
    chatLog.appendChild(el); idx++;
    let speed = d.text.length > 50 ? 30 : 50;
    typeWriter(el, d.text, speed, () => {
      if (isAuto) {
        updateStatus(`Auto playing...`);
        autoTimer = setTimeout(() => addNext(true), 800);
      }
    });
  }
  function playStep() { clearTimeout(autoTimer); if (typingTimer) return; if(idx >= dialogues.length) { alertBox.style.display = 'block'; return; } addNext(false); }
  function playAuto() { clearTimeout(autoTimer); if(idx >= dialogues.length) { alertBox.style.display = 'block'; return; } if (!typingTimer) addNext(true); }
  function reset() { clearTimeout(autoTimer); clearInterval(typingTimer); typingTimer = null; chatLog.innerHTML = ''; idx = 0; updateStatus(`Reset complete.`, true); alertBox.style.display = 'none'; }
  function closeAlert() { alertBox.style.display = 'none'; }
</script>
</body>
</html>
```
